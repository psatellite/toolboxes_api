<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>Generate Pluto lander model</title>
<meta name="generator" content="MATLAB 24.1">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-01-22">
<meta name="DC.source" content="PlutoLanderCAD.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h1>Generate Pluto lander model</h1>
<!--introduction-->
<p>Generate a CAD model of a Pluto lander. Creates power and mass reports of the model and exports it to OBJ. Saves the model in PlutoLander.mat which is used by other demos. The model may be generated with the solar arrays stowed or deployed.</p>
<p>See also BuildCADModel, CreateBody, CreateComponent, CreateReport, ExportOBJ, ThrusterCAD, PanelFrame, StarCameraBasicModel, Constant, SaveStructure, ShapedStrut, Q2Mat, U2Q, Unit, LandingLegsCAD</p>
<!--/introduction-->
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#2">Constants</a>
</li>
<li>
<a href="#3">Mission information</a>
</li>
<li>
<a href="#4">Spacecraft hardware parameters</a>
</li>
<li>
<a href="#5">Initialize BuildCADModel and create the Core body</a>
</li>
<li>
<a href="#6">Components</a>
</li>
<li>
<a href="#7">Bus Frame</a>
</li>
<li>
<a href="#8">Panels</a>
</li>
<li>
<a href="#9">Add subsystems</a>
</li>
<li>
<a href="#10">Update the mass properties to produce the tables</a>
</li>
<li>
<a href="#11">Export to and obj (graphics) file</a>
</li>
</ul>
</div>
<pre class="codeinput">
<span class="comment">%--------------------------------------------------------------------------</span>
<span class="comment">%   Copyright (c) 2014 Princeton Satellite Systems, Inc.</span>
<span class="comment">%   All rights reserved.</span>
<span class="comment">%--------------------------------------------------------------------------</span>
<span class="comment">%   Since 2016.1</span>
<span class="comment">%--------------------------------------------------------------------------</span>

<span class="comment">% Multibody switch</span>
multiBody       = false;
arraysStowed    = true;
</pre>
<h2 id="2">Constants</h2>
<pre class="codeinput">rhoCarbonFiber  = 1600;
rhoAluminum     = 2700;
rhoGlass        = 2400;
rhoSteel        = 8000;
rhoTungsten     = 15630;
inToM           = 0.0254;
rhoSolarPanel   = 63/(8.3*2.3);  <span class="comment">% Dawn spacecraft areal mass (kg/m2)</span>
lToM3           = 0.001; <span class="comment">% Liters to cubic meters</span>
</pre>
<h2 id="3">Mission information</h2>
<pre class="codeinput">massFuel        = 80;
massTotal       = 150+massFuel;
aRatio          = 1.5;
gPluto          = 0.62;
thrust          = aRatio*gPluto*massTotal;
</pre>
<h2 id="4">Spacecraft hardware parameters</h2>
<pre class="codeinput">
<span class="comment">% Thrusters</span>
densityADN    = 1.1679e+03; <span class="comment">% ADN green fuel</span>
massTank      = massFuel*[1 1]/2;
nTanks        = length(massTank);
volTank       = massTank./densityADN;
scale         = 27.8*0.0254/168;
dT            = 11.8*0.0254;
massThruster  = 10.8/2.205;
[vT, fT]      = ThrusterCAD( [0;0;-1], dT, scale*99, 20, 15*scale, 44*scale, 5*scale );
rThruster   	= [0;0;0.2];

<span class="comment">% Inertia</span>
inertia   = [1.1565   -0.0074    0.0561;<span class="keyword">...</span>
            -0.0074    1.0380    0.02281;<span class="keyword">...</span>
             0.0561    0.0228    0.7354];

<span class="comment">% Fuel tank</span>
fTank = 49/656;
rTank = (volTank/(4*pi/3)).^(1/3);

<span class="comment">% Bus</span>
zBox           = 2.4*max(rTank);
xBox           = 4.8*max(rTank);
yBox           = xBox;
panelThickness = 0.004;

xTank  = 0.8*max(rTank)*1.3;
rATank = [xTank*[1 -1;1 -1];zBox*[1 1]/2];

<span class="comment">% Star camera</span>
cameraAperture          = 12.5;
cameraFocalLength       = 25.0;
cameraLengthSunShade    = 35.0;
cameraApertureSunShade	= 25.0;
massCamera              = 0.25;
rCamera                 = 0.4*[xBox -xBox;-yBox yBox;zBox zBox];
uC                      = [0;0;1];
v1                      = Unit([1;-1;-1]);
v2                      = Unit([-1;1;-1]);
b1                      = Q2Mat(U2Q(uC,v1));
b2                      = Q2Mat(U2Q(uC,v2));
bCamera                 = {b1 b2};

<span class="comment">% Omni antennas</span>
powerOmni         = 2;
xOmni             = [xBox xBox; yBox -yBox; 0 0]/2;
rOmni             = 0.002;
c                 = Constant(<span class="string">'speed of light'</span>)*1000; <span class="comment">% m/s</span>
fComm             = 2e9; <span class="comment">% sband</span>
lOmni             = 0.5*c/fComm;
massOmni          = lOmni*pi*rOmni^2*rhoAluminum;
bOmni             = {[1 0 0;0 0 1;0 -1 0] [1 0 0;0 0 -1;0 1 0]};

<span class="comment">% IMU LN-200S</span>
radiusIMU         = 0.0889/2;
hIMU              = 0.0851;
massIMU           = 0.748;
dIMU.manufacturer = <span class="string">'Northrop Grumman'</span>;
dIMU.name         = <span class="string">'LN-200S'</span>;
powerIMU          = 12;

<span class="comment">% Sun Sensors</span>
massSunSensor     = 0.035;
xSunSensor        = 0.06;
ySunSensor        = 0.03;
zSunSensor        = 0.012;
bSunSensor        = [1 -1 2 -2 3 -3];
powerSunSensor    = 0.6;

<span class="comment">% Processing boards - 3U CompactPCI boards</span>
nBoards           = 5;
powerBoard        = 12;
xChassis          = 0.16 + 0.02;
yChassis          = 0.1 + 0.02;
zChassis          = 0.02*nBoards + 0.02;
massChassis       = 1;

<span class="comment">% Solar arrays</span>
massSAD                 = 0.2;
solarPanelThickness     = 0.004;
strutLength             = yBox/3;
nPanels                 = 2;
panelLength             = 1;
panelWidth              = 2;
massSolarPanel          = panelLength*panelWidth*rhoSolarPanel;
solarPanelEff           = 0.295;
zSolarWing              = zBox/2;
arrayMassFront          = 0.5*solarPanelThickness*panelLength*panelWidth*nPanels*rhoGlass;
arrayMassBack           = 0.5*solarPanelThickness*panelLength*panelWidth*nPanels*rhoCarbonFiber;
massStrut               = 0.1;
yPanel                  = 0.03;

bX                      = [ 1 0 0;0 0 -1;0 1  0]';
bY                      = [-1 0 0;0 1  0;0 0 -1];

<span class="comment">% Battery</span>
power                     = 0.8*2*1000;
powerNight                = 5;
massBattery               = powerNight*24*15/135; <span class="comment">% Saft batteries</span>
volBattery                = powerNight*24*15/250;
wBattery                  = (2*volBattery*lToM3)^(1/3); <span class="comment">% One length is half the others</span>
</pre>
<h2 id="5">Initialize BuildCADModel and create the Core body</h2>
<pre class="codeinput">BuildCADModel( <span class="string">'initialize'</span> );
BuildCADModel( <span class="string">'set name'</span> , <span class="string">'PlutoLander'</span> );
BuildCADModel( <span class="string">'set units'</span>, <span class="string">'mks'</span> );

<span class="comment">% Core</span>
m = CreateBody(<span class="string">'make'</span>,<span class="string">'name'</span>,<span class="string">'Core'</span>);
BuildCADModel(<span class="string">'add body'</span>, m );

<span class="keyword">if</span>( multiBody )
  rHinge = [0;0;strutLength];
<span class="keyword">else</span>
  rHinge = [0;0;0];
<span class="keyword">end</span>
m = CreateBody(<span class="string">'make'</span>,<span class="string">'name'</span>,<span class="string">'SolarWing'</span>,<span class="string">'rHinge'</span>,rHinge,<span class="string">'previousBody'</span>,1);
BuildCADModel(<span class="string">'add body'</span>, m );

<span class="keyword">if</span>( ~multiBody )
  zPanel = zBox+panelWidth/2;
  zStrut  = zBox;
<span class="keyword">end</span>

<span class="comment">% This creates the connections between the bodies</span>
BuildCADModel( <span class="string">'compute paths'</span> );
</pre>
<img vspace="5" hspace="5" src="PlutoLanderCAD_01.png" alt=""> <h2 id="6">Components</h2>
<pre class="codeinput">
<span class="keyword">if</span> arraysStowed
  <span class="comment">% Stow the arrays with a portion of a panel showing</span>
  tStowed = 0.1;
   m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>,xBox, <span class="string">'y'</span>,yBox, <span class="string">'z'</span>,tStowed,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>, <span class="string">'rA'</span>, [0;0;zBox+tStowed/2], <span class="string">'mass'</span>, 2*massSolarPanel+massStrut,<span class="keyword">...</span>
                     <span class="string">'name'</span>,<span class="string">'Solar Arrays Stowed'</span>, <span class="string">'body'</span>, 2,<span class="keyword">...</span>
                     <span class="string">'inside'</span>, 0, <span class="string">'power'</span>, 0 );
  BuildCADModel( <span class="string">'add component'</span>, m );
  m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>,xBox, <span class="string">'y'</span>,yBox, <span class="string">'z'</span>,solarPanelThickness,<span class="keyword">...</span>
                       <span class="string">'faceColor'</span>, <span class="string">'solar cell'</span>, <span class="string">'rA'</span>, [0;0;zBox+tStowed], <span class="string">'mass'</span>, 0,<span class="keyword">...</span>
                       <span class="string">'name'</span>,<span class="string">'Solar Array Face'</span>, <span class="string">'body'</span>, 2,<span class="keyword">...</span>
                       <span class="string">'inside'</span>, 0, <span class="string">'power'</span>, -250 );
  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">else</span>

  <span class="comment">% Solar Array 1</span>
  m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>,panelWidth, <span class="string">'y'</span>,nPanels*panelLength, <span class="string">'z'</span>,solarPanelThickness,<span class="keyword">...</span>
                       <span class="string">'faceColor'</span>, <span class="string">'solar cell'</span>, <span class="string">'rA'</span>, [0;yPanel+panelLength;zPanel], <span class="string">'mass'</span>, massSolarPanel,<span class="keyword">...</span>
                       <span class="string">'name'</span>,<span class="string">'Solar Array +Y'</span>, <span class="string">'body'</span>, 2,<span class="keyword">...</span>
                       <span class="string">'inside'</span>, 0, <span class="string">'power'</span>, -power/2 );

  BuildCADModel( <span class="string">'add component'</span>, m );

  m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>,panelWidth, <span class="string">'y'</span>,nPanels*panelLength, <span class="string">'z'</span>,solarPanelThickness,<span class="keyword">...</span>
                       <span class="string">'faceColor'</span>, [0 0 0], <span class="string">'rA'</span>, [0;yPanel+panelLength;zPanel-solarPanelThickness], <span class="string">'mass'</span>, 0,<span class="keyword">...</span>
                       <span class="string">'name'</span>,<span class="string">'Solar Array +Y back'</span>, <span class="string">'body'</span>, 2,<span class="keyword">...</span>
                       <span class="string">'inside'</span>, 0, <span class="string">'power'</span>, 0 );

  BuildCADModel( <span class="string">'add component'</span>, m );


  <span class="comment">% Solar Array 2</span>

  m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>,panelWidth, <span class="string">'y'</span>,nPanels*panelLength, <span class="string">'z'</span>,solarPanelThickness,<span class="keyword">...</span>
                       <span class="string">'faceColor'</span>, <span class="string">'solar cell'</span>, <span class="string">'rA'</span>, [0;-yPanel-panelLength;zPanel], <span class="string">'mass'</span>, massSolarPanel,<span class="keyword">...</span>
                       <span class="string">'name'</span>,<span class="string">'Solar Array -Y'</span>, <span class="string">'body'</span>, 2,<span class="keyword">...</span>
                       <span class="string">'inside'</span>, 0, <span class="string">'power'</span>, -power/2 );

  BuildCADModel( <span class="string">'add component'</span>, m );


  m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>,panelWidth, <span class="string">'y'</span>,nPanels*panelLength, <span class="string">'z'</span>,solarPanelThickness,<span class="keyword">...</span>
                       <span class="string">'faceColor'</span>, [0 0 0], <span class="string">'rA'</span>, [0;-yPanel-panelLength;zPanel-solarPanelThickness], <span class="string">'mass'</span>, 0,<span class="keyword">...</span>
                       <span class="string">'name'</span>,<span class="string">'Solar Array -Y back'</span>, <span class="string">'body'</span>, 2,<span class="keyword">...</span>
                       <span class="string">'inside'</span>, 0, <span class="string">'power'</span>, 0 );

  BuildCADModel( <span class="string">'add component'</span>, m );

  <span class="comment">% Vertical strut</span>
  m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, 0.01, <span class="string">'rLower'</span>, 0.01, <span class="string">'h'</span>, panelWidth/2, <span class="string">'n'</span>, 24, <span class="string">'rA'</span>,[0;0;zStrut],<span class="keyword">...</span>
                           <span class="string">'name'</span>, <span class="string">'Motor'</span>, <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massStrut,<span class="string">'power'</span>,0, <span class="keyword">...</span>
                           <span class="string">'faceColor'</span>, [0 0 0], <span class="string">'inside'</span>, 1);
  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>
</pre>
<img vspace="5" hspace="5" src="PlutoLanderCAD_02.png" alt=""> <h2 id="7">Bus Frame</h2>
<pre class="codeinput">[v, f]    = PanelFrame( xBox, yBox, panelThickness, panelThickness );
massFrame	= 2*(xBox + yBox)*panelThickness^2*rhoCarbonFiber;
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'gold foil'</span>,<span class="string">'rA'</span>, [0;0;zBox-2*panelThickness],<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massFrame, <span class="string">'name'</span>, <span class="string">'Top Frame'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );

v = ([1 0 0; 0 1 0; 0 0 -1]*v')';
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'gold foil'</span>,<span class="string">'rA'</span>, [0;0;2*panelThickness],<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massFrame, <span class="string">'name'</span>, <span class="string">'Bottom Frame'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );

z1     = 2*panelThickness;
z2     = z1 + zBox-2*panelThickness;
c      = [];
c.x    = [ -0.250 0     0     0.250  0.250  0      0     -0.250]*inToM;
c.y    = [  0.375 0.375 0.125 0.125 -0.375 -0.375 -0.125 -0.125]*inToM;
[v, f] = ShapedStrut( [0;0;z1], [0;0;z2], c );
angle  = 0;
sX     = [1  1 -1 -1];
sY     = [1 -1 -1  1];
massStrut = panelThickness^2*zBox*rhoCarbonFiber;
<span class="keyword">for</span> k = 1:4
  angle = angle + pi/2;
  xF    = sX(k)*(xBox/2 - panelThickness/2);
  yF    = sY(k)*(yBox/2 - panelThickness/2);
  b     = [cos(angle) sin(angle) 0;-sin(angle) cos(angle) 0;0 0 1];
  vR    = (b*v')';
  m     = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, vR, <span class="string">'face'</span>, f,<span class="keyword">...</span>
                           <span class="string">'faceColor'</span>, <span class="string">'gold foil'</span>,<span class="string">'rA'</span>, [xF;yF;0], <span class="keyword">...</span>
                           <span class="string">'mass'</span>, massStrut, <span class="string">'name'</span>, [<span class="string">'z strut'</span> num2str(k)], <span class="string">'body'</span>, 1,<span class="keyword">...</span>
                           <span class="string">'inside'</span>,0 );
  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>
</pre>
<img vspace="5" hspace="5" src="PlutoLanderCAD_03.png" alt=""> <h2 id="8">Panels</h2>
<pre class="codeinput">panelName = {<span class="string">'+X'</span> <span class="string">'-X'</span> <span class="string">'+Y'</span> <span class="string">'-Y'</span> <span class="string">'+Z'</span>  <span class="string">'-Z'</span>};
color     = {<span class="string">'gold foil'</span> <span class="string">'gold foil'</span> <span class="string">'gold foil'</span> <span class="string">'gold foil'</span> <span class="string">'gold foil'</span> <span class="string">'radiator'</span>};
xLoc      = (xBox - panelThickness)/2;
yLoc      = (yBox - panelThickness)/2;
zLoc      = (zBox - panelThickness)/2;

wX        = xBox - 2*panelThickness;
wY        = yBox - 2*panelThickness;
wZ        = zBox - 2*panelThickness;

th        = panelThickness;
zH        = zBox/2;

rAP       = [ xLoc -xLoc 0     0      0       0 ;<span class="keyword">...</span>
              0     0    yLoc -yLoc   0       0;<span class="keyword">...</span>
              zH    zH   zH    zH    zBox     0];

dP        =     [ th  th wX  wX  wX  wX ;<span class="keyword">...</span>
                  wY  wY th  th  wY  wY;<span class="keyword">...</span>
                  wZ  wZ wZ  wZ  th  th];

<span class="keyword">for</span> k = 1:6
    massPanel = dP(1,k)*dP(2,k)*dP(3,k)*rhoCarbonFiber;
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, dP(1,k), <span class="string">'y'</span>,dP(2,k), <span class="string">'z'</span>,dP(3,k),<span class="keyword">...</span>
                         <span class="string">'faceColor'</span>, color{k}, <span class="string">'rA'</span>, rAP(:,k), <span class="string">'mass'</span>, massPanel,<span class="keyword">...</span>
                         <span class="string">'name'</span>, [<span class="string">'Panel '</span> panelName{k}], <span class="string">'body'</span>, 1,<span class="keyword">...</span>
                         <span class="string">'inside'</span>, 0 );
    BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>

<span class="comment">% Landing legs</span>

rL        = 35;
[v, f]    = LandingLegsCAD(<span class="string">'scale'</span>,0.012,<span class="string">'xy spacing'</span>,rL);

m         = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'v'</span>,v,<span class="string">'f'</span>,f,<span class="keyword">...</span>
                             <span class="string">'faceColor'</span>, [1 0.84 0] ,<span class="string">'rA'</span>, [0;0;0],<span class="keyword">...</span>
                             <span class="string">'name'</span>, <span class="string">'Landing Legs'</span>,<span class="string">'inside'</span>,0);
BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">% Battery</span>
rB        = 0.5*([0;yBox;0] + [-2*panelThickness;-wBattery-2*panelThickness;wBattery/2]);
m         = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>,<span class="string">'x'</span>, wBattery, <span class="string">'y'</span>, wBattery, <span class="string">'z'</span>, wBattery/2,<span class="keyword">...</span>
                             <span class="string">'faceColor'</span>, [0 1 0] ,<span class="string">'rA'</span>, rB,<span class="string">'mass'</span>,massBattery,<span class="keyword">...</span>
                             <span class="string">'name'</span>, <span class="string">'Battery 1'</span>,<span class="string">'inside'</span>,1);
BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">% Omni antennas</span>
<span class="keyword">for</span> k = 1:2
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, rOmni, <span class="string">'rLower'</span>, rOmni, <span class="string">'h'</span>, lOmni, <span class="string">'n'</span>, 24, <span class="string">'rA'</span>,xOmni(:,k),<span class="string">'b'</span>,bOmni{k},<span class="keyword">...</span>
                         <span class="string">'name'</span>, sprintf(<span class="string">'Omni %d'</span>,k), <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massOmni,<span class="string">'power'</span>,powerOmni, <span class="keyword">...</span>
                         <span class="string">'faceColor'</span>, [0 0 0], <span class="string">'inside'</span>, 1);
    BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>

<span class="comment">% Fuel tanks - wet</span>
<span class="keyword">for</span> k = 1:nTanks
  m         = CreateComponent( <span class="string">'make'</span>, <span class="string">'sphere'</span>,<span class="string">'radius'</span>, rTank(k),<span class="string">'n'</span>,20,<span class="keyword">...</span>
                             <span class="string">'faceColor'</span>, [0 1 0] ,<span class="string">'rA'</span>, rATank(:,k),<span class="string">'mass'</span>,(1+fTank)*massFuel/nTanks,<span class="keyword">...</span>
                             <span class="string">'name'</span>, sprintf(<span class="string">'HPGP Tank %d'</span>,k),<span class="string">'inside'</span>,1);

  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>

<span class="comment">% Star cameras</span>
[v, f]  = StarCameraBasicModel( cameraAperture, cameraFocalLength, cameraApertureSunShade, cameraLengthSunShade );

m         = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'v'</span>, v, <span class="string">'f'</span>, f, <span class="string">'b'</span>, bCamera{1},<span class="keyword">...</span>
                             <span class="string">'rA'</span>, rCamera(:,1), <span class="string">'name'</span>, <span class="string">'Star Camera 1'</span>, <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massCamera );
BuildCADModel( <span class="string">'add component'</span>, m );

m         = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'v'</span>, v, <span class="string">'f'</span>, f, <span class="string">'b'</span>, bCamera{2},<span class="keyword">...</span>
                             <span class="string">'rA'</span>, rCamera(:,2), <span class="string">'name'</span>, <span class="string">'Star Camera 2'</span>, <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massCamera );
BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">% IMU</span>
rIMU            = [ xBox/2-radiusIMU-4*panelThickness;<span class="keyword">...</span>
                    yBox/2-radiusIMU-4*panelThickness;<span class="keyword">...</span>
                    panelThickness];
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, radiusIMU, <span class="string">'rLower'</span>,radiusIMU,<span class="string">'h'</span>,hIMU,<span class="keyword">...</span>
                     <span class="string">'inside'</span>, 1,<span class="string">'deviceInfo'</span>,dIMU,<span class="string">'mass'</span>,massIMU,<span class="keyword">...</span>
                     <span class="string">'rA'</span>, rIMU, <span class="string">'name'</span>, <span class="string">'IMU'</span>, <span class="string">'body'</span>, 1, <span class="string">'faceColor'</span>, [0 0 1], <span class="string">'power'</span>, powerIMU );
BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">% Chassis</span>
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, xChassis, <span class="string">'y'</span>, yChassis, <span class="string">'z'</span>, zChassis, <span class="string">'faceColor'</span>, [0 0.5 0.5],<span class="keyword">...</span>
                     <span class="string">'rA'</span>, [-xBox/2 + xChassis/2 + 2*panelThickness; -yBox/2 + yChassis/2 + 2*panelThickness; zBox - zChassis/2 - 2*panelThickness],<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massChassis, <span class="string">'name'</span>, <span class="string">'C&amp;DH Box'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 1 );
BuildCADModel( <span class="string">'add component'</span>, m );

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'v'</span>, vT, <span class="string">'f'</span>, fT, <span class="string">'faceColor'</span>, [0 0.5 0.5],<span class="keyword">...</span>
                     <span class="string">'rA'</span>,  rThruster, <span class="string">'mass'</span>, massThruster, <span class="string">'name'</span>, <span class="string">'Thruster'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">% Misc payload</span>
rPayload = [xTank*[1 -1;-1 1];zBox*[1 1]/2];
<span class="comment">%BuildCADModel( 'update body mass properties' );</span>
g = BuildCADModel( <span class="string">'get model'</span> );
mPayload = massTotal-g.mass.mass;
<span class="keyword">for</span> k = 1:2
  m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>,2*rTank(1), <span class="string">'y'</span>, 2*rTank(1), <span class="string">'z'</span>,2*rTank(1),<span class="keyword">...</span>
                             <span class="string">'faceColor'</span>, <span class="string">'magenta'</span> ,<span class="string">'rA'</span>, rPayload(:,k),<span class="string">'mass'</span>,mPayload/2,<span class="keyword">...</span>
                             <span class="string">'name'</span>, sprintf(<span class="string">'Payload %d'</span>,k),<span class="string">'inside'</span>,1);

  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>
</pre>
<img vspace="5" hspace="5" src="PlutoLanderCAD_04.png" alt=""> <h2 id="9">Add subsystems</h2>
<pre class="codeinput">
<span class="keyword">if</span> 1
  BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'ACS'</span>,                    {<span class="string">'star camera'</span>,<span class="string">'rwa'</span>,<span class="string">'imu'</span>} );
  BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'Propulsion'</span>,             {<span class="string">'thruster'</span>,<span class="string">'tank'</span>} );
  BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'Telemetry and Command'</span>,	{<span class="string">'C&amp;DH'</span>, <span class="string">'omni'</span>, <span class="string">'signal'</span>,<span class="string">'processor'</span>, <span class="string">'antenna'</span>, <span class="string">'board'</span>} );
  BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'Power Lander'</span>,           {<span class="string">'solar array'</span>, <span class="string">'battery'</span>, <span class="string">'motor'</span>} );
  BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'Structure'</span>,              {<span class="string">'legs'</span>, <span class="string">'panel'</span>, <span class="string">'frame'</span>, <span class="string">'strut'</span>} );
  BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'Payload'</span>,                {<span class="string">'payload'</span>} );
<span class="keyword">end</span>
</pre>
<h2 id="10">Update the mass properties to produce the tables</h2>
<pre class="codeinput">BuildCADModel( <span class="string">'update body mass properties'</span> );

g = BuildCADModel( <span class="string">'get model'</span> );
BuildCADModel( <span class="string">'show vehicle'</span> )

CreateReport( g, <span class="string">'tex'</span>, FileFullpath(<span class="string">'PlutoLanderMass'</span>),    <span class="string">'mass'</span>,  1, 1, 1 )
CreateReport( g, <span class="string">'tex'</span>, FileFullpath(<span class="string">'PlutoLanderPower'</span>),  <span class="string">'power'</span>,  1, 1, 1 )
CreateReport( g, <span class="string">'txt'</span>, [], <span class="string">'mass'</span>,  1, 0, false );
CreateReport( g, <span class="string">'txt'</span>, [], <span class="string">'power'</span>, 1, 0, false );
</pre>
<pre class="codeoutput">                              Component           Mass          Units 
                          ACS subsystem                             
                          Star Camera 1           0.25            kg 
                          Star Camera 2           0.25            kg 
                                    IMU          0.748            kg 
                    ACS Subsystem Total          1.248            kg 
                   Propulsion subsystem                             
                               Thruster          4.898            kg 
                            HPGP Tank 1          42.99            kg 
                            HPGP Tank 2          42.99            kg 
             Propulsion Subsystem Total          90.87            kg 
        Telemetry and Command subsystem                             
                               C&amp;DH Box              1            kg 
                                 Omni 1       0.002543            kg 
                                 Omni 2       0.002543            kg 
  Telemetry and Command Subsystem Total          1.005            kg 
                 Power Lander subsystem                             
                    Solar Arrays Stowed           13.3            kg 
                       Solar Array Face              0            kg 
                              Battery 1          13.33            kg 
           Power Lander Subsystem Total          26.63            kg 
                    Structure subsystem                             
                           Landing Legs              0            kg 
                               Panel +X          2.918            kg 
                               Panel -X          2.918            kg 
                               Panel +Y          2.918            kg 
                               Panel -Y          2.918            kg 
                               Panel +Z          5.886            kg 
                               Panel -Z          5.886            kg 
                              Top Frame        0.09902            kg 
                           Bottom Frame        0.09902            kg 
                               z strut1        0.01238            kg 
                               z strut2        0.01238            kg 
                               z strut3        0.01238            kg 
                               z strut4        0.01238            kg 
              Structure Subsystem Total          23.69            kg 
                      Payload subsystem                             
                              Payload 1          43.27            kg 
                              Payload 2          43.27            kg 
                Payload Subsystem Total          86.55            kg 
                                  Total            230            kg 
                              Component       Power On   Power Standby          Units 
                          ACS subsystem                                            
                          Star Camera 1              0              0             W 
                          Star Camera 2              0              0             W 
                                    IMU             12              0             W 
                    ACS Subsystem Total             12              0             W 
                   Propulsion subsystem                                            
                               Thruster              0              0             W 
                            HPGP Tank 1              0              0             W 
                            HPGP Tank 2              0              0             W 
             Propulsion Subsystem Total              0              0             W 
        Telemetry and Command subsystem                                            
                               C&amp;DH Box              0              0             W 
                                 Omni 1              2              0             W 
                                 Omni 2              2              0             W 
  Telemetry and Command Subsystem Total              4              0             W 
                 Power Lander subsystem                                            
                    Solar Arrays Stowed              0              0             W 
                       Solar Array Face           -250              0             W 
                              Battery 1              0              0             W 
           Power Lander Subsystem Total           -250              0             W 
                    Structure subsystem                                            
                           Landing Legs              0              0             W 
                               Panel +X              0              0             W 
                               Panel -X              0              0             W 
                               Panel +Y              0              0             W 
                               Panel -Y              0              0             W 
                               Panel +Z              0              0             W 
                               Panel -Z              0              0             W 
                              Top Frame              0              0             W 
                           Bottom Frame              0              0             W 
                               z strut1              0              0             W 
                               z strut2              0              0             W 
                               z strut3              0              0             W 
                               z strut4              0              0             W 
              Structure Subsystem Total              0              0             W 
                      Payload subsystem                                            
                              Payload 1              0              0             W 
                              Payload 2              0              0             W 
                Payload Subsystem Total              0              0             W 
                                  Total           -234              0             W 
</pre>
<img vspace="5" hspace="5" src="PlutoLanderCAD_05.png" alt=""> <img vspace="5" hspace="5" src="PlutoLanderCAD_06.png" alt=""> <h2 id="11">Export to and obj (graphics) file</h2>
<pre class="codeinput">
<span class="keyword">if</span> arraysStowed
  SaveStructure(g, FileFullpath(<span class="string">'PlutoLander-Stowed'</span>));
<span class="keyword">else</span>
  ExportOBJ( g, FileFullpath(<span class="string">'PlutoLander'</span>));
  SaveStructure(g, FileFullpath(<span class="string">'PlutoLander'</span>));
<span class="keyword">end</span>


<span class="comment">%--------------------------------------</span>
<span class="comment">% PSS internal file version information</span>
<span class="comment">%--------------------------------------</span>

<span class="comment">% $Id: 5e07d26b3705f1ecad7ba150358b1b88ad82a4cd $</span>
</pre>
<p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2024a</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% Generate Pluto lander model
% Generate a CAD model of a Pluto lander. Creates power and mass reports
% of the model and exports it to OBJ. Saves the model in PlutoLander.mat
% which is used by other demos. The model may be generated with the solar
% arrays stowed or deployed.
%
% See also BuildCADModel, CreateBody, CreateComponent, CreateReport, 
% ExportOBJ, ThrusterCAD, PanelFrame, StarCameraBasicModel, Constant, 
% SaveStructure, ShapedStrut, Q2Mat, U2Q, Unit, LandingLegsCAD

%%
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%   Copyright (c) 2014 Princeton Satellite Systems, Inc.
%   All rights reserved.
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%   Since 2016.1
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

% Multibody switch
multiBody       = false;
arraysStowed    = true;

%% Constants
rhoCarbonFiber  = 1600;
rhoAluminum     = 2700;
rhoGlass        = 2400;
rhoSteel        = 8000;
rhoTungsten     = 15630;
inToM           = 0.0254;
rhoSolarPanel   = 63/(8.3*2.3);  % Dawn spacecraft areal mass (kg/m2)
lToM3           = 0.001; % Liters to cubic meters

%% Mission information
massFuel        = 80;
massTotal       = 150+massFuel;
aRatio          = 1.5;
gPluto          = 0.62;
thrust          = aRatio*gPluto*massTotal;

%% Spacecraft hardware parameters

% Thrusters
densityADN    = 1.1679e+03; % ADN green fuel
massTank      = massFuel*[1 1]/2;
nTanks        = length(massTank);
volTank       = massTank./densityADN;
scale         = 27.8*0.0254/168;
dT            = 11.8*0.0254;
massThruster  = 10.8/2.205;
[vT, fT]      = ThrusterCAD( [0;0;-1], dT, scale*99, 20, 15*scale, 44*scale, 5*scale );
rThruster   	= [0;0;0.2];

% Inertia
inertia   = [1.1565   -0.0074    0.0561;...
            -0.0074    1.0380    0.02281;...
             0.0561    0.0228    0.7354];
                    
% Fuel tank
fTank = 49/656;
rTank = (volTank/(4*pi/3)).^(1/3);

% Bus
zBox           = 2.4*max(rTank);
xBox           = 4.8*max(rTank);
yBox           = xBox;
panelThickness = 0.004;

xTank  = 0.8*max(rTank)*1.3;
rATank = [xTank*[1 -1;1 -1];zBox*[1 1]/2];

% Star camera
cameraAperture          = 12.5;
cameraFocalLength       = 25.0;
cameraLengthSunShade    = 35.0;
cameraApertureSunShade	= 25.0;
massCamera              = 0.25;
rCamera                 = 0.4*[xBox -xBox;-yBox yBox;zBox zBox];
uC                      = [0;0;1];
v1                      = Unit([1;-1;-1]);
v2                      = Unit([-1;1;-1]);
b1                      = Q2Mat(U2Q(uC,v1));
b2                      = Q2Mat(U2Q(uC,v2));
bCamera                 = {b1 b2};

% Omni antennas
powerOmni         = 2;
xOmni             = [xBox xBox; yBox -yBox; 0 0]/2;
rOmni             = 0.002;
c                 = Constant('speed of light')*1000; % m/s
fComm             = 2e9; % sband
lOmni             = 0.5*c/fComm;
massOmni          = lOmni*pi*rOmni^2*rhoAluminum;
bOmni             = {[1 0 0;0 0 1;0 -1 0] [1 0 0;0 0 -1;0 1 0]};

% IMU LN-200S
radiusIMU         = 0.0889/2;
hIMU              = 0.0851;
massIMU           = 0.748;
dIMU.manufacturer = 'Northrop Grumman';
dIMU.name         = 'LN-200S';
powerIMU          = 12;

% Sun Sensors
massSunSensor     = 0.035;
xSunSensor        = 0.06;
ySunSensor        = 0.03;
zSunSensor        = 0.012;
bSunSensor        = [1 -1 2 -2 3 -3];
powerSunSensor    = 0.6;

% Processing boards - 3U CompactPCI boards
nBoards           = 5;
powerBoard        = 12;
xChassis          = 0.16 + 0.02;
yChassis          = 0.1 + 0.02;
zChassis          = 0.02*nBoards + 0.02;
massChassis       = 1;

% Solar arrays
massSAD                 = 0.2;
solarPanelThickness     = 0.004;
strutLength             = yBox/3;
nPanels                 = 2;
panelLength             = 1;
panelWidth              = 2;
massSolarPanel          = panelLength*panelWidth*rhoSolarPanel;
solarPanelEff           = 0.295;
zSolarWing              = zBox/2;
arrayMassFront          = 0.5*solarPanelThickness*panelLength*panelWidth*nPanels*rhoGlass;
arrayMassBack           = 0.5*solarPanelThickness*panelLength*panelWidth*nPanels*rhoCarbonFiber;
massStrut               = 0.1;
yPanel                  = 0.03;

bX                      = [ 1 0 0;0 0 -1;0 1  0]';
bY                      = [-1 0 0;0 1  0;0 0 -1];

% Battery
power                     = 0.8*2*1000;
powerNight                = 5;
massBattery               = powerNight*24*15/135; % Saft batteries
volBattery                = powerNight*24*15/250;
wBattery                  = (2*volBattery*lToM3)^(1/3); % One length is half the others

%% Initialize BuildCADModel and create the Core body

BuildCADModel( 'initialize' );
BuildCADModel( 'set name' , 'PlutoLander' );
BuildCADModel( 'set units', 'mks' );

% Core
m = CreateBody('make','name','Core');
BuildCADModel('add body', m );

if( multiBody )
  rHinge = [0;0;strutLength];
else
  rHinge = [0;0;0];
end
m = CreateBody('make','name','SolarWing','rHinge',rHinge,'previousBody',1);
BuildCADModel('add body', m );

if( ~multiBody )
  zPanel = zBox+panelWidth/2;
  zStrut  = zBox;
end

% This creates the connections between the bodies
BuildCADModel( 'compute paths' );

%% Components

if arraysStowed
  % Stow the arrays with a portion of a panel showing
  tStowed = 0.1;
   m = CreateComponent( 'make', 'box', 'x',xBox, 'y',yBox, 'z',tStowed,...
                     'faceColor', 'aluminum', 'rA', [0;0;zBox+tStowed/2], 'mass', 2*massSolarPanel+massStrut,...
                     'name','Solar Arrays Stowed', 'body', 2,...
                     'inside', 0, 'power', 0 );
  BuildCADModel( 'add component', m );
  m = CreateComponent( 'make', 'box', 'x',xBox, 'y',yBox, 'z',solarPanelThickness,...
                       'faceColor', 'solar cell', 'rA', [0;0;zBox+tStowed], 'mass', 0,...
                       'name','Solar Array Face', 'body', 2,...
                       'inside', 0, 'power', -250 );
  BuildCADModel( 'add component', m );
else
  
  % Solar Array 1
  m = CreateComponent( 'make', 'box', 'x',panelWidth, 'y',nPanels*panelLength, 'z',solarPanelThickness,...
                       'faceColor', 'solar cell', 'rA', [0;yPanel+panelLength;zPanel], 'mass', massSolarPanel,...
                       'name','Solar Array +Y', 'body', 2,...
                       'inside', 0, 'power', -power/2 );

  BuildCADModel( 'add component', m );

  m = CreateComponent( 'make', 'box', 'x',panelWidth, 'y',nPanels*panelLength, 'z',solarPanelThickness,...
                       'faceColor', [0 0 0], 'rA', [0;yPanel+panelLength;zPanel-solarPanelThickness], 'mass', 0,...
                       'name','Solar Array +Y back', 'body', 2,...
                       'inside', 0, 'power', 0 );

  BuildCADModel( 'add component', m );


  % Solar Array 2

  m = CreateComponent( 'make', 'box', 'x',panelWidth, 'y',nPanels*panelLength, 'z',solarPanelThickness,...
                       'faceColor', 'solar cell', 'rA', [0;-yPanel-panelLength;zPanel], 'mass', massSolarPanel,...
                       'name','Solar Array -Y', 'body', 2,...
                       'inside', 0, 'power', -power/2 );

  BuildCADModel( 'add component', m );


  m = CreateComponent( 'make', 'box', 'x',panelWidth, 'y',nPanels*panelLength, 'z',solarPanelThickness,...
                       'faceColor', [0 0 0], 'rA', [0;-yPanel-panelLength;zPanel-solarPanelThickness], 'mass', 0,...
                       'name','Solar Array -Y back', 'body', 2,...
                       'inside', 0, 'power', 0 );

  BuildCADModel( 'add component', m );

  % Vertical strut
  m = CreateComponent( 'make', 'cylinder', 'rUpper', 0.01, 'rLower', 0.01, 'h', panelWidth/2, 'n', 24, 'rA',[0;0;zStrut],...
                           'name', 'Motor', 'body', 1, 'mass', massStrut,'power',0, ...
                           'faceColor', [0 0 0], 'inside', 1);
  BuildCADModel( 'add component', m );
end


%% Bus Frame

[v, f]    = PanelFrame( xBox, yBox, panelThickness, panelThickness );
massFrame	= 2*(xBox + yBox)*panelThickness^2*rhoCarbonFiber;
m = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f,...
                     'faceColor', 'gold foil','rA', [0;0;zBox-2*panelThickness],...
                     'mass', massFrame, 'name', 'Top Frame', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );

v = ([1 0 0; 0 1 0; 0 0 -1]*v')';
m = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f,...
                     'faceColor', 'gold foil','rA', [0;0;2*panelThickness],...
                     'mass', massFrame, 'name', 'Bottom Frame', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );

z1     = 2*panelThickness;
z2     = z1 + zBox-2*panelThickness; 
c      = [];
c.x    = [ -0.250 0     0     0.250  0.250  0      0     -0.250]*inToM;
c.y    = [  0.375 0.375 0.125 0.125 -0.375 -0.375 -0.125 -0.125]*inToM;
[v, f] = ShapedStrut( [0;0;z1], [0;0;z2], c );
angle  = 0;
sX     = [1  1 -1 -1];
sY     = [1 -1 -1  1];
massStrut = panelThickness^2*zBox*rhoCarbonFiber;
for k = 1:4
  angle = angle + pi/2;
  xF    = sX(k)*(xBox/2 - panelThickness/2);
  yF    = sY(k)*(yBox/2 - panelThickness/2);
  b     = [cos(angle) sin(angle) 0;-sin(angle) cos(angle) 0;0 0 1];
  vR    = (b*v')';
  m     = CreateComponent( 'make', 'generic', 'vertex', vR, 'face', f,...
                           'faceColor', 'gold foil','rA', [xF;yF;0], ...
                           'mass', massStrut, 'name', ['z strut' num2str(k)], 'body', 1,...
                           'inside',0 );
  BuildCADModel( 'add component', m );
end

%% Panels

panelName = {'+X' '-X' '+Y' '-Y' '+Z'  '-Z'};
color     = {'gold foil' 'gold foil' 'gold foil' 'gold foil' 'gold foil' 'radiator'};
xLoc      = (xBox - panelThickness)/2;
yLoc      = (yBox - panelThickness)/2;
zLoc      = (zBox - panelThickness)/2;
			 
wX        = xBox - 2*panelThickness;
wY        = yBox - 2*panelThickness;
wZ        = zBox - 2*panelThickness;

th        = panelThickness;
zH        = zBox/2;

rAP       = [ xLoc -xLoc 0     0      0       0 ;...
              0     0    yLoc -yLoc   0       0;...
              zH    zH   zH    zH    zBox     0];
			 
dP        =     [ th  th wX  wX  wX  wX ;...
                  wY  wY th  th  wY  wY;...
                  wZ  wZ wZ  wZ  th  th];            

for k = 1:6
    massPanel = dP(1,k)*dP(2,k)*dP(3,k)*rhoCarbonFiber;
    m = CreateComponent( 'make', 'box', 'x', dP(1,k), 'y',dP(2,k), 'z',dP(3,k),...
                         'faceColor', color{k}, 'rA', rAP(:,k), 'mass', massPanel,...
                         'name', ['Panel ' panelName{k}], 'body', 1,...
                         'inside', 0 );
    BuildCADModel( 'add component', m );
end

% Landing legs

rL        = 35;
[v, f]    = LandingLegsCAD('scale',0.012,'xy spacing',rL);

m         = CreateComponent( 'make', 'generic', 'v',v,'f',f,...
                             'faceColor', [1 0.84 0] ,'rA', [0;0;0],...
                             'name', 'Landing Legs','inside',0);
BuildCADModel( 'add component', m );

% Battery
rB        = 0.5*([0;yBox;0] + [-2*panelThickness;-wBattery-2*panelThickness;wBattery/2]);
m         = CreateComponent( 'make', 'box','x', wBattery, 'y', wBattery, 'z', wBattery/2,...
                             'faceColor', [0 1 0] ,'rA', rB,'mass',massBattery,...
                             'name', 'Battery 1','inside',1);
BuildCADModel( 'add component', m );

% Omni antennas
for k = 1:2
    m = CreateComponent( 'make', 'cylinder', 'rUpper', rOmni, 'rLower', rOmni, 'h', lOmni, 'n', 24, 'rA',xOmni(:,k),'b',bOmni{k},...
                         'name', sprintf('Omni %d',k), 'body', 1, 'mass', massOmni,'power',powerOmni, ...
                         'faceColor', [0 0 0], 'inside', 1);
    BuildCADModel( 'add component', m );
end

% Fuel tanks - wet
for k = 1:nTanks
  m         = CreateComponent( 'make', 'sphere','radius', rTank(k),'n',20,...
                             'faceColor', [0 1 0] ,'rA', rATank(:,k),'mass',(1+fTank)*massFuel/nTanks,...
                             'name', sprintf('HPGP Tank %d',k),'inside',1);
                           
  BuildCADModel( 'add component', m );
end

% Star cameras
[v, f]  = StarCameraBasicModel( cameraAperture, cameraFocalLength, cameraApertureSunShade, cameraLengthSunShade );

m         = CreateComponent( 'make', 'generic', 'v', v, 'f', f, 'b', bCamera{1},...
                             'rA', rCamera(:,1), 'name', 'Star Camera 1', 'body', 1, 'mass', massCamera );
BuildCADModel( 'add component', m );

m         = CreateComponent( 'make', 'generic', 'v', v, 'f', f, 'b', bCamera{2},...
                             'rA', rCamera(:,2), 'name', 'Star Camera 2', 'body', 1, 'mass', massCamera );
BuildCADModel( 'add component', m );

% IMU
rIMU            = [ xBox/2-radiusIMU-4*panelThickness;...
                    yBox/2-radiusIMU-4*panelThickness;...
                    panelThickness];
m = CreateComponent( 'make', 'cylinder', 'rUpper', radiusIMU, 'rLower',radiusIMU,'h',hIMU,...
                     'inside', 1,'deviceInfo',dIMU,'mass',massIMU,...
                     'rA', rIMU, 'name', 'IMU', 'body', 1, 'faceColor', [0 0 1], 'power', powerIMU );
BuildCADModel( 'add component', m );

% Chassis
m = CreateComponent( 'make', 'box', 'x', xChassis, 'y', yChassis, 'z', zChassis, 'faceColor', [0 0.5 0.5],...
                     'rA', [-xBox/2 + xChassis/2 + 2*panelThickness; -yBox/2 + yChassis/2 + 2*panelThickness; zBox - zChassis/2 - 2*panelThickness],...
                     'mass', massChassis, 'name', 'C&DH Box', 'body', 1, 'inside', 1 );
BuildCADModel( 'add component', m );

m = CreateComponent( 'make', 'generic', 'v', vT, 'f', fT, 'faceColor', [0 0.5 0.5],...
                     'rA',  rThruster, 'mass', massThruster, 'name', 'Thruster', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );

% Misc payload
rPayload = [xTank*[1 -1;-1 1];zBox*[1 1]/2];
%BuildCADModel( 'update body mass properties' );
g = BuildCADModel( 'get model' );
mPayload = massTotal-g.mass.mass;
for k = 1:2
  m = CreateComponent( 'make', 'box', 'x',2*rTank(1), 'y', 2*rTank(1), 'z',2*rTank(1),...
                             'faceColor', 'magenta' ,'rA', rPayload(:,k),'mass',mPayload/2,...
                             'name', sprintf('Payload %d',k),'inside',1);
                           
  BuildCADModel( 'add component', m );
end



%% Add subsystems
if 1
  BuildCADModel( 'add subsystem', 'ACS',                    {'star camera','rwa','imu'} );
  BuildCADModel( 'add subsystem', 'Propulsion',             {'thruster','tank'} );
  BuildCADModel( 'add subsystem', 'Telemetry and Command',	{'C&DH', 'omni', 'signal','processor', 'antenna', 'board'} );
  BuildCADModel( 'add subsystem', 'Power Lander',           {'solar array', 'battery', 'motor'} );
  BuildCADModel( 'add subsystem', 'Structure',              {'legs', 'panel', 'frame', 'strut'} );
  BuildCADModel( 'add subsystem', 'Payload',                {'payload'} );
end

%% Update the mass properties to produce the tables

BuildCADModel( 'update body mass properties' );

g = BuildCADModel( 'get model' );
BuildCADModel( 'show vehicle' )

CreateReport( g, 'tex', FileFullpath('PlutoLanderMass'),    'mass',  1, 1, 1 )
CreateReport( g, 'tex', FileFullpath('PlutoLanderPower'),  'power',  1, 1, 1 )
CreateReport( g, 'txt', [], 'mass',  1, 0, false );
CreateReport( g, 'txt', [], 'power', 1, 0, false );


%% Export to and obj (graphics) file

if arraysStowed
  SaveStructure(g, FileFullpath('PlutoLander-Stowed'));
else
  ExportOBJ( g, FileFullpath('PlutoLander'));
  SaveStructure(g, FileFullpath('PlutoLander'));
end


%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% PSS internal file version information
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% $Date:   PlutoLanderCAD.m $
% $Id: 5e07d26b3705f1ecad7ba150358b1b88ad82a4cd $

##### SOURCE END #####
-->
</body>
</html>
