<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>Build the CAD model of the Asteroid Prospector spacecraft.</title>
<meta name="generator" content="MATLAB 24.1">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-01-22">
<meta name="DC.source" content="BuildAsteroidProspector.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h1>Build the CAD model of the Asteroid Prospector spacecraft.</h1>
<!--introduction-->
<p>This demo illustrates the construction of a comprehensive spacecraft capable of visiting asteroids and performing geology tasks using a pair of robot arms. The thruster layout is previously saved in RCS-AsteroidProspector.mat.</p>
<p>See also BuildCADModel, CreateBody, CreateComponent, CreateReport, ExportOBJ, ICONS, PanelFrame, ThrusterPatch, XenonTank, Constant, FileFullpath, ShapedStrut, Date2JD, Product, AddRobotArm, DesignAsteroidProspector</p>
<!--/introduction-->
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#2">Design the mission</a>
</li>
<li>
<a href="#3">Initialize</a>
</li>
<li>
<a href="#4">Bodies</a>
</li>
<li>
<a href="#5">Components</a>
</li>
<li>
<a href="#6">Update the mass properties to produce the tables</a>
</li>
<li>
<a href="#7">Export the model and generate reports</a>
</li>
</ul>
</div>
<pre class="codeinput">
<span class="comment">%--------------------------------------------------------------------------</span>
<span class="comment">%   Copyright (c) 2012 Princeton Satellite Systems, Inc.</span>
<span class="comment">%   All rights reserved.</span>
<span class="comment">%--------------------------------------------------------------------------</span>
<span class="comment">%   Since version 10.</span>
<span class="comment">%   2015.1: Renamed, previously named BuildAsteroidSat.m</span>
<span class="comment">%--------------------------------------------------------------------------</span>
</pre>
<h2 id="2">Design the mission</h2>
<pre>------------------</pre>
<pre class="codeinput">
<span class="comment">% Mission date</span>
<span class="comment">%  -----------</span>
date            = [2015 5 7 0 0 0];
jD              = Date2JD(date);

<span class="comment">% Total mass</span>
<span class="comment">%-----------</span>
mTotal          = 27; <span class="comment">% 3U x 3U x 3U</span>
mF              = 15; <span class="comment">% kg Xenon</span>

<span class="comment">% Propulsion</span>
<span class="comment">%-----------</span>
rhoRCS          = 1240; <span class="comment">% HPGP propellant</span>
rhoXenon        = 2750;

<span class="comment">% One u is 10 cm</span>
<span class="comment">%-----------------</span>
u               = 0.1;
zBox            = 3*u;
xBox            = 4*u;
yBox            = 3*u;

busDim          = sprintf(<span class="string">'%4.1f $\\times$ %4.1f $\\times$ %4.1f'</span>,xBox*100,yBox*100,zBox*100);

<span class="comment">% Size data for components</span>
<span class="comment">%-------------------------</span>
massOmni        = 0.2;
powerOmni       = 2;
xOmni           = [xBox -yBox; yBox yBox; zBox zBox];
rOmni           = 0.002;
c               = Constant(<span class="string">'speed of light'</span>);
fComm           = 34e9;
lOmni           = 0.5*c/fComm;

dThruster       = load(<span class="string">'RCS-AsteroidProspector.mat'</span>);
massThruster    = 0.37/2;
powerRCS        = 1;

dimProc         = [0.09 0.095 0.6*0.0254];
massBoard       = Product(dimProc)*2700;
nBoards         = 5;
powerBoard      = 4;

powerRWA        = 2;
nRWA            = 3;
wRWA            = 0.04;
massRWA         = 0.1;
xRWA            = [ xBox/2-wRWA  -xBox/2+wRWA -xBox/2+wRWA;<span class="keyword">...</span>
                    -2*wRWA             0       2*wRWA;<span class="keyword">...</span>
                       wRWA/2       wRWA/2       wRWA/2];

panelThickness  = 0.004;
inToM           = 0.0254;
strutLength     = yBox/2;
nPanels         = 4;
panelLength     = 0.3;
panelWidth      = 0.3;
solarPanelEff   = 0.295;
zSolarWing      = zBox/2;

yPanel          = strutLength + yBox/2;

<span class="comment">% RCS</span>
<span class="comment">%-----</span>
mFRCS       = 1.7;
vRCS        = mFRCS/rhoRCS;
rRCS        = (0.75*0.5*vRCS/pi)^(1/3); <span class="comment">% Two tanks</span>

rTank       = [-xBox/2+rRCS  xBox/2-rRCS;<span class="keyword">...</span>
                yBox/2-rRCS -yBox/2+rRCS;<span class="keyword">...</span>
                rRCS         rRCS];

<span class="comment">% Battery</span>
<span class="comment">%---------</span>
volumeBattery = 1.8; <span class="comment">% L</span>

<span class="comment">% Solar arrays</span>
<span class="comment">%-------------</span>
arrayMass	  = 9;
bX          = [ 1 0 0;0 0 -1;0 1  0]';
bY          = [-1 0 0;0 1  0;0 0 -1];
</pre>
<h2 id="3">Initialize</h2>
<pre class="codeinput">
<span class="comment">%------------</span>
BuildCADModel( <span class="string">'initialize'</span> );
BuildCADModel( <span class="string">'set name'</span> , <span class="string">'Asteroid Prospector'</span> );
BuildCADModel( <span class="string">'set units'</span>, <span class="string">'mks'</span> );
</pre>
<h2 id="4">Bodies</h2>
<pre class="codeinput">
<span class="comment">%---------</span>

<span class="comment">% Core</span>
<span class="comment">%-----</span>
m = CreateBody(<span class="string">'make'</span>,<span class="string">'name'</span>,<span class="string">'Core'</span>,<span class="string">'rHinge'</span>,[0;0;0],<span class="string">'bHinge'</span>,eye(3));
BuildCADModel(<span class="string">'add body'</span>, m );

m = CreateBody(<span class="string">'make'</span>,<span class="string">'name'</span>,<span class="string">'SolarWing1'</span>,<span class="string">'rHinge'</span>,[0;0;0],<span class="string">'bHinge'</span>,eye(3),<span class="keyword">...</span>
               <span class="string">'previousBody'</span>,1);
BuildCADModel(<span class="string">'add body'</span>, m );

m = CreateBody(<span class="string">'make'</span>,<span class="string">'name'</span>,<span class="string">'SolarWing2'</span>,<span class="string">'rHinge'</span>,[0;0;0],<span class="string">'bHinge'</span>,eye(3),<span class="keyword">...</span>
               <span class="string">'previousBody'</span>,1);
BuildCADModel(<span class="string">'add body'</span>, m );

<span class="comment">% Add robot arm</span>
<span class="comment">%------------------</span>
k = 1;
link(k).u       = [0;0;1];
link(k).r       = [0;0;0.02];
link(k).mass    = 0.02;
link(k).radius	= 0.01;
link(k).b       = eye(3);
link(k).power   = 1;
link(k).name    = <span class="string">'shoulder'</span>;
k               = k + 1;

link(k).u       = [1;0;0];
link(k).angle   = 0;
link(k).r       = [0;0;0.1];
link(k).mass    = 0.1;
link(k).radius	= 0.01;
link(k).b       = eye(3);
link(k).power   = 1;
link(k).name    = <span class="string">'upper arm'</span>;
k               = k + 1;

link(k).u       = [1;0;0];
link(k).angle   = pi/8;
link(k).r       = [0;0;0.1];
link(k).mass    = 0.1;
link(k).radius	= 0.01;
link(k).b       = eye(3);
link(k).power   = 1;
link(k).name    = <span class="string">'fore arm'</span>;
k               = k + 1;

link(k).u       = [1;0;0];
link(k).r       = [0;0;0.02];
link(k).angle   = pi/4;
link(k).mass    = 0.02;
link(k).radius	= 0.01;
link(k).b       = eye(3);
link(k).power   = 1;
link(k).name    = <span class="string">'wrist'</span>;


AddRobotArm( <span class="string">'add bodies'</span>, 1, 4, [ yBox/4;0;zBox], link );
AddRobotArm( <span class="string">'add bodies'</span>, 1, 8, [-yBox/4;0;zBox], link );

<span class="comment">% This creates the connections between the bodies</span>
<span class="comment">%------------------------------------------------</span>
BuildCADModel( <span class="string">'compute paths'</span> );
</pre>
<h2 id="5">Components</h2>
<pre class="codeinput">AddRobotArm( <span class="string">'add components'</span>, 1, 4, [ yBox/4;0;zBox], link );
AddRobotArm( <span class="string">'add components'</span>, 1, 8, [-yBox/4;0;zBox], link );

<span class="comment">% Solar Array 1</span>
<span class="comment">%---------------</span>
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'solar array front'</span>, <span class="string">'z'</span>, panelLength, <span class="string">'x'</span>, panelWidth,<span class="keyword">...</span>
                     <span class="string">'nZ'</span>, nPanels, <span class="string">'nX'</span>, 1, <span class="string">'dirZ'</span>, 1, <span class="string">'inside'</span>, 0, <span class="keyword">...</span>
                     <span class="string">'theta'</span>, 0, <span class="string">'electricalConversionEfficiency'</span>, solarPanelEff, <span class="string">'b'</span>, bY*bX,<span class="keyword">...</span>
                     <span class="string">'rA'</span>, [0;yPanel;zSolarWing], <span class="string">'mass'</span>, arrayMass/2, <span class="string">'cM'</span>, [0;0;0],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Solar Array +Y Front'</span>, <span class="string">'body'</span>, 2, <span class="string">'faceColor'</span>, <span class="string">'solar cell'</span> );
BuildCADModel( <span class="string">'add component'</span>, m );

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'solar array back'</span>, <span class="string">'z'</span>, panelLength, <span class="string">'x'</span>, panelWidth,<span class="keyword">...</span>
                     <span class="string">'nZ'</span>, nPanels, <span class="string">'nX'</span>, 1, <span class="string">'dirZ'</span>, 1,<span class="keyword">...</span>
                     <span class="string">'theta'</span>, 0, <span class="string">'b'</span>, bY*bX, <span class="string">'inside'</span>, 0, <span class="keyword">...</span>
                     <span class="string">'rA'</span>, [0;yPanel;zSolarWing], <span class="string">'mass'</span>, arrayMass/2, <span class="string">'cM'</span>, [0;0;0],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Solar Array +Y Back'</span>, <span class="string">'body'</span>, 2, <span class="string">'faceColor'</span>, <span class="string">'black'</span> );
BuildCADModel( <span class="string">'add component'</span>, m );


<span class="comment">% Solar Array 2</span>
<span class="comment">%---------------</span>
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'solar array front'</span>, <span class="string">'z'</span>, panelLength, <span class="string">'x'</span>, panelWidth,<span class="keyword">...</span>
                     <span class="string">'nZ'</span>, nPanels, <span class="string">'nX'</span>, 1, <span class="string">'dirZ'</span>, 1,<span class="string">'inside'</span>, 0, <span class="keyword">...</span>
                     <span class="string">'theta'</span>, 0, <span class="string">'electricalConversionEfficiency'</span>, solarPanelEff, <span class="string">'b'</span>, bX',<span class="keyword">...</span>
                     <span class="string">'rA'</span>, [0;-yPanel;zSolarWing], <span class="string">'mass'</span>, 10, <span class="string">'cM'</span>, [0;0;0],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Solar Array -Y Front'</span>, <span class="string">'body'</span>, 3, <span class="string">'faceColor'</span>, <span class="string">'solar cell'</span> );
BuildCADModel( <span class="string">'add component'</span>, m );

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'solar array back'</span>, <span class="string">'z'</span>, panelLength, <span class="string">'x'</span>, panelWidth,<span class="keyword">...</span>
                     <span class="string">'nZ'</span>, nPanels, <span class="string">'nX'</span>, 1, <span class="string">'dirZ'</span>, 1,<span class="keyword">...</span>
                     <span class="string">'theta'</span>, 0, <span class="string">'b'</span>, bX',<span class="string">'inside'</span>, 0, <span class="keyword">...</span>
                     <span class="string">'rA'</span>, [0;-yPanel;zSolarWing], <span class="string">'mass'</span>, 10, <span class="string">'cM'</span>, [0;0;0],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Solar Array -Y Back'</span>, <span class="string">'body'</span>, 3, <span class="string">'faceColor'</span>, <span class="string">'black'</span> );
BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">% Solar array drives</span>
<span class="comment">%--------------------</span>
rD = [0 0;-yBox yBox;zBox zBox]/2;
<span class="keyword">for</span> k = 1:size(rD,2)
    n = sprintf(<span class="string">'Solar Array Drive %d'</span>,k);
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, 0.04, <span class="string">'rLower'</span>, 0.04, <span class="string">'h'</span>, 0.01,<span class="string">'n'</span>,20,<span class="keyword">...</span>
                     <span class="string">'inside'</span>, 0, <span class="string">'b'</span>, [1 0 0;0 0 -1;0 1 0], <span class="string">'rA'</span>, rD(:,k), <span class="string">'mass'</span>, 0.1,<span class="keyword">...</span>
                     <span class="string">'name'</span>, n, <span class="string">'body'</span>, 1, <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span> );
    BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>


<span class="comment">% Frame</span>
<span class="comment">%-------</span>
[v, f] = PanelFrame( xBox, yBox, panelThickness, panelThickness );
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'rA'</span>, [0;0;zBox-2*panelThickness],<span class="keyword">...</span>
                     <span class="string">'mass'</span>, 10, <span class="string">'name'</span>, <span class="string">'Top Frame'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );

v = ([1 0 0; 0 1 0; 0 0 -1]*v')';
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'rA'</span>, [0;0;2*panelThickness],<span class="keyword">...</span>
                     <span class="string">'mass'</span>, 10, <span class="string">'name'</span>, <span class="string">'Bottom Frame'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );

z1     = 2*panelThickness;
z2     = z1 + zBox-2*panelThickness;
c      = [];
c.x    = [ -0.250 0     0     0.250  0.250  0      0     -0.250]*inToM;
c.y    = [  0.375 0.375 0.125 0.125 -0.375 -0.375 -0.125 -0.125]*inToM;
[v, f] = ShapedStrut( [0;0;z1], [0;0;z2], c );
angle  = 0;
sX     = [1  1 -1 -1];
sY     = [1 -1 -1  1];
<span class="keyword">for</span> k = 1:4
  angle = angle + pi/2;
  xF    = sX(k)*(xBox/2 - panelThickness/2);
  yF    = sY(k)*(yBox/2 - panelThickness/2);
  b     = [cos(angle) sin(angle) 0;-sin(angle) cos(angle) 0;0 0 1];
  vR    = (b*v')';
  m     = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, vR, <span class="string">'face'</span>, f,<span class="keyword">...</span>
                           <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'rA'</span>, [xF;yF;0], <span class="keyword">...</span>
                           <span class="string">'mass'</span>, 10, <span class="string">'name'</span>, [<span class="string">'z strut'</span> num2str(k)], <span class="string">'body'</span>, 1,<span class="keyword">...</span>
                           <span class="string">'inside'</span>,0 );
  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>


<span class="comment">% Panels</span>
<span class="comment">%-------</span>
panelName = {<span class="string">'+X'</span> <span class="string">'-X'</span> <span class="string">'+Y'</span> <span class="string">'-Y'</span> <span class="string">'+Z'</span>  <span class="string">'-Z'</span>};
color     = {<span class="string">'gold foil'</span> <span class="string">'gold foil'</span> <span class="string">'radiator'</span> <span class="string">'radiator'</span> <span class="string">'aluminum'</span> <span class="string">'aluminum'</span>};
xLoc      = (xBox - panelThickness)/2;
yLoc      = (yBox - panelThickness)/2;
zLoc      = (zBox - panelThickness)/2;

wX        = xBox - 2*panelThickness;
wY        = yBox - 2*panelThickness;
wZ        = zBox - 2*panelThickness;

th        = panelThickness;
zH        = zBox/2;

rAP       = [xLoc -xLoc 0     0      0       0 ;<span class="keyword">...</span>
             0     0    yLoc -yLoc   0       0;<span class="keyword">...</span>
			 zH    zH   zH    zH    zBox     0];

dP        =     [th  th wX  wX  wX  wX ;<span class="keyword">...</span>
                 wY  wY th  th  wY  wY;<span class="keyword">...</span>
                 wZ  wZ wZ  wZ  th  th];

<span class="keyword">for</span> k = 1:6
  m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, dP(1,k), <span class="string">'y'</span>,dP(2,k), <span class="string">'z'</span>,dP(3,k),<span class="keyword">...</span>
                       <span class="string">'faceColor'</span>, color{k}, <span class="string">'rA'</span>, rAP(:,k), <span class="string">'mass'</span>, 10,<span class="keyword">...</span>
                       <span class="string">'name'</span>, [<span class="string">'Panel '</span> panelName{k}], <span class="string">'body'</span>, 1,<span class="keyword">...</span>
                       <span class="string">'inside'</span>, 0 );
  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>


<span class="comment">% Xenon fuel tank</span>
<span class="comment">%-----------------</span>
[v, f]    = XenonTank( mF );
m         = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>,<span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f,<span class="keyword">...</span>
                             <span class="string">'faceColor'</span>, <span class="string">'steel'</span> ,<span class="string">'rA'</span>, [0;0;0],<span class="keyword">...</span>
                             <span class="string">'name'</span>, [<span class="string">'Xenon'</span> <span class="string">' tank'</span>],<span class="string">'inside'</span>,1);
BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">% Batteries</span>
<span class="comment">%-----------</span>
lToM3     = 0.001;
xB        = (volumeBattery*lToM3)^(1/3);

rB        = 0.5*([0;yBox;0] + [0;-xB;xB/2]);
m         = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>,<span class="string">'x'</span>, xB, <span class="string">'y'</span>, xB, <span class="string">'z'</span>, xB/2,<span class="keyword">...</span>
                             <span class="string">'faceColor'</span>, [0 1 0] ,<span class="string">'rA'</span>, rB,<span class="keyword">...</span>
                             <span class="string">'name'</span>, <span class="string">'Battery 1'</span>,<span class="string">'inside'</span>,1);
BuildCADModel( <span class="string">'add component'</span>, m );

rB        = 0.5*([0;-yBox;0] + [0;xB;xB/2]);
m         = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>,<span class="string">'x'</span>, xB, <span class="string">'y'</span>, xB, <span class="string">'z'</span>, xB/2,<span class="keyword">...</span>
                             <span class="string">'faceColor'</span>, [0 1 0] ,<span class="string">'rA'</span>, rB,<span class="keyword">...</span>
                             <span class="string">'name'</span>, <span class="string">'Battery 2'</span>,<span class="string">'inside'</span>,1);
BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">% Antenna</span>
<span class="comment">%-----------</span>
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'ellipsoid'</span>, <span class="string">'name'</span>, <span class="string">'Antenna'</span>,<span class="keyword">...</span>
                     <span class="string">'body'</span>, 1, <span class="string">'abc'</span>, [0.3 0.3 0.1], <span class="string">'thetaUpper'</span>,pi/4,<span class="string">'b'</span>,[0 0 1;0 1 0;-1 0 0],<span class="keyword">...</span>
					 <span class="string">'n'</span>,10, <span class="string">'rA'</span>,[-xBox/2-0.1;0;zBox/2], <span class="string">'faceColor'</span>, [0.5 0.5 0], <span class="string">'edgeColor'</span>,[1 1 1]);
BuildCADModel(<span class="string">'add component'</span>, m );

<span class="comment">% Xenon Thruster</span>
<span class="comment">%--------------------</span>
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, 0.02, <span class="string">'rLower'</span>, 0.02, <span class="string">'h'</span>, 0.03,<span class="string">'n'</span>,20,<span class="keyword">...</span>
                     <span class="string">'inside'</span>, 0, <span class="string">'rA'</span>, [0;0;-0.03], <span class="string">'mass'</span>, 0.1,<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Ion Thruster'</span>, <span class="string">'body'</span>, 1, <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span> );
BuildCADModel( <span class="string">'add component'</span>, m );


<span class="comment">% Processors</span>
<span class="comment">%------------</span>
z = 0;
xProc = 0.5*(xBox-dimProc(1));
yProc = 0.5*(yBox-dimProc(1));
<span class="keyword">for</span> k = 1:nBoards
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, dimProc(1), <span class="string">'y'</span>, dimProc(1), <span class="string">'z'</span>, dimProc(3), <span class="string">'rA'</span>,[xProc;yProc;z],<span class="keyword">...</span>
                         <span class="string">'name'</span>, sprintf(<span class="string">'Board %d'</span>,k), <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massBoard,<span class="string">'power'</span>,powerBoard, <span class="keyword">...</span>
                         <span class="string">'faceColor'</span>, [1 0 0], <span class="string">'inside'</span>, 1);
    BuildCADModel( <span class="string">'add component'</span>, m );
    z = z + dimProc(3);
<span class="keyword">end</span>

<span class="comment">% Reaction wheels</span>
<span class="comment">%-----------------</span>
<span class="keyword">for</span> k = 1:nRWA
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, wRWA, <span class="string">'y'</span>, wRWA, <span class="string">'z'</span>, wRWA, <span class="string">'rA'</span>,xRWA(:,k),<span class="keyword">...</span>
                         <span class="string">'name'</span>, sprintf(<span class="string">'RWA %d'</span>,k), <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massRWA,<span class="string">'power'</span>,powerRWA, <span class="keyword">...</span>
                         <span class="string">'faceColor'</span>, [1 1 0], <span class="string">'inside'</span>, 1);
    BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>

<span class="comment">% Omni antennas</span>
<span class="comment">%---------------</span>
<span class="keyword">for</span> k = 1:2
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, rOmni, <span class="string">'rLower'</span>, rOmni, <span class="string">'h'</span>, lOmni, <span class="string">'n'</span>, 24, <span class="string">'rA'</span>,xOmni(:,k),<span class="keyword">...</span>
                         <span class="string">'name'</span>, sprintf(<span class="string">'Omni %d'</span>,k), <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massOmni,<span class="string">'power'</span>,powerOmni, <span class="keyword">...</span>
                         <span class="string">'faceColor'</span>, [0 0 0], <span class="string">'inside'</span>, 1);
    BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>

<span class="comment">% Thrusters</span>
<span class="comment">%-----------</span>
<span class="keyword">for</span> k = 1:8
    [v, f] = ThrusterPatch( dThruster.uThruster(:,k), 0.01, 0.02, 8, 1 );
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f, <span class="string">'rA'</span>, dThruster.rThruster(:,k),<span class="keyword">...</span>
                         <span class="string">'name'</span>, sprintf(<span class="string">'Thruster %d'</span>,k), <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massThruster, <span class="string">'power'</span>,powerRCS,<span class="keyword">...</span>
                         <span class="string">'faceColor'</span>, [0.4 0.4 0.4], <span class="string">'inside'</span>, 1);
    BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>

<span class="comment">% RCS Fuel tanks</span>
<span class="comment">%----------------</span>
<span class="keyword">for</span> k = 1:size(rTank,2)
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'fuel tank'</span>,<span class="string">'name'</span>, <span class="string">'Fuel Tank'</span>,<span class="keyword">...</span>
                         <span class="string">'body'</span>, 1,<span class="string">'radius'</span>, rRCS,<span class="string">'mass'</span>,mFRCS/2,<span class="keyword">...</span>
                         <span class="string">'rA'</span>,rTank(:,k), <span class="string">'faceColor'</span>,[0.7 0.7 0.7]);

    BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>

<span class="comment">% ICONS sensor and deployment box</span>
<span class="comment">%---------------------------------</span>
[v, f]    = ICONS;
massICONS = 0.5;
wICONS    = 0.1;
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f, <span class="string">'rA'</span>, [0.4*xBox;0.4*yBox;zBox],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'ICONS'</span>, <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massICONS,<span class="string">'power'</span>,5*0.7+4, <span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, [1 0.2 0.7], <span class="string">'inside'</span>, 0);
BuildCADModel( <span class="string">'add component'</span>, m );

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, wICONS, <span class="string">'y'</span>, wICONS, <span class="string">'z'</span>,wICONS, <span class="string">'rA'</span>, [0.4*xBox;0.4*yBox;zBox-wICONS/2],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'ICONS Launch Box'</span>, <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massICONS,<span class="string">'power'</span>,5*0.7+4, <span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, [0.2 0.2 0.7], <span class="string">'inside'</span>, 0);
BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">% Add subsystems</span>
<span class="comment">%----------------</span>
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'acs'</span>,        {<span class="string">'ICONS'</span>,<span class="string">'rwa'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'propulsion'</span>, {<span class="string">'thruster'</span>, <span class="string">'tank'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'tt&amp;c'</span>,       {<span class="string">'C&amp;DH'</span>, <span class="string">'omni'</span>, <span class="string">'signal'</span>,<span class="string">'processor'</span>, <span class="string">'antenna'</span>, <span class="string">'board'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'mechanism'</span>,  {<span class="string">'drive'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'power'</span>,      {<span class="string">'solar array'</span>, <span class="string">'battery'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'structure'</span>,  {<span class="string">'support'</span>, <span class="string">'frame'</span>, <span class="string">'strut'</span>, <span class="string">'panel'</span>} );
</pre>
<img vspace="5" hspace="5" src="BuildAsteroidProspector_01.png" alt=""> <h2 id="6">Update the mass properties to produce the tables</h2>
<pre class="codeinput">
<span class="comment">%--------------------------------------------------</span>
BuildCADModel( <span class="string">'update body mass properties'</span> );
</pre>
<img vspace="5" hspace="5" src="BuildAsteroidProspector_02.png" alt=""> <h2 id="7">Export the model and generate reports</h2>
<pre class="codeinput">g = BuildCADModel( <span class="string">'get model'</span>);
BuildCADModel(<span class="string">'show vehicle'</span>)

CreateReport( g, <span class="string">'tex'</span>, FileFullpath(<span class="string">'AsteroidProspectorMassReport'</span>),  <span class="string">'mass'</span>,  1, 1, 1 )
CreateReport( g, <span class="string">'tex'</span>, FileFullpath(<span class="string">'AsteroidProspectorPowerReport'</span>), <span class="string">'power'</span>, 1, 1, 1 )


<span class="comment">% Export to obj</span>
<span class="comment">%--------------</span>
ExportOBJ(g,FileFullpath(<span class="string">'AsteroidProspector'</span>));


<span class="comment">%--------------------------------------</span>
<span class="comment">% PSS internal file version information</span>
<span class="comment">%--------------------------------------</span>

<span class="comment">% $Id: 98ddd7fb9969b4cdc7d943fc3521e51f43d9bad7 $</span>
</pre>
<img vspace="5" hspace="5" src="BuildAsteroidProspector_03.png" alt=""> <img vspace="5" hspace="5" src="BuildAsteroidProspector_04.png" alt=""> <p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2024a</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% Build the CAD model of the Asteroid Prospector spacecraft.
% This demo illustrates the construction of a comprehensive spacecraft
% capable of visiting asteroids and performing geology tasks using a pair
% of robot arms. The thruster layout is previously saved in
% RCS-AsteroidProspector.mat.
%
% See also BuildCADModel, CreateBody, CreateComponent, CreateReport, 
% ExportOBJ, ICONS, PanelFrame, ThrusterPatch, XenonTank, Constant, 
% FileFullpath, ShapedStrut, Date2JD, Product, AddRobotArm,
% DesignAsteroidProspector

%%
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%   Copyright (c) 2012 Princeton Satellite Systems, Inc.
%   All rights reserved.
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%   Since version 10.
%   2015.1: Renamed, previously named BuildAsteroidSat.m
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

%% Design the mission
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

% Mission date
%  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
date            = [2015 5 7 0 0 0];
jD              = Date2JD(date);

% Total mass
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
mTotal          = 27; % 3U x 3U x 3U
mF              = 15; % kg Xenon

% Propulsion
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
rhoRCS          = 1240; % HPGP propellant
rhoXenon        = 2750;

% One u is 10 cm
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
u               = 0.1;
zBox            = 3*u;
xBox            = 4*u;
yBox            = 3*u;

busDim          = sprintf('%4.1f $\\times$ %4.1f $\\times$ %4.1f',xBox*100,yBox*100,zBox*100);

% Size data for components
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
massOmni        = 0.2;
powerOmni       = 2;
xOmni           = [xBox -yBox; yBox yBox; zBox zBox];
rOmni           = 0.002;
c               = Constant('speed of light');
fComm           = 34e9;
lOmni           = 0.5*c/fComm;

dThruster       = load('RCS-AsteroidProspector.mat');
massThruster    = 0.37/2;
powerRCS        = 1;

dimProc         = [0.09 0.095 0.6*0.0254];
massBoard       = Product(dimProc)*2700;
nBoards         = 5;
powerBoard      = 4;

powerRWA        = 2;
nRWA            = 3;
wRWA            = 0.04;
massRWA         = 0.1;
xRWA            = [ xBox/2-wRWA  -xBox/2+wRWA -xBox/2+wRWA;...
                    -2*wRWA             0       2*wRWA;...
                       wRWA/2       wRWA/2       wRWA/2];

panelThickness  = 0.004;
inToM           = 0.0254;
strutLength     = yBox/2;
nPanels         = 4;
panelLength     = 0.3;
panelWidth      = 0.3;
solarPanelEff   = 0.295;
zSolarWing      = zBox/2;

yPanel          = strutLength + yBox/2;

% RCS
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
mFRCS       = 1.7;
vRCS        = mFRCS/rhoRCS;
rRCS        = (0.75*0.5*vRCS/pi)^(1/3); % Two tanks

rTank       = [-xBox/2+rRCS  xBox/2-rRCS;...
                yBox/2-rRCS -yBox/2+rRCS;...
                rRCS         rRCS];

% Battery
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
volumeBattery = 1.8; % L

% Solar arrays
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
arrayMass	  = 9;
bX          = [ 1 0 0;0 0 -1;0 1  0]';
bY          = [-1 0 0;0 1  0;0 0 -1];

%% Initialize
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
BuildCADModel( 'initialize' );
BuildCADModel( 'set name' , 'Asteroid Prospector' );
BuildCADModel( 'set units', 'mks' );

%%% Bodies
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

% Core
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
m = CreateBody('make','name','Core','rHinge',[0;0;0],'bHinge',eye(3));
BuildCADModel('add body', m );

m = CreateBody('make','name','SolarWing1','rHinge',[0;0;0],'bHinge',eye(3),...
               'previousBody',1);
BuildCADModel('add body', m );

m = CreateBody('make','name','SolarWing2','rHinge',[0;0;0],'bHinge',eye(3),...
               'previousBody',1);
BuildCADModel('add body', m );

% Add robot arm
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
k = 1;
link(k).u       = [0;0;1];
link(k).r       = [0;0;0.02];
link(k).mass    = 0.02;
link(k).radius	= 0.01; 
link(k).b       = eye(3);
link(k).power   = 1;
link(k).name    = 'shoulder';
k               = k + 1;

link(k).u       = [1;0;0];
link(k).angle   = 0;
link(k).r       = [0;0;0.1];
link(k).mass    = 0.1;
link(k).radius	= 0.01; 
link(k).b       = eye(3);
link(k).power   = 1;
link(k).name    = 'upper arm';
k               = k + 1;

link(k).u       = [1;0;0];
link(k).angle   = pi/8;
link(k).r       = [0;0;0.1];
link(k).mass    = 0.1;
link(k).radius	= 0.01; 
link(k).b       = eye(3);
link(k).power   = 1;
link(k).name    = 'fore arm';
k               = k + 1;

link(k).u       = [1;0;0];
link(k).r       = [0;0;0.02];
link(k).angle   = pi/4;
link(k).mass    = 0.02;
link(k).radius	= 0.01; 
link(k).b       = eye(3);
link(k).power   = 1;
link(k).name    = 'wrist';


AddRobotArm( 'add bodies', 1, 4, [ yBox/4;0;zBox], link );
AddRobotArm( 'add bodies', 1, 8, [-yBox/4;0;zBox], link );

% This creates the connections between the bodies
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
BuildCADModel( 'compute paths' );

%%% Components

AddRobotArm( 'add components', 1, 4, [ yBox/4;0;zBox], link );
AddRobotArm( 'add components', 1, 8, [-yBox/4;0;zBox], link );

% Solar Array 1
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
m = CreateComponent( 'make', 'solar array front', 'z', panelLength, 'x', panelWidth,...
                     'nZ', nPanels, 'nX', 1, 'dirZ', 1, 'inside', 0, ...
                     'theta', 0, 'electricalConversionEfficiency', solarPanelEff, 'b', bY*bX,...
                     'rA', [0;yPanel;zSolarWing], 'mass', arrayMass/2, 'cM', [0;0;0],...
                     'name', 'Solar Array +Y Front', 'body', 2, 'faceColor', 'solar cell' );
BuildCADModel( 'add component', m );

m = CreateComponent( 'make', 'solar array back', 'z', panelLength, 'x', panelWidth,...
                     'nZ', nPanels, 'nX', 1, 'dirZ', 1,...
                     'theta', 0, 'b', bY*bX, 'inside', 0, ...
                     'rA', [0;yPanel;zSolarWing], 'mass', arrayMass/2, 'cM', [0;0;0],...
                     'name', 'Solar Array +Y Back', 'body', 2, 'faceColor', 'black' );
BuildCADModel( 'add component', m );

                     
% Solar Array 2
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
m = CreateComponent( 'make', 'solar array front', 'z', panelLength, 'x', panelWidth,...
                     'nZ', nPanels, 'nX', 1, 'dirZ', 1,'inside', 0, ...
                     'theta', 0, 'electricalConversionEfficiency', solarPanelEff, 'b', bX',...
                     'rA', [0;-yPanel;zSolarWing], 'mass', 10, 'cM', [0;0;0],...
                     'name', 'Solar Array -Y Front', 'body', 3, 'faceColor', 'solar cell' );
BuildCADModel( 'add component', m );

m = CreateComponent( 'make', 'solar array back', 'z', panelLength, 'x', panelWidth,...
                     'nZ', nPanels, 'nX', 1, 'dirZ', 1,...
                     'theta', 0, 'b', bX','inside', 0, ...
                     'rA', [0;-yPanel;zSolarWing], 'mass', 10, 'cM', [0;0;0],...
                     'name', 'Solar Array -Y Back', 'body', 3, 'faceColor', 'black' );
BuildCADModel( 'add component', m );

% Solar array drives
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
rD = [0 0;-yBox yBox;zBox zBox]/2;
for k = 1:size(rD,2)
    n = sprintf('Solar Array Drive %d',k);
    m = CreateComponent( 'make', 'cylinder', 'rUpper', 0.04, 'rLower', 0.04, 'h', 0.01,'n',20,...
                     'inside', 0, 'b', [1 0 0;0 0 -1;0 1 0], 'rA', rD(:,k), 'mass', 0.1,...
                     'name', n, 'body', 1, 'faceColor', 'aluminum' );
    BuildCADModel( 'add component', m );
end


% Frame
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
[v, f] = PanelFrame( xBox, yBox, panelThickness, panelThickness );
m = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f,...
                     'faceColor', 'aluminum','rA', [0;0;zBox-2*panelThickness],...
                     'mass', 10, 'name', 'Top Frame', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );

v = ([1 0 0; 0 1 0; 0 0 -1]*v')';
m = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f,...
                     'faceColor', 'aluminum','rA', [0;0;2*panelThickness],...
                     'mass', 10, 'name', 'Bottom Frame', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );

z1     = 2*panelThickness;
z2     = z1 + zBox-2*panelThickness; 
c      = [];
c.x    = [ -0.250 0     0     0.250  0.250  0      0     -0.250]*inToM;
c.y    = [  0.375 0.375 0.125 0.125 -0.375 -0.375 -0.125 -0.125]*inToM;
[v, f] = ShapedStrut( [0;0;z1], [0;0;z2], c );
angle  = 0;
sX     = [1  1 -1 -1];
sY     = [1 -1 -1  1];
for k = 1:4
  angle = angle + pi/2;
  xF    = sX(k)*(xBox/2 - panelThickness/2);
  yF    = sY(k)*(yBox/2 - panelThickness/2);
  b     = [cos(angle) sin(angle) 0;-sin(angle) cos(angle) 0;0 0 1];
  vR    = (b*v')';
  m     = CreateComponent( 'make', 'generic', 'vertex', vR, 'face', f,...
                           'faceColor', 'aluminum','rA', [xF;yF;0], ...
                           'mass', 10, 'name', ['z strut' num2str(k)], 'body', 1,...
                           'inside',0 );
  BuildCADModel( 'add component', m );
end


% Panels
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
panelName = {'+X' '-X' '+Y' '-Y' '+Z'  '-Z'};
color     = {'gold foil' 'gold foil' 'radiator' 'radiator' 'aluminum' 'aluminum'};
xLoc      = (xBox - panelThickness)/2;
yLoc      = (yBox - panelThickness)/2;
zLoc      = (zBox - panelThickness)/2;
			 
wX        = xBox - 2*panelThickness;
wY        = yBox - 2*panelThickness;
wZ        = zBox - 2*panelThickness;

th        = panelThickness;
zH        = zBox/2;

rAP       = [xLoc -xLoc 0     0      0       0 ;...
             0     0    yLoc -yLoc   0       0;...
			 zH    zH   zH    zH    zBox     0];
			 
dP        =     [th  th wX  wX  wX  wX ;...
                 wY  wY th  th  wY  wY;...
                 wZ  wZ wZ  wZ  th  th];

for k = 1:6
  m = CreateComponent( 'make', 'box', 'x', dP(1,k), 'y',dP(2,k), 'z',dP(3,k),...
                       'faceColor', color{k}, 'rA', rAP(:,k), 'mass', 10,...
                       'name', ['Panel ' panelName{k}], 'body', 1,...
                       'inside', 0 );
  BuildCADModel( 'add component', m );
end


% Xenon fuel tank
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
[v, f]    = XenonTank( mF );
m         = CreateComponent( 'make', 'generic','vertex', v, 'face', f,...
                             'faceColor', 'steel' ,'rA', [0;0;0],...
                             'name', ['Xenon' ' tank'],'inside',1);
BuildCADModel( 'add component', m );

% Batteries
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
lToM3     = 0.001;
xB        = (volumeBattery*lToM3)^(1/3);

rB        = 0.5*([0;yBox;0] + [0;-xB;xB/2]);
m         = CreateComponent( 'make', 'box','x', xB, 'y', xB, 'z', xB/2,...
                             'faceColor', [0 1 0] ,'rA', rB,...
                             'name', 'Battery 1','inside',1);
BuildCADModel( 'add component', m );
                         
rB        = 0.5*([0;-yBox;0] + [0;xB;xB/2]);
m         = CreateComponent( 'make', 'box','x', xB, 'y', xB, 'z', xB/2,...
                             'faceColor', [0 1 0] ,'rA', rB,...
                             'name', 'Battery 2','inside',1);
BuildCADModel( 'add component', m );

% Antenna
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
m = CreateComponent( 'make', 'ellipsoid', 'name', 'Antenna',...
                     'body', 1, 'abc', [0.3 0.3 0.1], 'thetaUpper',pi/4,'b',[0 0 1;0 1 0;-1 0 0],...
					 'n',10, 'rA',[-xBox/2-0.1;0;zBox/2], 'faceColor', [0.5 0.5 0], 'edgeColor',[1 1 1]);
BuildCADModel('add component', m );

% Xenon Thruster
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
m = CreateComponent( 'make', 'cylinder', 'rUpper', 0.02, 'rLower', 0.02, 'h', 0.03,'n',20,...
                     'inside', 0, 'rA', [0;0;-0.03], 'mass', 0.1,...
                     'name', 'Ion Thruster', 'body', 1, 'faceColor', 'aluminum' );
BuildCADModel( 'add component', m );


% Processors
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
z = 0;
xProc = 0.5*(xBox-dimProc(1));
yProc = 0.5*(yBox-dimProc(1));
for k = 1:nBoards
    m = CreateComponent( 'make', 'box', 'x', dimProc(1), 'y', dimProc(1), 'z', dimProc(3), 'rA',[xProc;yProc;z],...
                         'name', sprintf('Board %d',k), 'body', 1, 'mass', massBoard,'power',powerBoard, ...
                         'faceColor', [1 0 0], 'inside', 1);
    BuildCADModel( 'add component', m );
    z = z + dimProc(3);
end

% Reaction wheels
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
for k = 1:nRWA
    m = CreateComponent( 'make', 'box', 'x', wRWA, 'y', wRWA, 'z', wRWA, 'rA',xRWA(:,k),...
                         'name', sprintf('RWA %d',k), 'body', 1, 'mass', massRWA,'power',powerRWA, ...
                         'faceColor', [1 1 0], 'inside', 1);
    BuildCADModel( 'add component', m );
end

% Omni antennas
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
for k = 1:2
    m = CreateComponent( 'make', 'cylinder', 'rUpper', rOmni, 'rLower', rOmni, 'h', lOmni, 'n', 24, 'rA',xOmni(:,k),...
                         'name', sprintf('Omni %d',k), 'body', 1, 'mass', massOmni,'power',powerOmni, ...
                         'faceColor', [0 0 0], 'inside', 1);
    BuildCADModel( 'add component', m );
end

% Thrusters
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
for k = 1:8
    [v, f] = ThrusterPatch( dThruster.uThruster(:,k), 0.01, 0.02, 8, 1 );
    m = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f, 'rA', dThruster.rThruster(:,k),...
                         'name', sprintf('Thruster %d',k), 'body', 1, 'mass', massThruster, 'power',powerRCS,...
                         'faceColor', [0.4 0.4 0.4], 'inside', 1);
    BuildCADModel( 'add component', m );
end

% RCS Fuel tanks
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
for k = 1:size(rTank,2)
    m = CreateComponent( 'make', 'fuel tank','name', 'Fuel Tank',...
                         'body', 1,'radius', rRCS,'mass',mFRCS/2,...
                         'rA',rTank(:,k), 'faceColor',[0.7 0.7 0.7]);

    BuildCADModel( 'add component', m );
end

% ICONS sensor and deployment box
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
[v, f]    = ICONS;
massICONS = 0.5;
wICONS    = 0.1;
m = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f, 'rA', [0.4*xBox;0.4*yBox;zBox],...
                     'name', 'ICONS', 'body', 1, 'mass', massICONS,'power',5*0.7+4, ...
                     'faceColor', [1 0.2 0.7], 'inside', 0);
BuildCADModel( 'add component', m );

m = CreateComponent( 'make', 'box', 'x', wICONS, 'y', wICONS, 'z',wICONS, 'rA', [0.4*xBox;0.4*yBox;zBox-wICONS/2],...
                     'name', 'ICONS Launch Box', 'body', 1, 'mass', massICONS,'power',5*0.7+4, ...
                     'faceColor', [0.2 0.2 0.7], 'inside', 0);
BuildCADModel( 'add component', m );

% Add subsystems
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
BuildCADModel( 'add subsystem', 'acs',        {'ICONS','rwa'} );
BuildCADModel( 'add subsystem', 'propulsion', {'thruster', 'tank'} );
BuildCADModel( 'add subsystem', 'tt&c',       {'C&DH', 'omni', 'signal','processor', 'antenna', 'board'} );
BuildCADModel( 'add subsystem', 'mechanism',  {'drive'} );
BuildCADModel( 'add subsystem', 'power',      {'solar array', 'battery'} );
BuildCADModel( 'add subsystem', 'structure',  {'support', 'frame', 'strut', 'panel'} );


%% Update the mass properties to produce the tables
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
BuildCADModel( 'update body mass properties' );

%% Export the model and generate reports
g = BuildCADModel( 'get model');
BuildCADModel('show vehicle')

CreateReport( g, 'tex', FileFullpath('AsteroidProspectorMassReport'),  'mass',  1, 1, 1 )
CreateReport( g, 'tex', FileFullpath('AsteroidProspectorPowerReport'), 'power', 1, 1, 1 )


% Export to obj
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
ExportOBJ(g,FileFullpath('AsteroidProspector'));


%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% PSS internal file version information
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% $Date:   BuildAsteroidProspector.m $
% $Id: 98ddd7fb9969b4cdc7d943fc3521e51f43d9bad7 $

##### SOURCE END #####
-->
</body>
</html>
