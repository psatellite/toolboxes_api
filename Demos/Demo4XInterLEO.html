
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Demo4XInterLEO</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-11-07"><meta name="DC.source" content="Demo4XInterLEO.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Impulsive 4X mass optimization, LEO, with interpolated inner laps</a></li><li><a href="#2">Choose key and tween laps. Minimum of 2 key laps for tweens to be inserted.</a></li><li><a href="#3">Optimize</a></li><li><a href="#4">run</a></li><li><a href="#5">Report</a></li></ul></div><h2 id="1">Impulsive 4X mass optimization, LEO, with interpolated inner laps</h2><p>Inter-LEO, small plane change, with linear mass function.</p><p>See also: OptimizeImpulsive4X, IterativeHohmannInc</p><pre class="codeinput"><span class="comment">%---------------------------------------------------------------------------</span>
<span class="comment">%   Copyright (c) 2018 Princeton Satellite Systems, Inc.</span>
<span class="comment">%   All rights reserved.</span>
<span class="comment">%---------------------------------------------------------------------------</span>
</pre><h2 id="2">Choose key and tween laps. Minimum of 2 key laps for tweens to be inserted.</h2><p>A tween of "1" is the same as no tweens - only the key laps are used. To retrieve a Hohmann solution, use 1 key and 1 tween. if nKey is changed you must set restart to false and generate a new solution.</p><pre class="codeinput">nKey = 3;
nTween = 100;
restart = false;

<span class="comment">% Initial conditions</span>
wArg = pi/2;
elInitial = [6700 28*pi/180 0 wArg 0.005 0];
elFinal   = [7100 29*pi/180 0 0 0.001 0.1];

<span class="comment">% Propulsion parameters</span>
m0 = 300;
sigma = 100;

<span class="comment">% Analytical solution - Hohmann</span>
dInc = elFinal(2) - elInitial(2);
[dVHoh,dv1,dv2,Di1,Di2] = DVHohInc(elInitial(5),elInitial(1),elFinal(5),elFinal(1),dInc);

<span class="comment">% Low-thrust spiral</span>
dVlow = LTPlaneChange( elInitial(1), elFinal(1), dInc );

<span class="comment">% Iterative Hohmann</span>
burnsI = IterativeHohmannInc( elInitial(1), elFinal(1), dInc, 0.035 );

DispWithTitle([elInitial;elFinal],<span class="string">'Initial and Final Elements:'</span>)
fprintf(<span class="string">'Analytical delta-V is %g km/s. \n'</span>,dVHoh);
fprintf(<span class="string">'Iterative Hohmanns is %g km/s. \n'</span>,sum(burnsI(:,1)));
fprintf(<span class="string">'Low thrust delta-V is %g km/s. \n'</span>,dVlow);
</pre><pre class="codeoutput">Initial and Final Elements:
  Columns 1 through 3
                      6700         0.488692190558412                         0
                      7100         0.506145483078356                         0
  Columns 4 through 6
           1.5707963267949                     0.005                         0
                         0                     0.001                       0.1
Analytical delta-V is 0.259147 km/s. 
Iterative Hohmanns is 0.282301 km/s. 
Low thrust delta-V is 0.303349 km/s. 
</pre><h2 id="3">Optimize</h2><pre class="codeinput">data = OptimizeImpulsive4X;
data.keyLaps = nKey;
data.tweenLaps = nTween; <span class="comment">% Total laps are (key - 1)*tween + 1</span>
totalLaps = (data.keyLaps-1)*data.tweenLaps + 1;
fprintf(<span class="string">'Total number of laps: %d\n'</span>,totalLaps);
<span class="comment">%data.elementMask = [1 1 0 0 1 0 0 0]; % sma and ecc</span>
data.elementMask = [0 1 0 0 0 0 1 1]; <span class="comment">% apses</span>
data.ConTol = 1e-5;
data.stepTol = 1e-8;
data.W = [0.001 3 1 1 2]; <span class="comment">% [sma inc raan w ecc]</span>
data.doInitial = false;
<span class="keyword">if</span> restart
  data.doInitial = false;
<span class="keyword">end</span>

<span class="comment">% linear mass cost function</span>
costFun = @MassCostLinearFun;
costData = MassCostLinearFun;
costData.m0 = m0;
costData.sigma = sigma;

data.costFun = costFun;
data.costData = costData;
</pre><pre class="codeoutput">Total number of laps: 201
</pre><h2 id="4">run</h2><pre class="codeinput"><span class="keyword">if</span> restart
  data.dvsPrev = out.keydVsF;
<span class="keyword">end</span>

<span class="comment">% run with zero cost to ensure feasibility</span>
[burns, elOutput, out]=OptimizeImpulsive4X(elInitial,elFinal,[],data);
</pre><pre class="codeoutput">                                            First-order      Norm of
 Iter F-count            f(x)  Feasibility   optimality         step
    0      13    1.359676e+01    3.072e-03    3.929e+01
    1      36    1.320806e+01    1.497e-06    2.716e+01    5.413e-02
    2      52    1.314272e+01    6.613e-03    1.874e+05    1.353e-02
    3      70    1.256374e+01    2.071e-02    2.799e+01    1.353e-02
    4      85    1.216433e+01    2.875e-02    7.624e+03    1.353e-02
    5     103    1.194067e+01    3.249e-02    2.806e+01    1.353e-02
    6     119    1.190411e+01    2.869e-02    1.554e+02    6.766e-03
    7     137    1.175400e+01    3.150e-02    5.977e+01    6.766e-03
    8     153    1.163549e+01    3.389e-02    2.322e+03    1.184e-02
    9     171    1.163578e+01    3.101e-02    3.812e+01    8.822e-06
   10     186    1.163572e+01    3.101e-02    5.600e+01    5.514e-06
   11     204    1.163600e+01    3.101e-02    6.907e+01    5.139e-06
   12     219    1.163634e+01    3.100e-02    5.148e+01    8.924e-06

Converged to an infeasible point.

fmincon stopped because the size of the current step is less than
the value of the step size tolerance but constraints are not
satisfied to within the value of the constraint tolerance.

</pre><img vspace="5" hspace="5" src="Demo4XInterLEO_01.png" alt=""> <h2 id="5">Report</h2><p>Call system mass function with output</p><pre class="codeinput">[sysMass,masses] = MassCostLinearFun(burns,elInitial,data.costData,OTFrame(<span class="string">'polar'</span>));
fprintf(<span class="string">'\nTotal system mass: %.1f kg\n---------------\n'</span>,sysMass)
fprintf(<span class="string">'  Fuel mass: \t%.1f kg\n'</span>,masses(1));
fprintf(<span class="string">'  Tank mass: \t%.1f kg\n'</span>,masses(2));
fprintf(<span class="string">'  Propulsion mass:\t%.1f kg\n'</span>,masses(3));

OptimizerReport(out)

PlotImpulsiveTrajectory(elInitial, burns, elFinal);
PlotElementsImpulsive(elInitial, burns, [], elFinal);
dVs = reshape(out.tweendVsF,4,[])';
[time,tlabl] = TimeLabl(out.absTimes');
Plot2D(time,out.burns(:,1)',tlabl,<span class="string">'DV'</span>,<span class="string">'Burn Delta-Vs'</span>)
Plot2D(1:size(dVs,1),dVs,<span class="string">'Index'</span>,<span class="string">'DV'</span>,<span class="string">'Interpolated Delta-Vs'</span>)
legend(<span class="string">'bP'</span>,<span class="string">'bA'</span>,<span class="string">'bN1'</span>,<span class="string">'bN2'</span>)

NewFig(<span class="string">'Initial and Final Key DVs'</span>);
bar([out.dVs0;out.keydVsF]')
ylabel(<span class="string">'DV (km/s)'</span>)
legend(<span class="string">'Guess'</span>,<span class="string">'Final'</span>)


<span class="comment">%--------------------------------------</span>
</pre><pre class="codeoutput">
Total system mass: 11.6 kg
---------------
  Fuel mass: 	9.2 kg
  Tank mass: 	0.7 kg
  Propulsion mass:	1.7 kg
Total Delta-V (km/s):
         0.303967239669056
Number of burns:
   790
Initial elements, target, achieved:
  Columns 1 through 3
                      6700         0.488692190558412                         0
                      7100         0.506145483078356                         0
          7086.56054021998         0.495809086392946                         0
  Columns 4 through 6
           1.5707963267949                     0.005                         0
                         0                     0.001                       0.1
          1.57079895098663        0.0025155353519762         -1.56576768653375
Mission duration:
	13.2169 Time (days)
Cost value:
           11.636336741858
Iterations:
    13
Constraint value:
        0.0309995272753247
Elapsed Time:
	34.6455 sec
System mass:
	11.6363 kg
Masses:
          9.15677165153473         0.732541732122779          1.74702335820044
</pre><img vspace="5" hspace="5" src="Demo4XInterLEO_02.png" alt=""> <img vspace="5" hspace="5" src="Demo4XInterLEO_03.png" alt=""> <img vspace="5" hspace="5" src="Demo4XInterLEO_04.png" alt=""> <img vspace="5" hspace="5" src="Demo4XInterLEO_05.png" alt=""> <img vspace="5" hspace="5" src="Demo4XInterLEO_06.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Impulsive 4X mass optimization, LEO, with interpolated inner laps
% Inter-LEO, small plane change, with linear mass function.
%
% See also: OptimizeImpulsive4X, IterativeHohmannInc

%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%   Copyright (c) 2018 Princeton Satellite Systems, Inc.
%   All rights reserved.
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

%% Choose key and tween laps. Minimum of 2 key laps for tweens to be inserted.
% A tween of "1" is the same as no tweens - only the key laps are used.
% To retrieve a Hohmann solution, use 1 key and 1 tween. if nKey is changed you
% must set restart to false and generate a new solution.
nKey = 3;
nTween = 100;
restart = false;

% Initial conditions
wArg = pi/2;
elInitial = [6700 28*pi/180 0 wArg 0.005 0];
elFinal   = [7100 29*pi/180 0 0 0.001 0.1];

% Propulsion parameters
m0 = 300;
sigma = 100;

% Analytical solution - Hohmann
dInc = elFinal(2) - elInitial(2);
[dVHoh,dv1,dv2,Di1,Di2] = DVHohInc(elInitial(5),elInitial(1),elFinal(5),elFinal(1),dInc);

% Low-thrust spiral
dVlow = LTPlaneChange( elInitial(1), elFinal(1), dInc );

% Iterative Hohmann
burnsI = IterativeHohmannInc( elInitial(1), elFinal(1), dInc, 0.035 );

DispWithTitle([elInitial;elFinal],'Initial and Final Elements:')
fprintf('Analytical delta-V is %g km/s. \n',dVHoh);
fprintf('Iterative Hohmanns is %g km/s. \n',sum(burnsI(:,1)));
fprintf('Low thrust delta-V is %g km/s. \n',dVlow);


%% Optimize

data = OptimizeImpulsive4X;
data.keyLaps = nKey;
data.tweenLaps = nTween; % Total laps are (key - 1)*tween + 1
totalLaps = (data.keyLaps-1)*data.tweenLaps + 1;
fprintf('Total number of laps: %d\n',totalLaps);
%data.elementMask = [1 1 0 0 1 0 0 0]; % sma and ecc
data.elementMask = [0 1 0 0 0 0 1 1]; % apses
data.ConTol = 1e-5;
data.stepTol = 1e-8;
data.W = [0.001 3 1 1 2]; % [sma inc raan w ecc] 
data.doInitial = false;
if restart
  data.doInitial = false;
end

% linear mass cost function
costFun = @MassCostLinearFun;
costData = MassCostLinearFun;
costData.m0 = m0;
costData.sigma = sigma;

data.costFun = costFun;
data.costData = costData;

%% run
if restart
  data.dvsPrev = out.keydVsF;
end

% run with zero cost to ensure feasibility
[burns, elOutput, out]=OptimizeImpulsive4X(elInitial,elFinal,[],data);

%% Report
% Call system mass function with output
[sysMass,masses] = MassCostLinearFun(burns,elInitial,data.costData,OTFrame('polar'));
fprintf('\nTotal system mass: %.1f kg\nREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-\n',sysMass)
fprintf('  Fuel mass: \t%.1f kg\n',masses(1));
fprintf('  Tank mass: \t%.1f kg\n',masses(2));
fprintf('  Propulsion mass:\t%.1f kg\n',masses(3));

OptimizerReport(out)

PlotImpulsiveTrajectory(elInitial, burns, elFinal);
PlotElementsImpulsive(elInitial, burns, [], elFinal);
dVs = reshape(out.tweendVsF,4,[])';
[time,tlabl] = TimeLabl(out.absTimes');
Plot2D(time,out.burns(:,1)',tlabl,'DV','Burn Delta-Vs')
Plot2D(1:size(dVs,1),dVs,'Index','DV','Interpolated Delta-Vs')
legend('bP','bA','bN1','bN2')

NewFig('Initial and Final Key DVs'); 
bar([out.dVs0;out.keydVsF]')
ylabel('DV (km/s)')
legend('Guess','Final')


%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% $Date: 2019-10-01 15:52:33 -0400 (Tue, 01 Oct 2019) $
% $Revision: 49921 $

##### SOURCE END #####
--></body></html>