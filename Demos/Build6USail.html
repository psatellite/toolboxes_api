
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Build6USail</title><meta name="generator" content="MATLAB 9.10"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2021-10-28"><meta name="DC.source" content="Build6USail.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Build a 6U Sail.</a></li><li><a href="#2">Design the mission</a></li><li><a href="#3">Print</a></li><li><a href="#4">Initialize</a></li><li><a href="#5">Core</a></li><li><a href="#6">This creates the connections between the bodies</a></li><li><a href="#7">Solar Array 1</a></li><li><a href="#8">Solar Array 2</a></li><li><a href="#9">Solar array drives</a></li><li><a href="#10">Frame</a></li><li><a href="#11">Panels</a></li><li><a href="#12">Batteries</a></li><li><a href="#13">Antenna</a></li><li><a href="#14">Processors</a></li><li><a href="#15">Single Board Computer</a></li><li><a href="#16">Reaction wheels</a></li><li><a href="#17">Omni antennas</a></li><li><a href="#18">ICONS sensor and deployment box</a></li><li><a href="#19">Sails</a></li><li><a href="#20">MultiSpectral Imager</a></li><li><a href="#21">Add subsystems</a></li><li><a href="#22">Update the mass properties to produce the tables</a></li><li><a href="#23">Export to obj</a></li></ul></div><h2 id="1">Build a 6U Sail.</h2><pre class="codeinput"><span class="comment">%--------------------------------------------------------------------------</span>
<span class="comment">%   Copyright (c) 2012-2016 Princeton Satellite Systems, Inc.</span>
<span class="comment">%   All rights reserved.</span>
<span class="comment">%--------------------------------------------------------------------------</span>
<span class="comment">%   Since 2016.1</span>
<span class="comment">%--------------------------------------------------------------------------</span>
</pre><h2 id="2">Design the mission</h2><pre class="codeinput"><span class="comment">% Constants</span>
c               = Constant(<span class="string">'speed of light'</span>);
mu              = Constant(<span class="string">'mu earth'</span>);
muSun           = Constant(<span class="string">'mu sun'</span>);
aU              = Constant(<span class="string">'au'</span>);
lSail           = 5;

<span class="comment">% Mission date</span>
date            = [2015 5 7 0 0 0];
jD              = Date2JD(date);

<span class="comment">% Our current guess for propulsion system sizing</span>
mTotal  = 20; <span class="comment">% kg</span>
dVTotal = 8; <span class="comment">%km/s</span>

<span class="comment">% ICONS parameters</span>
massICONS = 0.5;
wICONS    = 0.1;


effConv         = 0.8;
powerComm       = 7.3;
fComm           = 200e6;
aAsteroid       = 1.3;
hParking        = 850; <span class="comment">% Needs to be below the radiation belts</span>

<span class="comment">% One u is 10 cm</span>
u               = 0.1;
zBox            = 1.4*u;
xBox            = 3*u;
yBox            = 2*u;
panelThickness  = 0.004;
lCore           = zBox;

busDim          = sprintf(<span class="string">'%4.1f $\\times$ %4.1f $\\times$ %4.1f'</span>,xBox*100,yBox*100,zBox*100);

powerRWA        = 2;

<span class="comment">% Omnidirectional antennas</span>
massOmni        = 0.2;
powerOmni       = 2;
xOmni           = [xBox -yBox; yBox yBox; zBox zBox];
rOmni           = 0.002;
lOmni           = 0.5*c/fComm;

<span class="comment">% Processor boards</span>
dimProc         = [.293 .07 .005];
massBoard       = .1261;
powerBoard      = 2;

dimCPU          = [.09, .096, .036];
massCPU         = .35;
powerCPU        = 5.75;

nRWA            = 3;
wRWA            = 0.04;
massRWA         = 0.1;
xRWA            = [ xBox/2-wRWA            -xBox/2+wRWA   -xBox/2+wRWA;<span class="keyword">...</span>
                    -2*wRWA+panelThickness	0             2*wRWA-panelThickness;<span class="keyword">...</span>
                    wRWA/2                  wRWA/2        wRWA/2];


inToM           = 0.0254;
strutLength     = yBox/2;
nPanels         = 1;
panelLength     = 0.4/nPanels;
panelWidth      = 0.4;
solarPanelEff   = 0.295;
zSolarWing      = zBox/2;
rhoPanel        = 0.23;

yPanel          = strutLength + yBox/2;

a               = linspace(1,aAsteroid);
solarConstant   = 1367*(1./a).^2;
power           = 2*effConv*nPanels*panelLength*panelWidth*solarPanelEff*solarConstant;

Plot2D(a,power,<span class="string">'AU'</span>,<span class="string">'Power (W)'</span>,<span class="string">'Power'</span>);
y = get(gca,<span class="string">'ylim'</span>);
set(gca,<span class="string">'ylim'</span>,[0 y(2)]);


<span class="comment">% Design the battery</span>
dOD = 0.8;
sma = 6378.165 + hParking;
inc = 28.4667*pi/180;
rhoM = 133;
rhoV = 263;
[massBattery, volumeBattery, capacityBattery] = BatterySize( sma, inc, power(1), jD, dOD, rhoM, rhoV );

<span class="comment">% Solar arrays</span>
arrayMass	= nPanels*panelLength*panelWidth*rhoPanel;
bX          = [ 1 0 0;0 0 -1;0 1  0]';
bY          = [-1 0 0;0 1  0;0 0 -1];


<span class="comment">% Earth spiral from hParking</span>
aEarth      = aU;
r           = 6378.165 + hParking;
</pre><img vspace="5" hspace="5" src="Build6USail_01.png" alt=""> <h2 id="3">Print</h2><pre class="codeinput">clear <span class="string">s</span>

k = 1;
s{k,1} = <span class="string">'\textbf{Mission Plan}'</span>;                                                       k = k + 1;
s{k,1} = <span class="string">'Parking Altitude'</span>;            s{k,2} = hParking;          s{k,3} = <span class="string">'km'</span>;      k = k + 1;
s{k,1} = <span class="string">'Maximum Heliocentric Orbit'</span>;	s{k,2} = aAsteroid;         s{k,3} = <span class="string">'AU'</span>;      k = k + 1;
s{k,1} = <span class="string">'\textbf{Power Subsystem}'</span>;                                                    k = k + 1;
s{k,1} = <span class="string">'Maximum Power'</span>;               s{k,2} = power(1);          s{k,3} = <span class="string">'W'</span>;       k = k + 1;
s{k,1} = <span class="string">'Minimum Power'</span>;               s{k,2} = power(end);        s{k,3} = <span class="string">'W'</span>;       k = k + 1;
s{k,1} = <span class="string">'Solar cells'</span>;                 s{k,2} = <span class="string">'Emcore ZTJ'</span>;                          k = k + 1;
s{k,1} = <span class="string">'Solar cell efficiency'</span>;       s{k,2} = solarPanelEff;                         k = k + 1;
s{k,1} = <span class="string">'Battery mass'</span>;                s{k,2} = massBattery;       s{k,3} = <span class="string">'kg'</span>;      k = k + 1;
s{k,1} = <span class="string">'Battery volume'</span>;              s{k,2} = volumeBattery;     s{k,3} = <span class="string">'L'</span>;       k = k + 1;
s{k,1} = <span class="string">'Battery capacity'</span>;            s{k,2} = capacityBattery;	s{k,3} = <span class="string">'W-h'</span>; 	k = k + 1;
s{k,1} = <span class="string">'\textbf{Mass}'</span>;                                                               k = k + 1;
s{k,1} = <span class="string">'Bus dimensions'</span>;              s{k,2} = busDim;            s{k,3} = <span class="string">'cm'</span>;      k = k + 1;
s{k,1} = <span class="string">'Mass Total'</span>;                  s{k,2} = mTotal;            s{k,3} = <span class="string">'kg'</span>;      k = k + 1;
s{k,1} = <span class="string">'\textbf{Communications Subsystem}'</span>;                                           k = k + 1;
s{k,1} = <span class="string">'Communications'</span>;              s{k,2} = <span class="string">'S Band'</span>;                              k = k + 1;
s{k,1} = <span class="string">'Comm  Power'</span>;                 s{k,2} = powerComm;         s{k,3} = <span class="string">'W'</span>;       k = k + 1;

CreateLatexTable(s,<span class="string">'Parameters'</span>)
</pre><h2 id="4">Initialize</h2><pre class="codeinput"><span class="comment">%-----------</span>
BuildCADModel( <span class="string">'initialize'</span> );
BuildCADModel( <span class="string">'set name'</span> , <span class="string">'6U Sail'</span> );
BuildCADModel( <span class="string">'set units'</span>, <span class="string">'mks'</span> );
</pre><img vspace="5" hspace="5" src="Build6USail_02.png" alt=""> <h2 id="5">Core</h2><pre class="codeinput"><span class="comment">%-----</span>
m              = [];
m.name         = <span class="string">'Core'</span>;
m.rHinge       = [0;0;0];
m.bHinge.b     = eye(3);
m.previousBody = [];

BuildCADModel(<span class="string">'add body'</span>, m );

m.name         = <span class="string">'SolarWing1'</span>;
m.rHinge       = [0;0;0];
m.bHinge.b     = eye(3);
m.previousBody = 1;

BuildCADModel(<span class="string">'add body'</span>, m );

m.name         = <span class="string">'SolarWing2'</span>;
m.rHinge       = [0;0;0];
m.bHinge.b     = eye(3);
m.previousBody = 1;

BuildCADModel(<span class="string">'add body'</span>, m );
</pre><img vspace="5" hspace="5" src="Build6USail_03.png" alt=""> <h2 id="6">This creates the connections between the bodies</h2><pre class="codeinput">BuildCADModel( <span class="string">'compute paths'</span> );
</pre><h2 id="7">Solar Array 1</h2><pre class="codeinput">m = CreateComponent( <span class="string">'make'</span>, <span class="string">'solar array front'</span>, <span class="string">'z'</span>, panelLength, <span class="string">'x'</span>, panelWidth,<span class="keyword">...</span>
                     <span class="string">'nZ'</span>, nPanels, <span class="string">'nX'</span>, nPanels, <span class="string">'dirZ'</span>, 1, <span class="string">'inside'</span>, 0, <span class="keyword">...</span>
                     <span class="string">'theta'</span>, [0 0], <span class="string">'electricalConversionEfficiency'</span>, solarPanelEff, <span class="string">'b'</span>, bY*bX,<span class="keyword">...</span>
                     <span class="string">'rA'</span>, [0;yPanel;zSolarWing], <span class="string">'mass'</span>, arrayMass/2, <span class="string">'cM'</span>, [0;0;0],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Solar Array Plus Y Front'</span>, <span class="string">'body'</span>, 2, <span class="string">'faceColor'</span>, <span class="string">'solar cell'</span> );
BuildCADModel( <span class="string">'add component'</span>, m );

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'solar array back'</span>, <span class="string">'z'</span>, panelLength, <span class="string">'x'</span>, panelWidth,<span class="keyword">...</span>
                     <span class="string">'nZ'</span>, nPanels, <span class="string">'nX'</span>, nPanels, <span class="string">'dirZ'</span>, 1,<span class="keyword">...</span>
                     <span class="string">'theta'</span>, [0 0], <span class="string">'b'</span>, bY*bX, <span class="string">'inside'</span>, 0, <span class="keyword">...</span>
                     <span class="string">'rA'</span>, [0;yPanel;zSolarWing], <span class="string">'mass'</span>, arrayMass/2, <span class="string">'cM'</span>, [0;0;0],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Solar Array Plus Y Back'</span>, <span class="string">'body'</span>, 2, <span class="string">'faceColor'</span>, <span class="string">'black'</span> );
BuildCADModel( <span class="string">'add component'</span>, m );
</pre><img vspace="5" hspace="5" src="Build6USail_04.png" alt=""> <h2 id="8">Solar Array 2</h2><pre class="codeinput">m = CreateComponent( <span class="string">'make'</span>, <span class="string">'solar array front'</span>, <span class="string">'z'</span>, panelLength, <span class="string">'x'</span>, panelWidth,<span class="keyword">...</span>
                     <span class="string">'nZ'</span>, nPanels, <span class="string">'nX'</span>, nPanels, <span class="string">'dirZ'</span>, 1,<span class="string">'inside'</span>, 0, <span class="keyword">...</span>
                     <span class="string">'theta'</span>, [0 0], <span class="string">'electricalConversionEfficiency'</span>, solarPanelEff, <span class="string">'b'</span>, bX',<span class="keyword">...</span>
                     <span class="string">'rA'</span>, [0;-yPanel;zSolarWing], <span class="string">'mass'</span>, arrayMass/2, <span class="string">'cM'</span>, [0;0;0],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Solar Array Minus Y Front'</span>, <span class="string">'body'</span>, 3, <span class="string">'faceColor'</span>, <span class="string">'solar cell'</span> );
BuildCADModel( <span class="string">'add component'</span>, m );

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'solar array back'</span>, <span class="string">'z'</span>, panelLength, <span class="string">'x'</span>, panelWidth,<span class="keyword">...</span>
                     <span class="string">'nZ'</span>, nPanels, <span class="string">'nX'</span>, nPanels, <span class="string">'dirZ'</span>, 1,<span class="keyword">...</span>
                     <span class="string">'theta'</span>, [0 0], <span class="string">'b'</span>, bX',<span class="string">'inside'</span>, 0, <span class="keyword">...</span>
                     <span class="string">'rA'</span>, [0;-yPanel;zSolarWing], <span class="string">'mass'</span>, arrayMass/2, <span class="string">'cM'</span>, [0;0;0],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Solar Array Minus Y Back'</span>, <span class="string">'body'</span>, 3, <span class="string">'faceColor'</span>, <span class="string">'black'</span> );
BuildCADModel( <span class="string">'add component'</span>, m );
</pre><img vspace="5" hspace="5" src="Build6USail_05.png" alt=""> <h2 id="9">Solar array drives</h2><pre class="codeinput">driveThickness = .01;
rD = [0 0;-yBox+driveThickness*2 yBox;zBox zBox]/2;
<span class="keyword">for</span> k = 1:size(rD,2)
    n = sprintf(<span class="string">'Solar Array Drive %d'</span>,k);
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, 0.04, <span class="string">'rLower'</span>, 0.04, <span class="string">'h'</span>, 0.01,<span class="string">'n'</span>,20,<span class="keyword">...</span>
                     <span class="string">'inside'</span>, 0, <span class="string">'b'</span>, [1 0 0;0 0 -1;0 1 0], <span class="string">'rA'</span>, rD(:,k), <span class="string">'mass'</span>, 0.1,<span class="keyword">...</span>
                     <span class="string">'name'</span>, n, <span class="string">'body'</span>, 1, <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span> );
    BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="Build6USail_06.png" alt=""> <h2 id="10">Frame</h2><pre class="codeinput">[v, f] = PanelFrame( xBox, yBox, panelThickness, panelThickness );
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'rA'</span>, [0;0;zBox-2*panelThickness],<span class="keyword">...</span>
                     <span class="string">'mass'</span>, .1, <span class="string">'name'</span>, <span class="string">'Top Frame'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );

v = ([1 0 0; 0 1 0; 0 0 -1]*v')';
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'rA'</span>, [0;0;2*panelThickness],<span class="keyword">...</span>
                     <span class="string">'mass'</span>, .1, <span class="string">'name'</span>, <span class="string">'Bottom Frame'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );

z1     = 2*panelThickness;
z2     = z1 + zBox-2*panelThickness;
c      = [];
c.x    = [ -0.250 0     0     0.250  0.250  0      0     -0.250]*inToM;
c.y    = [  0.375 0.375 0.125 0.125 -0.375 -0.375 -0.125 -0.125]*inToM;
[v, f] = ShapedStrut( [0;0;z1], [0;0;z2], c );
angle  = 0;
sX     = [1  1 -1 -1];
sY     = [1 -1 -1  1];
<span class="keyword">for</span> k = 1:4
  angle = angle + pi/2;
  xF    = sX(k)*(xBox/2 - panelThickness/2);
  yF    = sY(k)*(yBox/2 - panelThickness/2);
  b     = [cos(angle) sin(angle) 0;-sin(angle) cos(angle) 0;0 0 1];
  vR    = (b*v')';
  m     = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, vR, <span class="string">'face'</span>, f,<span class="keyword">...</span>
                           <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'rA'</span>, [xF;yF;0], <span class="keyword">...</span>
                           <span class="string">'mass'</span>, .1, <span class="string">'name'</span>, [<span class="string">'z strut'</span> num2str(k)], <span class="string">'body'</span>, 1,<span class="keyword">...</span>
                           <span class="string">'inside'</span>,0 );
  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="Build6USail_07.png" alt=""> <h2 id="11">Panels</h2><pre class="codeinput">panelName = {<span class="string">'+X'</span> <span class="string">'-X'</span> <span class="string">'+Y'</span> <span class="string">'-Y'</span> <span class="string">'+Z'</span>  <span class="string">'-Z'</span>};
color     = {<span class="string">'gold foil'</span> <span class="string">'gold foil'</span> <span class="string">'radiator'</span> <span class="string">'radiator'</span> <span class="string">'aluminum'</span> <span class="string">'aluminum'</span>};
xLoc      = (xBox - panelThickness)/2;
yLoc      = (yBox - panelThickness)/2;
zLoc      = (zBox - panelThickness)/2;

wX        = xBox - 2*panelThickness;
wY        = yBox - 2*panelThickness;
wZ        = zBox - 2*panelThickness;

th        = panelThickness;
zH        = zBox/2;

rAP       = [ xLoc -xLoc 0     0      0       0 ;<span class="keyword">...</span>
              0     0    yLoc -yLoc   0       0;<span class="keyword">...</span>
              zH    zH   zH    zH    zBox     0];

dP        =     [ th  th wX  wX  wX  wX ;<span class="keyword">...</span>
                  wY  wY th  th  wY  wY;<span class="keyword">...</span>
                  wZ  wZ wZ  wZ  th  th];

<span class="keyword">for</span> k = 1:6
  m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, dP(1,k), <span class="string">'y'</span>,dP(2,k), <span class="string">'z'</span>,dP(3,k),<span class="keyword">...</span>
                       <span class="string">'faceColor'</span>, color{k}, <span class="string">'rA'</span>, rAP(:,k), <span class="string">'mass'</span>, .1,<span class="keyword">...</span>
                       <span class="string">'name'</span>, [<span class="string">'Panel '</span> panelName{k}], <span class="string">'body'</span>, 1,<span class="keyword">...</span>
                       <span class="string">'inside'</span>, 0 );
  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="Build6USail_08.png" alt=""> <h2 id="12">Batteries</h2><pre class="codeinput"><span class="comment">% 2 pack of batteries wired together</span>
wB        = .065;
lB        = .018;
hB        = .065;
<span class="comment">% 4 batteries</span>
rB        = [-xBox/2+wB/2;-yBox/2+lB*2/2+driveThickness;zBox-hB*2/2];
m         = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>,<span class="string">'x'</span>, wB, <span class="string">'y'</span>, lB*2, <span class="string">'z'</span>, hB*2,<span class="keyword">...</span>
                             <span class="string">'faceColor'</span>, [0 1 0] ,<span class="string">'rA'</span>, rB,<span class="string">'mass'</span>,0.1,<span class="keyword">...</span>
                             <span class="string">'name'</span>, <span class="string">'Battery Pack'</span>,<span class="string">'inside'</span>,1);
BuildCADModel( <span class="string">'add component'</span>, m );
<span class="comment">% 2 batteries</span>
rB        = [-xBox/2+wB/2;yBox/2-lB/2-driveThickness;zBox-hB*2/2];
m         = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>,<span class="string">'x'</span>, wB, <span class="string">'y'</span>, lB, <span class="string">'z'</span>, hB*2,<span class="keyword">...</span>
                             <span class="string">'faceColor'</span>, [0 1 0] ,<span class="string">'rA'</span>, rB,<span class="string">'mass'</span>,0.1,<span class="keyword">...</span>
                             <span class="string">'name'</span>, <span class="string">'Battery Pack'</span>,<span class="string">'inside'</span>,1);
BuildCADModel( <span class="string">'add component'</span>, m );
</pre><img vspace="5" hspace="5" src="Build6USail_09.png" alt=""> <h2 id="13">Antenna</h2><pre class="codeinput">m = CreateComponent( <span class="string">'make'</span>, <span class="string">'ellipsoid'</span>, <span class="string">'name'</span>, <span class="string">'Antenna'</span>,<span class="keyword">...</span>
                     <span class="string">'body'</span>, 1, <span class="string">'abc'</span>, [0.25 0.25 0.1], <span class="string">'thetaUpper'</span>,pi/4,<span class="string">'b'</span>,[0 0 1;0 1 0;-1 0 0],<span class="keyword">...</span>
					 <span class="string">'n'</span>,10, <span class="string">'rA'</span>,[-xBox/2-0.1;0;zBox/2], <span class="string">'faceColor'</span>, [0.5 0.5 0], <span class="string">'edgeColor'</span>,[1 1 1]);
BuildCADModel(<span class="string">'add component'</span>, m );
</pre><img vspace="5" hspace="5" src="Build6USail_10.png" alt=""> <h2 id="14">Processors</h2><pre class="codeinput">xProc = 0.5*(xBox-dimProc(1));
yProc = -0.5*(yBox-dimProc(2));
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, dimProc(1), <span class="string">'y'</span>, dimProc(2), <span class="string">'z'</span>, dimProc(3), <span class="string">'rA'</span>,[xProc-panelThickness;-yProc-panelThickness;.5*dimProc(3)+panelThickness],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'processors'</span>, <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massBoard,<span class="string">'power'</span>,powerBoard, <span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, [1 0 0], <span class="string">'inside'</span>, 1);
BuildCADModel( <span class="string">'add component'</span>, m );
</pre><img vspace="5" hspace="5" src="Build6USail_11.png" alt=""> <h2 id="15">Single Board Computer</h2><pre class="codeinput">xCPU = .5*(xBox-dimCPU(1));
yCPU = 0.5*(yBox-dimCPU(2));
zCPU = .5*dimCPU(3)+dimProc(3);
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, dimCPU(1), <span class="string">'y'</span>, dimCPU(2), <span class="string">'z'</span>, dimCPU(3), <span class="string">'rA'</span>,[xCPU-panelThickness;yCPU-panelThickness;zCPU-panelThickness],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'computer'</span>, <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massCPU,<span class="string">'power'</span>,powerCPU, <span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, [0 1 1], <span class="string">'inside'</span>, 1);
BuildCADModel( <span class="string">'add component'</span>, m );
</pre><img vspace="5" hspace="5" src="Build6USail_12.png" alt=""> <h2 id="16">Reaction wheels</h2><pre class="codeinput"><span class="keyword">for</span> k = 1:nRWA
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, wRWA, <span class="string">'y'</span>, wRWA, <span class="string">'z'</span>, wRWA, <span class="string">'rA'</span>,xRWA(:,k),<span class="keyword">...</span>
                         <span class="string">'name'</span>, sprintf(<span class="string">'RWA %d'</span>,k), <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massRWA,<span class="string">'power'</span>,powerRWA, <span class="keyword">...</span>
                         <span class="string">'faceColor'</span>, [1 1 0], <span class="string">'inside'</span>, 1);
    BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="Build6USail_13.png" alt=""> <h2 id="17">Omni antennas</h2><pre class="codeinput"><span class="keyword">for</span> k = 1:2
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, rOmni, <span class="string">'rLower'</span>, rOmni, <span class="string">'h'</span>, lOmni, <span class="string">'n'</span>, 24, <span class="string">'rA'</span>,xOmni(:,k),<span class="keyword">...</span>
                         <span class="string">'name'</span>, sprintf(<span class="string">'Omni %d'</span>,k), <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massOmni,<span class="string">'power'</span>,powerOmni, <span class="keyword">...</span>
                         <span class="string">'faceColor'</span>, [0 0 0], <span class="string">'inside'</span>, 1);
    BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="Build6USail_14.png" alt=""> <h2 id="18">ICONS sensor and deployment box</h2><pre class="codeinput">[v, f]    = ICONS;
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f, <span class="string">'rA'</span>, [xBox-wICONS*2;yBox-wICONS*3/2;zBox],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'ICONS'</span>, <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massICONS,<span class="string">'power'</span>,5*0.7+4, <span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, [1 0.2 0.7], <span class="string">'inside'</span>, 0);
BuildCADModel( <span class="string">'add component'</span>, m );

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, wICONS, <span class="string">'y'</span>, wICONS, <span class="string">'z'</span>,wICONS, <span class="string">'rA'</span>, [xBox-wICONS*2-panelThickness;yBox-wICONS*3/2-panelThickness;zBox-wICONS/2],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'ICONS Launch Box'</span>, <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, 0.1,<span class="string">'power'</span>,0, <span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, [0.2 0.2 0.7], <span class="string">'inside'</span>, 1);
BuildCADModel( <span class="string">'add component'</span>, m );
</pre><img vspace="5" hspace="5" src="Build6USail_15.png" alt=""> <h2 id="19">Sails</h2><pre class="codeinput">dZ          = lSail/10;
v           = [ 0 lSail/2 -lSail/2;<span class="keyword">...</span>
                0 lSail/2  lSail/2;<span class="keyword">...</span>
			   dZ     dZ       dZ ]';
sailName    = {<span class="string">'+Y'</span> <span class="string">'-Y'</span> <span class="string">'+X'</span> <span class="string">'-X'</span>};

f           = [1 2 3];
x           = lSail/30;
z           = -lCore/3;
rSail       = {[0 x z]' [0 -x z]' [x 0 z]' [-x 0 z]' };
bSail       = { eye(3) Eul2Mat([0 0 pi]) Eul2Mat([0 0 pi/2]) Eul2Mat([0 0 -pi/2]) };

mass        = 0.001*lSail^2/4;

<span class="keyword">for</span> k = 1:4
  m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'name'</span>, [<span class="string">'Sail '</span> sailName{k}],<span class="keyword">...</span>
                       <span class="string">'rA'</span>, rSail{k}, <span class="string">'mass'</span>, mass ,<span class="string">'inside'</span>,0,<span class="keyword">...</span>
                       <span class="string">'faceColor'</span>, [1 0.9 0.5], <span class="string">'edgeColor'</span>, [1 0.8 0.34], <span class="string">'b'</span>, bSail{k}, <span class="keyword">...</span>
                       <span class="string">'specularStrength'</span>, 1, <span class="string">'diffuseStrength'</span>, 0.3,<span class="keyword">...</span>
                       <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f, <span class="keyword">...</span>
 					              <span class="string">'body'</span>, 1 );
  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="Build6USail_16.png" alt=""> <h2 id="20">MultiSpectral Imager</h2><pre class="codeinput">xMSI = .12;
yMSI = .12;
zMSI = .125;
massMSI = .8;
powerMSI = 12;
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, xMSI, <span class="string">'y'</span>, yMSI, <span class="string">'z'</span>, zMSI, <span class="string">'rA'</span>, [.5*(xBox-xMSI)-panelThickness;.5*(-yBox+yMSI)+panelThickness;zBox-.5*zMSI-panelThickness],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'MultiSpectral Imager'</span>, <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, massMSI,<span class="string">'power'</span>,powerMSI, <span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, [.2 0 0.7], <span class="string">'inside'</span>, 1);
BuildCADModel( <span class="string">'add component'</span>, m );
</pre><img vspace="5" hspace="5" src="Build6USail_17.png" alt=""> <h2 id="21">Add subsystems</h2><pre class="codeinput">BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'acs'</span>,        {<span class="string">'ICONS'</span>,<span class="string">'rwa'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'payload'</span>,    {<span class="string">'MultiSpectral Imager'</span>});
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'tt&amp;c'</span>,       {<span class="string">'computer'</span>, <span class="string">'omni'</span>, <span class="string">'signal'</span>,<span class="string">'processors'</span>, <span class="string">'antenna'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'mechanism'</span>,  {<span class="string">'drive'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'power'</span>,      {<span class="string">'solar array'</span>, <span class="string">'battery'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'structure'</span>,  {<span class="string">'support'</span>, <span class="string">'frame'</span>, <span class="string">'strut'</span>, <span class="string">'panel'</span>} );
</pre><h2 id="22">Update the mass properties to produce the tables</h2><pre class="codeinput">BuildCADModel( <span class="string">'update body mass properties'</span> );

g = BuildCADModel( <span class="string">'get model'</span>);
BuildCADModel(<span class="string">'show vehicle'</span>)
view(0,-90)

CreateReport( g, <span class="string">'tex'</span>, FileFullpath(<span class="string">'6USailMassReport'</span>),  <span class="string">'mass'</span>,  1, 1, 1 )
CreateReport( g, <span class="string">'tex'</span>, FileFullpath(<span class="string">'6USailPowerReport'</span>), <span class="string">'power'</span>, 1, 1, 1 )
</pre><img vspace="5" hspace="5" src="Build6USail_18.png" alt=""> <img vspace="5" hspace="5" src="Build6USail_19.png" alt=""> <h2 id="23">Export to obj</h2><pre class="codeinput"><span class="comment">%---------------</span>
ExportOBJ(g,FileFullpath(<span class="string">'6USail'</span>));



<span class="comment">%--------------------------------------</span>
<span class="comment">% PSS internal file version information</span>
<span class="comment">%--------------------------------------</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2021a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Build a 6U Sail.

%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%   Copyright (c) 2012-2016 Princeton Satellite Systems, Inc.
%   All rights reserved.
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%   Since 2016.1
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

%% Design the mission

% Constants
c               = Constant('speed of light');
mu              = Constant('mu earth');
muSun           = Constant('mu sun');
aU              = Constant('au');
lSail           = 5;

% Mission date
date            = [2015 5 7 0 0 0];
jD              = Date2JD(date);

% Our current guess for propulsion system sizing
mTotal  = 20; % kg
dVTotal = 8; %km/s

% ICONS parameters
massICONS = 0.5;
wICONS    = 0.1;


effConv         = 0.8;
powerComm       = 7.3;
fComm           = 200e6;
aAsteroid       = 1.3;
hParking        = 850; % Needs to be below the radiation belts

% One u is 10 cm
u               = 0.1;
zBox            = 1.4*u;
xBox            = 3*u;
yBox            = 2*u;
panelThickness  = 0.004;
lCore           = zBox;

busDim          = sprintf('%4.1f $\\times$ %4.1f $\\times$ %4.1f',xBox*100,yBox*100,zBox*100);

powerRWA        = 2;

% Omnidirectional antennas
massOmni        = 0.2;
powerOmni       = 2;
xOmni           = [xBox -yBox; yBox yBox; zBox zBox];
rOmni           = 0.002;
lOmni           = 0.5*c/fComm;

% Processor boards
dimProc         = [.293 .07 .005];
massBoard       = .1261;
powerBoard      = 2;

dimCPU          = [.09, .096, .036];
massCPU         = .35;
powerCPU        = 5.75;

nRWA            = 3;
wRWA            = 0.04;
massRWA         = 0.1;
xRWA            = [ xBox/2-wRWA            -xBox/2+wRWA   -xBox/2+wRWA;...
                    -2*wRWA+panelThickness	0             2*wRWA-panelThickness;...
                    wRWA/2                  wRWA/2        wRWA/2];


inToM           = 0.0254;
strutLength     = yBox/2;
nPanels         = 1;
panelLength     = 0.4/nPanels;
panelWidth      = 0.4;
solarPanelEff   = 0.295;
zSolarWing      = zBox/2;
rhoPanel        = 0.23;

yPanel          = strutLength + yBox/2;

a               = linspace(1,aAsteroid);
solarConstant   = 1367*(1./a).^2;
power           = 2*effConv*nPanels*panelLength*panelWidth*solarPanelEff*solarConstant;

Plot2D(a,power,'AU','Power (W)','Power');
y = get(gca,'ylim');
set(gca,'ylim',[0 y(2)]);


% Design the battery
dOD = 0.8;
sma = 6378.165 + hParking;
inc = 28.4667*pi/180;
rhoM = 133;
rhoV = 263;
[massBattery, volumeBattery, capacityBattery] = BatterySize( sma, inc, power(1), jD, dOD, rhoM, rhoV );

% Solar arrays
arrayMass	= nPanels*panelLength*panelWidth*rhoPanel;
bX          = [ 1 0 0;0 0 -1;0 1  0]';
bY          = [-1 0 0;0 1  0;0 0 -1];


% Earth spiral from hParking
aEarth      = aU;
r           = 6378.165 + hParking;

%% Print
clear s

k = 1;
s{k,1} = '\textbf{Mission Plan}';                                                       k = k + 1;
s{k,1} = 'Parking Altitude';            s{k,2} = hParking;          s{k,3} = 'km';      k = k + 1;
s{k,1} = 'Maximum Heliocentric Orbit';	s{k,2} = aAsteroid;         s{k,3} = 'AU';      k = k + 1;
s{k,1} = '\textbf{Power Subsystem}';                                                    k = k + 1;
s{k,1} = 'Maximum Power';               s{k,2} = power(1);          s{k,3} = 'W';       k = k + 1;
s{k,1} = 'Minimum Power';               s{k,2} = power(end);        s{k,3} = 'W';       k = k + 1;
s{k,1} = 'Solar cells';                 s{k,2} = 'Emcore ZTJ';                          k = k + 1;
s{k,1} = 'Solar cell efficiency';       s{k,2} = solarPanelEff;                         k = k + 1;
s{k,1} = 'Battery mass';                s{k,2} = massBattery;       s{k,3} = 'kg';      k = k + 1;
s{k,1} = 'Battery volume';              s{k,2} = volumeBattery;     s{k,3} = 'L';       k = k + 1;
s{k,1} = 'Battery capacity';            s{k,2} = capacityBattery;	s{k,3} = 'W-h'; 	k = k + 1;
s{k,1} = '\textbf{Mass}';                                                               k = k + 1;
s{k,1} = 'Bus dimensions';              s{k,2} = busDim;            s{k,3} = 'cm';      k = k + 1;
s{k,1} = 'Mass Total';                  s{k,2} = mTotal;            s{k,3} = 'kg';      k = k + 1;
s{k,1} = '\textbf{Communications Subsystem}';                                           k = k + 1;
s{k,1} = 'Communications';              s{k,2} = 'S Band';                              k = k + 1;
s{k,1} = 'Comm  Power';                 s{k,2} = powerComm;         s{k,3} = 'W';       k = k + 1;

CreateLatexTable(s,'Parameters')


%% Initialize
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
BuildCADModel( 'initialize' );
BuildCADModel( 'set name' , '6U Sail' );
BuildCADModel( 'set units', 'mks' );

%% Core
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
m              = [];
m.name         = 'Core';
m.rHinge       = [0;0;0];
m.bHinge.b     = eye(3);
m.previousBody = [];

BuildCADModel('add body', m );

m.name         = 'SolarWing1';
m.rHinge       = [0;0;0];
m.bHinge.b     = eye(3);
m.previousBody = 1;

BuildCADModel('add body', m );

m.name         = 'SolarWing2';
m.rHinge       = [0;0;0];
m.bHinge.b     = eye(3);
m.previousBody = 1;

BuildCADModel('add body', m );


%% This creates the connections between the bodies
BuildCADModel( 'compute paths' );

%% Solar Array 1
m = CreateComponent( 'make', 'solar array front', 'z', panelLength, 'x', panelWidth,...
                     'nZ', nPanels, 'nX', nPanels, 'dirZ', 1, 'inside', 0, ...
                     'theta', [0 0], 'electricalConversionEfficiency', solarPanelEff, 'b', bY*bX,...
                     'rA', [0;yPanel;zSolarWing], 'mass', arrayMass/2, 'cM', [0;0;0],...
                     'name', 'Solar Array Plus Y Front', 'body', 2, 'faceColor', 'solar cell' );
BuildCADModel( 'add component', m );

m = CreateComponent( 'make', 'solar array back', 'z', panelLength, 'x', panelWidth,...
                     'nZ', nPanels, 'nX', nPanels, 'dirZ', 1,...
                     'theta', [0 0], 'b', bY*bX, 'inside', 0, ...
                     'rA', [0;yPanel;zSolarWing], 'mass', arrayMass/2, 'cM', [0;0;0],...
                     'name', 'Solar Array Plus Y Back', 'body', 2, 'faceColor', 'black' );
BuildCADModel( 'add component', m );

                     
%% Solar Array 2
m = CreateComponent( 'make', 'solar array front', 'z', panelLength, 'x', panelWidth,...
                     'nZ', nPanels, 'nX', nPanels, 'dirZ', 1,'inside', 0, ...
                     'theta', [0 0], 'electricalConversionEfficiency', solarPanelEff, 'b', bX',...
                     'rA', [0;-yPanel;zSolarWing], 'mass', arrayMass/2, 'cM', [0;0;0],...
                     'name', 'Solar Array Minus Y Front', 'body', 3, 'faceColor', 'solar cell' );
BuildCADModel( 'add component', m );

m = CreateComponent( 'make', 'solar array back', 'z', panelLength, 'x', panelWidth,...
                     'nZ', nPanels, 'nX', nPanels, 'dirZ', 1,...
                     'theta', [0 0], 'b', bX','inside', 0, ...
                     'rA', [0;-yPanel;zSolarWing], 'mass', arrayMass/2, 'cM', [0;0;0],...
                     'name', 'Solar Array Minus Y Back', 'body', 3, 'faceColor', 'black' );
BuildCADModel( 'add component', m );

%% Solar array drives
driveThickness = .01;
rD = [0 0;-yBox+driveThickness*2 yBox;zBox zBox]/2;
for k = 1:size(rD,2)
    n = sprintf('Solar Array Drive %d',k);
    m = CreateComponent( 'make', 'cylinder', 'rUpper', 0.04, 'rLower', 0.04, 'h', 0.01,'n',20,...
                     'inside', 0, 'b', [1 0 0;0 0 -1;0 1 0], 'rA', rD(:,k), 'mass', 0.1,...
                     'name', n, 'body', 1, 'faceColor', 'aluminum' );
    BuildCADModel( 'add component', m );
end


%% Frame
[v, f] = PanelFrame( xBox, yBox, panelThickness, panelThickness );
m = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f,...
                     'faceColor', 'aluminum','rA', [0;0;zBox-2*panelThickness],...
                     'mass', .1, 'name', 'Top Frame', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );

v = ([1 0 0; 0 1 0; 0 0 -1]*v')';
m = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f,...
                     'faceColor', 'aluminum','rA', [0;0;2*panelThickness],...
                     'mass', .1, 'name', 'Bottom Frame', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );

z1     = 2*panelThickness;
z2     = z1 + zBox-2*panelThickness; 
c      = [];
c.x    = [ -0.250 0     0     0.250  0.250  0      0     -0.250]*inToM;
c.y    = [  0.375 0.375 0.125 0.125 -0.375 -0.375 -0.125 -0.125]*inToM;
[v, f] = ShapedStrut( [0;0;z1], [0;0;z2], c );
angle  = 0;
sX     = [1  1 -1 -1];
sY     = [1 -1 -1  1];
for k = 1:4
  angle = angle + pi/2;
  xF    = sX(k)*(xBox/2 - panelThickness/2);
  yF    = sY(k)*(yBox/2 - panelThickness/2);
  b     = [cos(angle) sin(angle) 0;-sin(angle) cos(angle) 0;0 0 1];
  vR    = (b*v')';
  m     = CreateComponent( 'make', 'generic', 'vertex', vR, 'face', f,...
                           'faceColor', 'aluminum','rA', [xF;yF;0], ...
                           'mass', .1, 'name', ['z strut' num2str(k)], 'body', 1,...
                           'inside',0 );
  BuildCADModel( 'add component', m );
end


%% Panels
panelName = {'+X' '-X' '+Y' '-Y' '+Z'  '-Z'};
color     = {'gold foil' 'gold foil' 'radiator' 'radiator' 'aluminum' 'aluminum'};
xLoc      = (xBox - panelThickness)/2;
yLoc      = (yBox - panelThickness)/2;
zLoc      = (zBox - panelThickness)/2;
			 
wX        = xBox - 2*panelThickness;
wY        = yBox - 2*panelThickness;
wZ        = zBox - 2*panelThickness;

th        = panelThickness;
zH        = zBox/2;

rAP       = [ xLoc -xLoc 0     0      0       0 ;...
              0     0    yLoc -yLoc   0       0;...
              zH    zH   zH    zH    zBox     0];
			 
dP        =     [ th  th wX  wX  wX  wX ;...
                  wY  wY th  th  wY  wY;...
                  wZ  wZ wZ  wZ  th  th];

for k = 1:6
  m = CreateComponent( 'make', 'box', 'x', dP(1,k), 'y',dP(2,k), 'z',dP(3,k),...
                       'faceColor', color{k}, 'rA', rAP(:,k), 'mass', .1,...
                       'name', ['Panel ' panelName{k}], 'body', 1,...
                       'inside', 0 );
  BuildCADModel( 'add component', m );
end

%% Batteries

% 2 pack of batteries wired together
wB        = .065;
lB        = .018;
hB        = .065;
% 4 batteries
rB        = [-xBox/2+wB/2;-yBox/2+lB*2/2+driveThickness;zBox-hB*2/2];
m         = CreateComponent( 'make', 'box','x', wB, 'y', lB*2, 'z', hB*2,...
                             'faceColor', [0 1 0] ,'rA', rB,'mass',0.1,...
                             'name', 'Battery Pack','inside',1);
BuildCADModel( 'add component', m );
% 2 batteries
rB        = [-xBox/2+wB/2;yBox/2-lB/2-driveThickness;zBox-hB*2/2];
m         = CreateComponent( 'make', 'box','x', wB, 'y', lB, 'z', hB*2,...
                             'faceColor', [0 1 0] ,'rA', rB,'mass',0.1,...
                             'name', 'Battery Pack','inside',1);
BuildCADModel( 'add component', m );

%% Antenna
m = CreateComponent( 'make', 'ellipsoid', 'name', 'Antenna',...
                     'body', 1, 'abc', [0.25 0.25 0.1], 'thetaUpper',pi/4,'b',[0 0 1;0 1 0;-1 0 0],...
					 'n',10, 'rA',[-xBox/2-0.1;0;zBox/2], 'faceColor', [0.5 0.5 0], 'edgeColor',[1 1 1]);
BuildCADModel('add component', m );

%% Processors
xProc = 0.5*(xBox-dimProc(1));
yProc = -0.5*(yBox-dimProc(2));
m = CreateComponent( 'make', 'box', 'x', dimProc(1), 'y', dimProc(2), 'z', dimProc(3), 'rA',[xProc-panelThickness;-yProc-panelThickness;.5*dimProc(3)+panelThickness],...
                     'name', 'processors', 'body', 1, 'mass', massBoard,'power',powerBoard, ...
                     'faceColor', [1 0 0], 'inside', 1);
BuildCADModel( 'add component', m );

%% Single Board Computer
xCPU = .5*(xBox-dimCPU(1));
yCPU = 0.5*(yBox-dimCPU(2));
zCPU = .5*dimCPU(3)+dimProc(3);
m = CreateComponent( 'make', 'box', 'x', dimCPU(1), 'y', dimCPU(2), 'z', dimCPU(3), 'rA',[xCPU-panelThickness;yCPU-panelThickness;zCPU-panelThickness],...
                     'name', 'computer', 'body', 1, 'mass', massCPU,'power',powerCPU, ...
                     'faceColor', [0 1 1], 'inside', 1);
BuildCADModel( 'add component', m );

%% Reaction wheels
for k = 1:nRWA
    m = CreateComponent( 'make', 'box', 'x', wRWA, 'y', wRWA, 'z', wRWA, 'rA',xRWA(:,k),...
                         'name', sprintf('RWA %d',k), 'body', 1, 'mass', massRWA,'power',powerRWA, ...
                         'faceColor', [1 1 0], 'inside', 1);
    BuildCADModel( 'add component', m );
end

%% Omni antennas
for k = 1:2
    m = CreateComponent( 'make', 'cylinder', 'rUpper', rOmni, 'rLower', rOmni, 'h', lOmni, 'n', 24, 'rA',xOmni(:,k),...
                         'name', sprintf('Omni %d',k), 'body', 1, 'mass', massOmni,'power',powerOmni, ...
                         'faceColor', [0 0 0], 'inside', 1);
    BuildCADModel( 'add component', m );
end

%% ICONS sensor and deployment box
[v, f]    = ICONS;
m = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f, 'rA', [xBox-wICONS*2;yBox-wICONS*3/2;zBox],...
                     'name', 'ICONS', 'body', 1, 'mass', massICONS,'power',5*0.7+4, ...
                     'faceColor', [1 0.2 0.7], 'inside', 0);
BuildCADModel( 'add component', m );

m = CreateComponent( 'make', 'box', 'x', wICONS, 'y', wICONS, 'z',wICONS, 'rA', [xBox-wICONS*2-panelThickness;yBox-wICONS*3/2-panelThickness;zBox-wICONS/2],...
                     'name', 'ICONS Launch Box', 'body', 1, 'mass', 0.1,'power',0, ...
                     'faceColor', [0.2 0.2 0.7], 'inside', 1);
BuildCADModel( 'add component', m );

%% Sails
dZ          = lSail/10;
v           = [ 0 lSail/2 -lSail/2;...
                0 lSail/2  lSail/2;...
			   dZ     dZ       dZ ]';
sailName    = {'+Y' '-Y' '+X' '-X'};
			   
f           = [1 2 3];
x           = lSail/30;
z           = -lCore/3;
rSail       = {[0 x z]' [0 -x z]' [x 0 z]' [-x 0 z]' };
bSail       = { eye(3) Eul2Mat([0 0 pi]) Eul2Mat([0 0 pi/2]) Eul2Mat([0 0 -pi/2]) };

mass        = 0.001*lSail^2/4;

for k = 1:4
  m = CreateComponent( 'make', 'generic', 'name', ['Sail ' sailName{k}],...
                       'rA', rSail{k}, 'mass', mass ,'inside',0,...
                       'faceColor', [1 0.9 0.5], 'edgeColor', [1 0.8 0.34], 'b', bSail{k}, ...
                       'specularStrength', 1, 'diffuseStrength', 0.3,...
                       'vertex', v, 'face', f, ...
 					              'body', 1 );
  BuildCADModel( 'add component', m );
end


%% MultiSpectral Imager
xMSI = .12;
yMSI = .12;
zMSI = .125;
massMSI = .8;
powerMSI = 12;
m = CreateComponent( 'make', 'box', 'x', xMSI, 'y', yMSI, 'z', zMSI, 'rA', [.5*(xBox-xMSI)-panelThickness;.5*(-yBox+yMSI)+panelThickness;zBox-.5*zMSI-panelThickness],...
                     'name', 'MultiSpectral Imager', 'body', 1, 'mass', massMSI,'power',powerMSI, ...
                     'faceColor', [.2 0 0.7], 'inside', 1);
BuildCADModel( 'add component', m );


%% Add subsystems
BuildCADModel( 'add subsystem', 'acs',        {'ICONS','rwa'} );
BuildCADModel( 'add subsystem', 'payload',    {'MultiSpectral Imager'});
BuildCADModel( 'add subsystem', 'tt&c',       {'computer', 'omni', 'signal','processors', 'antenna'} );
BuildCADModel( 'add subsystem', 'mechanism',  {'drive'} );
BuildCADModel( 'add subsystem', 'power',      {'solar array', 'battery'} );
BuildCADModel( 'add subsystem', 'structure',  {'support', 'frame', 'strut', 'panel'} );


%% Update the mass properties to produce the tables
BuildCADModel( 'update body mass properties' );

g = BuildCADModel( 'get model');
BuildCADModel('show vehicle')
view(0,-90)

CreateReport( g, 'tex', FileFullpath('6USailMassReport'),  'mass',  1, 1, 1 )
CreateReport( g, 'tex', FileFullpath('6USailPowerReport'), 'power', 1, 1, 1 )


%% Export to obj
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
ExportOBJ(g,FileFullpath('6USail'));



%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% PSS internal file version information
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% $Date:   2021-06-17 $
% $Revision: bcbdd88fdd6e5cd823069592ed346ad7cdbe3f98 $

##### SOURCE END #####
--></body></html>