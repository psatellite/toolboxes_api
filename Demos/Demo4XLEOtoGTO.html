
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Demo4XLEOtoGTO</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-11-07"><meta name="DC.source" content="Demo4XLEOtoGTO.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Impulsive 4X optimization of LEO to GEO with interpolated inner laps</a></li><li><a href="#2">User Parameters</a></li><li><a href="#3">Optimization</a></li><li><a href="#4">run</a></li></ul></div><h2 id="1">Impulsive 4X optimization of LEO to GEO with interpolated inner laps</h2><p>LEO to GTO with some plane change.</p><p>When doing multiple runs with the same number of key laps but increasing numbers of tweens, convergence can be faster if the previous results are used as an initial guess - set "restart" to true.</p><p>See also: DVHohInc, OptimizeImpulsive4X, MassCostLinearFun</p><pre class="codeinput"><span class="comment">%---------------------------------------------------------------------------</span>
<span class="comment">%   Copyright (c) 2018 Princeton Satellite Systems, Inc.</span>
<span class="comment">%   All rights reserved.</span>
<span class="comment">%---------------------------------------------------------------------------</span>

<span class="comment">% Compare same # revs, different # key laps:</span>
<span class="comment">% 3: 180, 240, 300</span>
<span class="comment">% 4: 120, 160, 200</span>
</pre><h2 id="2">User Parameters</h2><p>For example, if nKey is 3 and nTween is 20, converges in &lt;40 iterations.</p><pre class="codeinput">nKey = 3;
nTween = 20;
restart = false; <span class="comment">% if nKey is changed must use false</span>

<span class="comment">% Initial conditions</span>
wArg = 0; <span class="comment">% pi/2;</span>
elInitial = [6700 28*pi/180 0 wArg 0.05 0];
elFinal   = [24000 20*pi/180 0 0 0.715 0.1];

<span class="comment">% Analytical solution (Hohmann)</span>
Di = elFinal(2)-elInitial(2);
[dvT, dv1, dv2, Di1, Di2] = DVHohInc( elInitial(5), elInitial(1), elFinal(5), elFinal(1), Di );
</pre><h2 id="3">Optimization</h2><pre class="codeinput">frame = 1;

data = OptimizeImpulsive4X;
data.keyLaps = nKey;
data.tweenLaps = nTween; <span class="comment">% Total laps are (key - 1)*tween + 1</span>
totalLaps = (data.keyLaps-1)*data.tweenLaps + 1;
fprintf(<span class="string">'Total number of laps: %d\n'</span>,totalLaps);
data.elementMask = [0 1 0 0 0 0 1 1];
data.doInitial = true;
<span class="keyword">if</span> restart
  data.doInitial = false;
<span class="keyword">end</span>

<span class="comment">%  propulsion system</span>
costFun = @MassCostLinearFun;
costData = MassCostLinearFun;
costData.m0 = 500;
costData.iSp = 1000;
costData.eta = 0.6;
costData.sigma = 350;

<span class="comment">%{
</span><span class="comment">% remove effect of propulsion system
</span><span class="comment">costData.sigma = inf;
</span><span class="comment">%}
</span>
data.costFun = costFun;
data.costData = costData;
</pre><pre class="codeoutput">Total number of laps: 41
</pre><h2 id="4">run</h2><pre class="codeinput"><span class="keyword">if</span> restart
  data.dvsPrev = out.keydVsF;
<span class="keyword">end</span>

[burns, elOutput, out]=OptimizeImpulsive4X(elInitial,elFinal,[],data);

OptimizerReport(out)
[sysMass,masses,impulses] = MassCostLinearFun(burns,elInitial,data.costData,OTFrame(<span class="string">'polar'</span>));

PlotImpulsiveTrajectory(elInitial, burns, elFinal);
PlotElementsImpulsive(elInitial, burns, [], elFinal);
dVs = reshape(out.tweendVsF,4,[])';
[time,tlabl] = TimeLabl(out.absTimes');
Plot2D(time,out.burns(:,1)',tlabl,<span class="string">'DV'</span>,<span class="string">'Delta-V Magnitude'</span>)
dVs = reshape(out.tweendVsF,4,[])';
Plot2D(1:size(dVs,1),dVs,<span class="string">'Index'</span>,<span class="string">'DV'</span>,<span class="string">'Interpolated Delta-Vs'</span>)
legend(<span class="string">'bP'</span>,<span class="string">'bA'</span>,<span class="string">'bN1'</span>,<span class="string">'bN2'</span>)

NewFig(<span class="string">'Initial and Final Key DVs'</span>);
bar([out.dVs0;out.keydVsF]')
ylabel(<span class="string">'DV (km/s)'</span>)
legend(<span class="string">'Guess'</span>,<span class="string">'Final'</span>)


<span class="comment">%--------------------------------------</span>
</pre><pre class="codeoutput">  Calculating initial feasible solution.
                                            First-order      Norm of
 Iter F-count            f(x)  Feasibility   optimality         step
    0      13    2.120860e+02    6.020e-07    8.338e+01
    1      35    2.087668e+02    8.689e-04    4.465e+01    1.083e-01
    2      50    2.020279e+02    2.413e-01    2.245e+06    1.083e-01
    3      68    1.958896e+02    3.436e-01    3.322e+01    1.083e-01
    4      90    1.958470e+02    2.473e-01    7.888e+01    2.368e-02
    5     105    1.953837e+02    2.553e-01    1.963e+03    1.184e-02
    6     123    1.944371e+02    2.536e-01    4.649e+01    1.184e-02
    7     140    1.944373e+02    2.420e-01    4.668e+01    3.479e-05
    8     157    1.944183e+02    2.420e-01    2.798e+01    4.133e-03
    9     174    1.969220e+02    2.373e-01    3.175e+01    8.288e-02
   10     189    1.955223e+02    2.610e-01    1.658e+06    4.144e-02
   11     208    1.955819e+02    1.617e-01    2.820e+01    1.484e-02

Converged to an infeasible point.

fmincon stopped because the size of the current step is less than
the value of the step size tolerance but constraints are not
satisfied to within the value of the constraint tolerance.

Total Delta-V (km/s):
          2.56265268287661
Number of burns:
    82
Initial elements, target, achieved:
  Columns 1 through 3
                      6700         0.488692190558412                         0
                     24000         0.349065850398866                         0
           23853.073979218         0.433520468882648          6.28318530717959
  Columns 4 through 6
                         0                      0.05                         0
                         0                     0.715                       0.1
                         0         0.714246396331086          3.14159265358979
Mission duration:
	5.86818 Time (days)
Cost value:
          195.581864846181
Iterations:
    12
Constraint value:
         0.161692396923858
Elapsed Time:
	14.9138 sec
System mass:
	195.582 kg
Masses:
          114.988606319605          9.19908850556837          71.3941700210084
</pre><img vspace="5" hspace="5" src="Demo4XLEOtoGTO_01.png" alt=""> <img vspace="5" hspace="5" src="Demo4XLEOtoGTO_02.png" alt=""> <img vspace="5" hspace="5" src="Demo4XLEOtoGTO_03.png" alt=""> <img vspace="5" hspace="5" src="Demo4XLEOtoGTO_04.png" alt=""> <img vspace="5" hspace="5" src="Demo4XLEOtoGTO_05.png" alt=""> <img vspace="5" hspace="5" src="Demo4XLEOtoGTO_06.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Impulsive 4X optimization of LEO to GEO with interpolated inner laps
% LEO to GTO with some plane change.
%
% When doing multiple runs with the same number of key laps but increasing
% numbers of tweens, convergence can be faster if the previous results are used
% as an initial guess - set "restart" to true.
%
% See also: DVHohInc, OptimizeImpulsive4X, MassCostLinearFun

%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%   Copyright (c) 2018 Princeton Satellite Systems, Inc.
%   All rights reserved.
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

% Compare same # revs, different # key laps:
% 3: 180, 240, 300
% 4: 120, 160, 200

%% User Parameters
% For example, if nKey is 3 and nTween is 20, converges in <40 iterations.
nKey = 3;
nTween = 20;
restart = false; % if nKey is changed must use false

% Initial conditions
wArg = 0; % pi/2;
elInitial = [6700 28*pi/180 0 wArg 0.05 0];
elFinal   = [24000 20*pi/180 0 0 0.715 0.1];

% Analytical solution (Hohmann)
Di = elFinal(2)-elInitial(2);
[dvT, dv1, dv2, Di1, Di2] = DVHohInc( elInitial(5), elInitial(1), elFinal(5), elFinal(1), Di );


%% Optimization
frame = 1;

data = OptimizeImpulsive4X;
data.keyLaps = nKey;
data.tweenLaps = nTween; % Total laps are (key - 1)*tween + 1
totalLaps = (data.keyLaps-1)*data.tweenLaps + 1;
fprintf('Total number of laps: %d\n',totalLaps);
data.elementMask = [0 1 0 0 0 0 1 1];
data.doInitial = true;
if restart
  data.doInitial = false;
end

%  propulsion system
costFun = @MassCostLinearFun;
costData = MassCostLinearFun;
costData.m0 = 500;
costData.iSp = 1000;
costData.eta = 0.6;
costData.sigma = 350;

%{
% remove effect of propulsion system
costData.sigma = inf;
%}

data.costFun = costFun;
data.costData = costData;

%% run
if restart
  data.dvsPrev = out.keydVsF;
end

[burns, elOutput, out]=OptimizeImpulsive4X(elInitial,elFinal,[],data);

OptimizerReport(out)
[sysMass,masses,impulses] = MassCostLinearFun(burns,elInitial,data.costData,OTFrame('polar'));

PlotImpulsiveTrajectory(elInitial, burns, elFinal);
PlotElementsImpulsive(elInitial, burns, [], elFinal);
dVs = reshape(out.tweendVsF,4,[])';
[time,tlabl] = TimeLabl(out.absTimes');
Plot2D(time,out.burns(:,1)',tlabl,'DV','Delta-V Magnitude')
dVs = reshape(out.tweendVsF,4,[])';
Plot2D(1:size(dVs,1),dVs,'Index','DV','Interpolated Delta-Vs')
legend('bP','bA','bN1','bN2')

NewFig('Initial and Final Key DVs'); 
bar([out.dVs0;out.keydVsF]')
ylabel('DV (km/s)')
legend('Guess','Final')


%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% $Date: 2019-10-01 15:52:33 -0400 (Tue, 01 Oct 2019) $
% $Revision: 49921 $

##### SOURCE END #####
--></body></html>