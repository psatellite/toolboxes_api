<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>Direct Fusion Drive (DFD) Mars Mission using an Orion capsule.</title>
<meta name="generator" content="MATLAB 24.1">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-01-22">
<meta name="DC.source" content="DFDMarsMission.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h1>Direct Fusion Drive (DFD) Mars Mission using an Orion capsule.</h1>
<!--introduction-->
<p>You can change parameters to resize the vehicle. This designs a fusion propelled spacecraft to take an Orion capsule to Mars. Sizes the mission and builds a model of the propulsion stage. If requested loads the Orion spacecraft as a subassembly from Orion.mat</p>
<p>------------------------------------------------------------------------- See also BuildCADModel, CreateBody, CreateComponent, ExportCAD, ExportOBJ, LoadCAD, AntennaPatch, VEscape, UE, VOrbit, Constant, CreateLatexTable, Truss, RocketMass -------------------------------------------------------------------------</p>
<!--/introduction-->
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#2">Controls</a>
</li>
<li>
<a href="#3">Constants</a>
</li>
<li>
<a href="#4">Inputs</a>
</li>
<li>
<a href="#5">Spacecraft parameters</a>
</li>
<li>
<a href="#6">Orbit calculations</a>
</li>
<li>
<a href="#7">Mass calculations</a>
</li>
<li>
<a href="#8">Add the habitat module</a>
</li>
<li>
<a href="#9">Add subsystems</a>
</li>
<li>
<a href="#10">Update the mass properties to produce the tables</a>
</li>
<li>
<a href="#11">Export</a>
</li>
</ul>
</div>
<pre class="codeinput">
<span class="comment">%--------------------------------------------------------------------------</span>
<span class="comment">%   Copyright (c) 2013-2014 Princeton Satellite Systems, Inc.</span>
<span class="comment">%   All Rights Reserved.</span>
<span class="comment">%--------------------------------------------------------------------------</span>
<span class="comment">%   Since version 2014.1</span>
<span class="comment">%--------------------------------------------------------------------------</span>
</pre>
<h2 id="2">Controls</h2>
<pre class="codeinput">
<span class="comment">%----------</span>
addOrion            = 1;
exportCAD           = 0;
makeCADModel        = 1;
</pre>
<h2 id="3">Constants</h2>
<pre class="codeinput">
<span class="comment">%-----------</span>
radiusMars	        = Constant(<span class="string">'equatorial radius mars'</span>);
radiusEarth         = Constant(<span class="string">'equatorial radius earth'</span>);
muSun               = Constant(<span class="string">'mu sun'</span>);
muMars              = Constant(<span class="string">'mu mars'</span>);
g                   = 9.806; <span class="comment">% m/s^2</span>
aU                  = Constant(<span class="string">'au'</span> );
aEarth              = aU;
aMars               = 1.5*aU;
</pre>
<h2 id="4">Inputs</h2>
<pre class="codeinput">
<span class="comment">%--------</span>
dVTransfer          = 59.78;
thrust              = [302.4 352.6 406.7 302.7];
dV                  = [7.41 12.51 17.93 12.47];
earthOrbitAltitude  = 400;
marsOrbitAltitude   = 400;
</pre>
<h2 id="5">Spacecraft parameters</h2>
<pre class="codeinput">
<span class="comment">%-----------------------</span>

<span class="comment">% Fusion engines</span>
<span class="comment">%----------------</span>
rEngine             = 0.55;
lEngine             = 12*rEngine;
lNozzle             = 0.8;
nEngines            = 5;

<span class="comment">% http://www.nasaspaceflight.com/2012/04/delving-deeper-dsh-configurations-support-craft/</span>
<span class="comment">%----------------------------------------------------------------------------------------</span>
massHab             = 39884; <span class="comment">% DSH Configuraton (kg)</span>
specPower           = 1;<span class="comment">%0.75;% 0.48; % kW/kg</span>
powerPerEngine      = 6e6;
power               = nEngines*powerPerEngine;
eta                 = 0.58;
fS                  = 0.03; <span class="comment">% kg/kg fuel tank/fuel</span>

<span class="comment">% Radiator</span>
<span class="comment">%---------</span>
radiatorArealMass   = 2.75;
tempRadiator        = 625;
tRadiator           = 0.1;
massTruss           = 20;
lengthTruss         = 3;

<span class="comment">% Fuel tanks</span>
<span class="comment">%-----------</span>
nTank               = 4;
lTank               = 10;
fInsulation         = 1.2; <span class="comment">% Insulation thickness is 20% of tank</span>
densityD            = 162.4; <span class="comment">% kg/m^3</span>
nTankPerRow         = 4;
tankSpacing         = lTank/100;
massHe3             = 1.434928508299958;<span class="comment">%kg</span>
densityHe3          = 0.1785;<span class="comment">%kg/m^3</span>
volHe3              = massHe3/densityHe3;<span class="comment">%m^3</span>

<span class="comment">% Cylindrical transition structure</span>
<span class="comment">%=--------------------------------</span>
lCylTrans           = 12;
rCylTrans           = 2;
massCylTrans        = 200;

<span class="comment">% Orion to engine transition structure</span>
<span class="comment">%-------------------------------------</span>
rUOrionTrans        = 2;
rLOrionTrans        = 3;
lOrionTrans         = 2;
massOrionTrans      = 20;
</pre>
<h2 id="6">Orbit calculations</h2>
<pre class="codeinput">
<span class="comment">%--------------------</span>
earthOrbit          = earthOrbitAltitude + radiusEarth;  <span class="comment">% km</span>
marsOrbit           = marsOrbitAltitude  + radiusMars;   <span class="comment">% km</span>

dVMars              = VEscape( marsOrbit, muMars ) - VOrbit(marsOrbit,marsOrbit,muMars);
dVEarth             = VEscape( earthOrbit )        - VOrbit(earthOrbit,earthOrbit);

<span class="comment">% Total delta-v</span>
<span class="comment">%--------------</span>
dV                  = dV + [dVEarth dVMars dVMars dVEarth];
</pre>
<h2 id="7">Mass calculations</h2>
<pre class="codeinput">
<span class="comment">%-------------------</span>
massFuel        = zeros(1,4);
massTotalSeg	  = zeros(1,5);
massTank        = zeros(1,4);
massEngine      = power/(1000*specPower);
massTotalSeg(5) = massEngine + massHab;<span class="comment">% + massOrion</span>

<span class="keyword">for</span> k = 4:-1:1
    uE(k)                                       = 2*power*eta/thrust(k);
    [massFuel(k), massTotalSeg(k), massTank(k)]	= RocketMass( uE(k)/g,massTotalSeg(k+1), fS, dV(k) );
<span class="keyword">end</span>
volFuel                                         = massFuel/densityD;

clear <span class="string">s</span>

k = 1;
s{k,1} = <span class="string">'$\Delta V$ Mars Escape'</span>;	s{k,2} = sprintf(<span class="string">'%4.2f'</span>,dVMars);               s{k,3} = <span class="string">'km/s'</span>;    k = k + 1;
s{k,1} = <span class="string">'$\Delta V$ Earth Escape'</span>;	s{k,2} = sprintf(<span class="string">'%4.2f'</span>,dVEarth);              s{k,3} = <span class="string">'km/s'</span>;    k = k + 1;
s{k,1} = <span class="string">'$\Delta V$ Round Trip'</span>;   s{k,2} = sprintf(<span class="string">'%4.2f'</span>,dV );                  s{k,3} = <span class="string">'km/s'</span>;    k = k + 1;
s{k,1} = <span class="string">'Mass Habitat'</span>;            s{k,2} = sprintf(<span class="string">'%6.1f'</span>,massHab);              s{k,3} = <span class="string">'kg'</span>;      k = k + 1;
s{k,1} = <span class="string">'Mass Engine'</span>;             s{k,2} = sprintf(<span class="string">'%6.1f'</span>,massEngine);           s{k,3} = <span class="string">'kg'</span>;      k = k + 1;
s{k,1} = <span class="string">'Mass Fuel'</span>;               s{k,2} = sprintf(<span class="string">'%6.1f'</span>,sum(massFuel));        s{k,3} = <span class="string">'kg'</span>;      k = k + 1;
s{k,1} = <span class="string">'Mass Tankage'</span>;            s{k,2} = sprintf(<span class="string">'%6.1f'</span>,sum(massTank));        s{k,3} = <span class="string">'kg'</span>;      k = k + 1;
s{k,1} = <span class="string">'Mass Total'</span>;              s{k,2} = sprintf(<span class="string">'%6.1f'</span>,massTotalSeg(1));      s{k,3} = <span class="string">'kg'</span>;      k = k + 1;
s{k,1} = <span class="string">'Volume Fuel'</span>;             s{k,2} = sprintf(<span class="string">'%6.1f'</span>,volFuel);              s{k,3} = <span class="string">'m^3'</span>;     k = k + 1;
s{k,1} = <span class="string">'Thrust'</span>;                  s{k,2} = sprintf(<span class="string">'%6.1f'</span>,thrust);               s{k,3} = <span class="string">'N'</span>;       k = k + 1;
s{k,1} = <span class="string">'Exhaust Velocity'</span>;        s{k,2} = sprintf(<span class="string">'%7.2f'</span>,uE/1000);              s{k,3} = <span class="string">'km/s'</span>;    k = k + 1;
s{k,1} = <span class="string">'Engine efficiency'</span>;       s{k,2} = sprintf(<span class="string">'%4.3f'</span>,eta);                  s{k,3} = <span class="string">''</span>;        k = k + 1;
s{k,1} = <span class="string">'Specific power'</span>;          s{k,2} = sprintf(<span class="string">'%4.3f'</span>,specPower);            s{k,3} = <span class="string">'kW/kg'</span>;   k = k + 1;

CreateLatexTable( s, 1 )

<span class="comment">% If you don't want a CAD model, return</span>
<span class="comment">%--------------------------------------</span>
<span class="keyword">if</span>( makeCADModel == 0 )
    <span class="keyword">return</span>
<span class="keyword">end</span>

<span class="comment">% Build the CAD model</span>
<span class="comment">%--------------------</span>
BuildCADModel( <span class="string">'initialize'</span> );

BuildCADModel( <span class="string">'set name'</span> ,	<span class="string">'Mars Orion'</span> );
BuildCADModel( <span class="string">'set units'</span>,	<span class="string">'mks'</span>  );

m = CreateBody( <span class="string">'make'</span>, <span class="string">'name'</span>, <span class="string">'Core'</span> );
BuildCADModel(<span class="string">'add body'</span>, m );
BuildCADModel( <span class="string">'compute paths'</span> );

<span class="keyword">if</span>( addOrion )
  BuildCADModel( <span class="string">'add subassembly'</span>, <span class="string">'Orion'</span>, 1, [0;0;0], [-1 0 0;0 1 0; 0 0 1] );
<span class="keyword">end</span>
</pre>
<pre class="codeoutput">$\Delta V$ Mars Escape &amp; 1.39  &amp; km/s \\ 
\hline 
$\Delta V$ Earth Escape &amp; 3.18  &amp; km/s \\ 
\hline 
$\Delta V$ Round Trip &amp; 10.5913.9019.3215.65  &amp; km/s \\ 
\hline 
Mass Habitat &amp; 39884.0  &amp; kg \\ 
\hline 
Mass Engine &amp; 30000.0  &amp; kg \\ 
\hline 
Mass Fuel &amp; 57541.8  &amp; kg \\ 
\hline 
Mass Tankage &amp; 1726.3  &amp; kg \\ 
\hline 
Mass Total &amp; 129152.1  &amp; kg \\ 
\hline 
Volume Fuel &amp;   69.9  95.0 126.4  63.0  &amp; m^3 \\ 
\hline 
Thrust &amp;  302.4 352.6 406.7 302.7  &amp; N \\ 
\hline 
Exhaust Velocity &amp;  115.08  98.70  85.57 114.97   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00   0.00  65.26  72.45  78.19  83.27  87.97  92.40  96.63 100.61 104.45 108.25 111.86 115.37 118.92 122.26 125.52 128.72 131.85 134.93 137.95 141.09 143.99 146.84 149.65 152.41 155.13 157.81 160.44 163.04 165.60 168.12 170.60 173.05 175.47 177.85 180.48 182.79 185.06 187.31 189.53 191.72 193.88 196.01 198.12 200.20 202.26 204.29 206.30 208.28 210.24 212.17 214.09 215.98 217.85 219.69 221.52 223.32 225.11 226.87 228.62 230.34 232.05 233.74 235.41 237.06 238.69 240.31 241.91 243.49 245.05 246.60 248.14 249.65 251.16 252.64  &amp; km/s \\ 
\hline 
Engine efficiency &amp; 0.580  &amp;  \\ 
\hline 
Specific power &amp; 1.000  &amp; kW/kg \\ 
\hline 
</pre>
<img vspace="5" hspace="5" src="DFDMarsMission_01.png" alt=""> <h2 id="8">Add the habitat module</h2>
<pre class="codeinput">
<span class="comment">%------------------------</span>
rHab1 = 2;
rHab2 = 1.5;<span class="comment">%125;</span>
rHab3 = 2.25;
lHab1 = 5.5;
lHab2 = 2.5;
lHab3 = 10;
bHab   = [0 0 1;0 1 0;-1 0 0];
xHab1 = -4.2 - lHab1;
rAHab1 = [xHab1;0;0];
massHab1=16077.27;
nameHab1 = sprintf(<span class="string">'Habitat Module Part 1%d'</span>,k);
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, rHab1, <span class="string">'rLower'</span>, rHab1, <span class="string">'h'</span>, lHab1, <span class="string">'n'</span>, 20, <span class="string">'b'</span>, bHab, <span class="keyword">...</span>
                                    <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'inside'</span>,0, <span class="string">'rA'</span>, rAHab1, <span class="string">'mass'</span>, massHab1, <span class="string">'name'</span>, nameHab1, <span class="string">'body'</span>, 1 );
BuildCADModel( <span class="string">'add component'</span>, m );
xHab2 = -4.2 - lHab1 - lHab2;
rAHab2 = [xHab2;0;0];
massHab2=1545.89;
nameHab2 = sprintf(<span class="string">'Habitat Module Part 2%d'</span>,k);
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, rHab2, <span class="string">'rLower'</span>, rHab2, <span class="string">'h'</span>, lHab2, <span class="string">'n'</span>, 20, <span class="string">'b'</span>, bHab, <span class="keyword">...</span>
                                    <span class="string">'faceColor'</span>, <span class="string">'steel'</span>,<span class="string">'inside'</span>,0, <span class="string">'rA'</span>, rAHab2, <span class="string">'mass'</span>, massHab2, <span class="string">'name'</span>, nameHab2, <span class="string">'body'</span>, 1 );
BuildCADModel( <span class="string">'add component'</span>, m );
xHab3 = -4.2 - lHab1 - lHab2 - lHab3;
rAHab3 = [xHab3;0;0];
massHab3=22260.84;
nameHab3 = sprintf(<span class="string">'Habitat Module Part 3%d'</span>,k);
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, rHab3, <span class="string">'rLower'</span>, rHab3, <span class="string">'h'</span>, lHab3, <span class="string">'n'</span>, 20, <span class="string">'b'</span>, bHab, <span class="keyword">...</span>
                                    <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'inside'</span>,0, <span class="string">'rA'</span>, rAHab3, <span class="string">'mass'</span>, massHab3, <span class="string">'name'</span>, nameHab3, <span class="string">'body'</span>, 1 );
BuildCADModel( <span class="string">'add component'</span>, m );
lHab = lHab1+lHab2+lHab3;

<span class="comment">% Add the fuel tanks</span>
<span class="comment">%-------------------</span>
rTank = sqrt(sum(volFuel)/nTank/lTank/pi);

<span class="comment">% Add insulation</span>
<span class="comment">%---------------</span>
rTank = fInsulation*rTank;
lTank = fInsulation*lTank;

massTank = (1+fS)*sum(massFuel)/(nTank*nTankPerRow);

ang = pi/4;
b   = [0 0 1;0 1 0;-1 0 0];
lT  = lTank/nTankPerRow;

xTank = -4.2 - lHab - lTank;
<span class="keyword">for</span> j = 1:nTankPerRow
    <span class="keyword">for</span> k = 1:nTank
        y       = 1.5*rTank*cos(ang);
        z       = 1.5*rTank*sin(ang);
        ang     = ang + pi/2;
        rA      = [xTank;y;z];
        name	= sprintf(<span class="string">'Fuel Tank %d'</span>,k);
        m       = CreateComponent(	<span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, rTank, <span class="string">'rLower'</span>, rTank, <span class="string">'h'</span>, lT, <span class="string">'n'</span>, 20, <span class="string">'b'</span>, b, <span class="keyword">...</span>
                                    <span class="string">'faceColor'</span>, <span class="string">'gold foil'</span>,<span class="string">'inside'</span>,0, <span class="string">'rA'</span>, rA, <span class="string">'mass'</span>, massTank, <span class="string">'name'</span>, name, <span class="string">'body'</span>, 1 );
        BuildCADModel( <span class="string">'add component'</span>, m );
    <span class="keyword">end</span>
	xTank = xTank + lT + tankSpacing;

<span class="keyword">end</span>

xTank = -4.2 - lHab - lTank;

xTrans = xTank - lCylTrans;
m       = CreateComponent(	<span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, rCylTrans, <span class="string">'rLower'</span>, rCylTrans, <span class="string">'h'</span>, lCylTrans, <span class="string">'n'</span>, 20, <span class="string">'b'</span>, b, <span class="keyword">...</span>
                                <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'inside'</span>,0, <span class="string">'rA'</span>, [xTrans;0;0], <span class="string">'mass'</span>, massCylTrans, <span class="string">'name'</span>, <span class="string">'Transition'</span>, <span class="string">'body'</span>, 1 );
BuildCADModel( <span class="string">'add component'</span>, m );


<span class="comment">% Add He3 Tank</span>
<span class="comment">%-------------</span>
rHTank = rTank*((1/cos(pi/4))-1)-0.1;
lHTank = volHe3/(pi*((rHTank/fInsulation)^2));
lHTank = lHTank*fInsulation;
bH   = [0 0 1;0 1 0;-1 0 0];
xHTank = -4.2 - lHab - lHTank;
rAH = [xHTank;0;0];
massTankH=1;
nameH = sprintf(<span class="string">'He3 Fuel Tank %d'</span>,k);

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, rHTank, <span class="string">'rLower'</span>, rHTank, <span class="string">'h'</span>, lHTank, <span class="string">'n'</span>, 20, <span class="string">'b'</span>, bH, <span class="keyword">...</span>
                                    <span class="string">'faceColor'</span>, <span class="string">'gold foil'</span>,<span class="string">'inside'</span>,0, <span class="string">'rA'</span>, rAH, <span class="string">'mass'</span>, massTankH, <span class="string">'name'</span>, nameH, <span class="string">'body'</span>, 1 );
BuildCADModel( <span class="string">'add component'</span>, m );


<span class="comment">% Add Engines</span>
<span class="comment">%------------</span>
ang         = 0;
massEngine  = massEngine/nEngines;
massNozzle  = 0.05*massEngine;
massEngine  = 0.95*massEngine;
xEngine     = xTrans - lEngine;
xNozzle     = xEngine - lNozzle;
<span class="keyword">for</span> k = 1:nEngines
  y       = 1.5*rEngine*cos(ang);
  z       = 1.5*rEngine*sin(ang);
  ang     = ang + 2*pi/nEngines;
  rA      = [xEngine;y;z];
  name    = sprintf(<span class="string">'Engine %d'</span>,k);
  m       = CreateComponent(	<span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, rEngine, <span class="string">'rLower'</span>, rEngine, <span class="string">'h'</span>, lEngine, <span class="string">'n'</span>, 20, <span class="string">'b'</span>, b, <span class="keyword">...</span>
                              <span class="string">'faceColor'</span>, <span class="string">'gold foil'</span>,<span class="string">'inside'</span>,0, <span class="string">'rA'</span>, rA, <span class="string">'mass'</span>, massEngine, <span class="string">'name'</span>, name, <span class="string">'body'</span>, 1 );
  BuildCADModel( <span class="string">'add component'</span>, m );

	rA      = [xNozzle;y;z];

	name	= sprintf(<span class="string">'Magnetic Nozzle %d'</span>,k);
  m       = CreateComponent(	<span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, 0.5*rEngine, <span class="string">'rLower'</span>, rEngine, <span class="string">'h'</span>, lNozzle, <span class="string">'n'</span>, 20, <span class="string">'b'</span>, b, <span class="keyword">...</span>
                              <span class="string">'faceColor'</span>, <span class="string">'black'</span>,<span class="string">'inside'</span>,0, <span class="string">'rA'</span>, rA, <span class="string">'mass'</span>, massNozzle, <span class="string">'name'</span>, name, <span class="string">'body'</span>, 1 );
  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>

<span class="comment">% Add Radiators</span>
<span class="comment">%--------------</span>
heatRadiatedPerSide = (1-eta)*power/4; <span class="comment">% for one radiator side</span>
sigma               = 5.67e-8;

area                = heatRadiatedPerSide/(sigma*tempRadiator^4);
xWidth              = lCylTrans;
yWidth              = area/xWidth;
massRadiator        = radiatorArealMass*area;

q = 1;
<span class="keyword">for</span> k = 1:2
	name	= sprintf(<span class="string">'Radiator %d'</span>,k);
	rA      = [xTrans + 0.5*lCylTrans;q*(rCylTrans+lengthTruss);0];

    m       = CreateComponent(	<span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, xWidth, <span class="string">'y'</span>, yWidth, <span class="string">'z'</span>, tRadiator, <span class="keyword">...</span>
                                <span class="string">'faceColor'</span>, <span class="string">'radiator'</span>,<span class="string">'inside'</span>,0, <span class="string">'rA'</span>, rA, <span class="string">'mass'</span>, massRadiator, <span class="string">'name'</span>, name, <span class="string">'body'</span>, 1 );
    BuildCADModel( <span class="string">'add component'</span>, m );

	name	= sprintf(<span class="string">'Radiator Truss %d'</span>,k);
    rA      = [xTrans + 0.5*lCylTrans;q*rCylTrans;0];
    m       = CreateComponent(	<span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, tRadiator, <span class="string">'y'</span>, lengthTruss, <span class="string">'z'</span>, tRadiator,<span class="string">'faceColor'</span>, <span class="string">'black'</span>,<span class="string">'inside'</span>,0, <span class="keyword">...</span>
                                 <span class="string">'rA'</span>, rA, <span class="string">'mass'</span>, massTruss, <span class="string">'name'</span>, name, <span class="string">'body'</span>, 1 );
    BuildCADModel( <span class="string">'add component'</span>, m );
    q       = -q;

<span class="keyword">end</span>

<span class="comment">% Antenna Assembly</span>
<span class="comment">%-----------------</span>
rE          = 1*0.61;
rhoTruss    = 409.7/4.55^2;
mGimbal     = 7.5;
area        = 203*144/39.37^2;
mass        = 53.5/2.205;
rhoAreal    = mass/area;
rAntenna = 1;
massAntenna = rhoAreal*pi*rAntenna^2;
bA   = [0 0 1;0 1 0;-1 0 0];
[v, f, l] = Truss( [0;0;0], [10*rE;0;0], 0.5*rE, 10 );
massTruss = rhoTruss*4.5*rE*rE*(0.5*rE)^2;

lTruss = 15;

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f, <span class="string">'edgeColor'</span>,<span class="string">'truss'</span>, <span class="string">'rA'</span>, [-(lTruss+2.4*rE);0;9.3*rE],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Antenna Truss'</span>, <span class="string">'body'</span>, 1, <span class="string">'b'</span>,bA, <span class="string">'mass'</span>,massTruss,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'gold foil'</span>, <span class="string">'inside'</span>, 0);
BuildCADModel( <span class="string">'add component'</span>, m );

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, 0.25*rE, <span class="string">'rLower'</span>,0.25*rE, <span class="string">'h'</span>, 0.4*rE, <span class="string">'n'</span>,12, <span class="string">'rA'</span>, [-(lTruss+2.4*rE);0;9.3*rE],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Antenna Azimuth Gimbal'</span>, <span class="string">'body'</span>, 1, <span class="string">'mass'</span>, mGimbal/2, <span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'gold foil'</span>, <span class="string">'inside'</span>, 0);
BuildCADModel( <span class="string">'add component'</span>, m );

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, 0.25*rE, <span class="string">'rLower'</span>,0.25*rE, <span class="string">'h'</span>, rE, <span class="string">'n'</span>,12, <span class="string">'rA'</span>, [-(lTruss+2.4*rE);-0.5*rE;10*rE],<span class="keyword">...</span>
                     <span class="string">'name'</span>, <span class="string">'Antenna Elevation Gimbal'</span>, <span class="string">'body'</span>, 1, <span class="string">'b'</span>,[1 0 0;0 0 1;0 -1 0], <span class="string">'mass'</span>, mGimbal/2, <span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'gold foil'</span>, <span class="string">'inside'</span>, 0);
BuildCADModel( <span class="string">'add component'</span>, m );


[v, f] = AntennaPatch( rAntenna, rAntenna, 0.5, 0.2,[-1;0;0], [0;0;1], 20 );
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f, <span class="string">'edgeColor'</span>,<span class="string">'truss'</span>,<span class="keyword">...</span>
	                 <span class="string">'name'</span>, <span class="string">'Antenna'</span>, <span class="string">'body'</span>, 1, <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'inside'</span>, 0,<span class="string">'mass'</span>,massAntenna,<span class="keyword">...</span>
                     <span class="string">'rA'</span>,[-(lTruss+2.7*rE);0;10*rE] );

BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">% Add truss</span>
<span class="comment">%----------</span>
xBottom     = [xTank;0;0];
xTop        = [xTank+lTank;0;0];
[v, f]      = Truss( xBottom, xTop, rTank, 8 );
c           = cos(pi/4);
v           = ([1 0 0;0 c c;0 -c c]*v')';
m           = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>, v, <span class="string">'face'</span>, f,<span class="string">'edgeColor'</span>, <span class="string">'truss'</span> ,<span class="string">'rA'</span>,[0;0;0],<span class="keyword">...</span>
	                         <span class="string">'name'</span>, <span class="string">'Truss'</span>, <span class="string">'body'</span>, 1, <span class="string">'faceColor'</span>, [0.8 0.1 0.2],<span class="string">'inside'</span>, 1 );
BuildCADModel( <span class="string">'add component'</span>, m );
</pre>
<img vspace="5" hspace="5" src="DFDMarsMission_02.png" alt=""> <h2 id="9">Add subsystems</h2>
<pre class="codeinput">
<span class="comment">%----------------</span>
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'ACS'</span>,        {<span class="string">'star camera'</span>,<span class="string">'rwa'</span> <span class="string">'torquer'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'ECLS'</span>,       {<span class="string">'habitat'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'Propulsion'</span>,	{<span class="string">'engine'</span> <span class="string">'fuel'</span> <span class="string">'radiator'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'Telemetry and Command'</span>,       {<span class="string">'antenna'</span>, <span class="string">'board'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'mechanism'</span>,  {<span class="string">'drive'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'power'</span>,      {<span class="string">'solar array'</span>, <span class="string">'battery'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'structure'</span>,  {<span class="string">'support'</span>, <span class="string">'frame'</span>, <span class="string">'strut'</span>, <span class="string">'panel'</span>} );
</pre>
<h2 id="10">Update the mass properties to produce the tables</h2>
<pre class="codeinput">
<span class="comment">%--------------------------------------------------</span>
BuildCADModel( <span class="string">'update body mass properties'</span> );
g = BuildCADModel( <span class="string">'get model'</span>);
BuildCADModel(<span class="string">'show vehicle'</span>)
</pre>
<img vspace="5" hspace="5" src="DFDMarsMission_03.png" alt=""> <img vspace="5" hspace="5" src="DFDMarsMission_04.png" alt=""> <h2 id="11">Export</h2>
<pre class="codeinput">
<span class="comment">%--------</span>
<span class="keyword">if</span>( exportCAD )
  CreateReport( g, <span class="string">'tex'</span>, FileFullpath(<span class="string">'DFDMarsMass'</span>), <span class="string">'mass'</span>,  1, 1, 1 );

	<span class="keyword">if</span>( addOrion )
      ExportOBJ( g, FileFullpath(<span class="string">'MarsOrion'</span>) );
  <span class="keyword">else</span>
      ExportOBJ( g, FileFullpath(<span class="string">'MarsOrionPropulsion'</span>) );
  <span class="keyword">end</span>
<span class="keyword">end</span>


<span class="comment">%--------------------------------------</span>

<span class="comment">% $Id: d98a8613439a417ef61cf6e4eb803c94e1bf7da0 $</span>
</pre>
<p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2024a</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% Direct Fusion Drive (DFD) Mars Mission using an Orion capsule.
%
% You can change parameters to resize the vehicle. This designs a fusion
% propelled spacecraft to take an Orion capsule to Mars. Sizes the mission
% and builds a model of the propulsion stage. If requested loads the Orion
% spacecraft as a subassembly from Orion.mat
%
% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%  See also BuildCADModel, CreateBody, CreateComponent, ExportCAD, 
%  ExportOBJ, LoadCAD, AntennaPatch, VEscape, UE, VOrbit, Constant, 
%  CreateLatexTable, Truss, RocketMass
% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%%

%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%   Copyright (c) 2013-2014 Princeton Satellite Systems, Inc.
%   All Rights Reserved.
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%   Since version 2014.1
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

%% Controls
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
addOrion            = 1;
exportCAD           = 0;
makeCADModel        = 1;

%% Constants
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
radiusMars	        = Constant('equatorial radius mars');
radiusEarth         = Constant('equatorial radius earth');
muSun               = Constant('mu sun');
muMars              = Constant('mu mars');
g                   = 9.806; % m/s^2
aU                  = Constant('au' );
aEarth              = aU;
aMars               = 1.5*aU;

%% Inputs
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
dVTransfer          = 59.78;
thrust              = [302.4 352.6 406.7 302.7];
dV                  = [7.41 12.51 17.93 12.47];
earthOrbitAltitude  = 400;
marsOrbitAltitude   = 400;

%% Spacecraft parameters
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

% Fusion engines
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
rEngine             = 0.55;
lEngine             = 12*rEngine;
lNozzle             = 0.8;
nEngines            = 5;

% http://www.nasaspaceflight.com/2012/04/delving-deeper-dsh-configurations-support-craft/
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
massHab             = 39884; % DSH Configuraton (kg)
specPower           = 1;%0.75;% 0.48; % kW/kg
powerPerEngine      = 6e6;   
power               = nEngines*powerPerEngine;
eta                 = 0.58;
fS                  = 0.03; % kg/kg fuel tank/fuel

% Radiator
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
radiatorArealMass   = 2.75;
tempRadiator        = 625;
tRadiator           = 0.1;
massTruss           = 20;
lengthTruss         = 3;

% Fuel tanks
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
nTank               = 4;
lTank               = 10;
fInsulation         = 1.2; % Insulation thickness is 20% of tank
densityD            = 162.4; % kg/m^3
nTankPerRow         = 4;
tankSpacing         = lTank/100;
massHe3             = 1.434928508299958;%kg
densityHe3          = 0.1785;%kg/m^3
volHe3              = massHe3/densityHe3;%m^3

% Cylindrical transition structure
%=REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
lCylTrans           = 12;
rCylTrans           = 2;
massCylTrans        = 200;

% Orion to engine transition structure
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
rUOrionTrans        = 2;
rLOrionTrans        = 3;
lOrionTrans         = 2;
massOrionTrans      = 20;

%% Orbit calculations
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
earthOrbit          = earthOrbitAltitude + radiusEarth;  % km
marsOrbit           = marsOrbitAltitude  + radiusMars;   % km

dVMars              = VEscape( marsOrbit, muMars ) - VOrbit(marsOrbit,marsOrbit,muMars);
dVEarth             = VEscape( earthOrbit )        - VOrbit(earthOrbit,earthOrbit);

% Total delta-v
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
dV                  = dV + [dVEarth dVMars dVMars dVEarth];


%% Mass calculations
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
massFuel        = zeros(1,4);
massTotalSeg	  = zeros(1,5);
massTank        = zeros(1,4);
massEngine      = power/(1000*specPower);
massTotalSeg(5) = massEngine + massHab;% + massOrion

for k = 4:-1:1
    uE(k)                                       = 2*power*eta/thrust(k);
    [massFuel(k), massTotalSeg(k), massTank(k)]	= RocketMass( uE(k)/g,massTotalSeg(k+1), fS, dV(k) );
end
volFuel                                         = massFuel/densityD;

clear s

k = 1;
s{k,1} = '$\Delta V$ Mars Escape';	s{k,2} = sprintf('%4.2f',dVMars);               s{k,3} = 'km/s';    k = k + 1;
s{k,1} = '$\Delta V$ Earth Escape';	s{k,2} = sprintf('%4.2f',dVEarth);              s{k,3} = 'km/s';    k = k + 1;
s{k,1} = '$\Delta V$ Round Trip';   s{k,2} = sprintf('%4.2f',dV );                  s{k,3} = 'km/s';    k = k + 1;
s{k,1} = 'Mass Habitat';            s{k,2} = sprintf('%6.1f',massHab);              s{k,3} = 'kg';      k = k + 1;
s{k,1} = 'Mass Engine';             s{k,2} = sprintf('%6.1f',massEngine);           s{k,3} = 'kg';      k = k + 1;
s{k,1} = 'Mass Fuel';               s{k,2} = sprintf('%6.1f',sum(massFuel));        s{k,3} = 'kg';      k = k + 1;
s{k,1} = 'Mass Tankage';            s{k,2} = sprintf('%6.1f',sum(massTank));        s{k,3} = 'kg';      k = k + 1;
s{k,1} = 'Mass Total';              s{k,2} = sprintf('%6.1f',massTotalSeg(1));      s{k,3} = 'kg';      k = k + 1;
s{k,1} = 'Volume Fuel';             s{k,2} = sprintf('%6.1f',volFuel);              s{k,3} = 'm^3';     k = k + 1;
s{k,1} = 'Thrust';                  s{k,2} = sprintf('%6.1f',thrust);               s{k,3} = 'N';       k = k + 1;
s{k,1} = 'Exhaust Velocity';        s{k,2} = sprintf('%7.2f',uE/1000);              s{k,3} = 'km/s';    k = k + 1;
s{k,1} = 'Engine efficiency';       s{k,2} = sprintf('%4.3f',eta);                  s{k,3} = '';        k = k + 1;
s{k,1} = 'Specific power';          s{k,2} = sprintf('%4.3f',specPower);            s{k,3} = 'kW/kg';   k = k + 1;

CreateLatexTable( s, 1 )

% If you don't want a CAD model, return
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
if( makeCADModel == 0 )
    return
end

% Build the CAD model
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
BuildCADModel( 'initialize' );

BuildCADModel( 'set name' ,	'Mars Orion' );
BuildCADModel( 'set units',	'mks'  );

m = CreateBody( 'make', 'name', 'Core' );
BuildCADModel('add body', m );
BuildCADModel( 'compute paths' );

if( addOrion )
  BuildCADModel( 'add subassembly', 'Orion', 1, [0;0;0], [-1 0 0;0 1 0; 0 0 1] );
end

%% Add the habitat module
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
rHab1 = 2;
rHab2 = 1.5;%125;
rHab3 = 2.25;
lHab1 = 5.5;
lHab2 = 2.5;
lHab3 = 10;
bHab   = [0 0 1;0 1 0;-1 0 0];
xHab1 = -4.2 - lHab1;
rAHab1 = [xHab1;0;0];
massHab1=16077.27;
nameHab1 = sprintf('Habitat Module Part 1%d',k);
m = CreateComponent( 'make', 'cylinder', 'rUpper', rHab1, 'rLower', rHab1, 'h', lHab1, 'n', 20, 'b', bHab, ...
                                    'faceColor', 'aluminum','inside',0, 'rA', rAHab1, 'mass', massHab1, 'name', nameHab1, 'body', 1 );
BuildCADModel( 'add component', m );
xHab2 = -4.2 - lHab1 - lHab2;
rAHab2 = [xHab2;0;0];
massHab2=1545.89;
nameHab2 = sprintf('Habitat Module Part 2%d',k);
m = CreateComponent( 'make', 'cylinder', 'rUpper', rHab2, 'rLower', rHab2, 'h', lHab2, 'n', 20, 'b', bHab, ...
                                    'faceColor', 'steel','inside',0, 'rA', rAHab2, 'mass', massHab2, 'name', nameHab2, 'body', 1 );
BuildCADModel( 'add component', m );
xHab3 = -4.2 - lHab1 - lHab2 - lHab3;
rAHab3 = [xHab3;0;0];
massHab3=22260.84;
nameHab3 = sprintf('Habitat Module Part 3%d',k);
m = CreateComponent( 'make', 'cylinder', 'rUpper', rHab3, 'rLower', rHab3, 'h', lHab3, 'n', 20, 'b', bHab, ...
                                    'faceColor', 'aluminum','inside',0, 'rA', rAHab3, 'mass', massHab3, 'name', nameHab3, 'body', 1 );
BuildCADModel( 'add component', m );
lHab = lHab1+lHab2+lHab3;

% Add the fuel tanks
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
rTank = sqrt(sum(volFuel)/nTank/lTank/pi);

% Add insulation
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
rTank = fInsulation*rTank;
lTank = fInsulation*lTank;

massTank = (1+fS)*sum(massFuel)/(nTank*nTankPerRow);

ang = pi/4;
b   = [0 0 1;0 1 0;-1 0 0];
lT  = lTank/nTankPerRow;

xTank = -4.2 - lHab - lTank;
for j = 1:nTankPerRow
    for k = 1:nTank
        y       = 1.5*rTank*cos(ang);
        z       = 1.5*rTank*sin(ang);
        ang     = ang + pi/2;
        rA      = [xTank;y;z];
        name	= sprintf('Fuel Tank %d',k);
        m       = CreateComponent(	'make', 'cylinder', 'rUpper', rTank, 'rLower', rTank, 'h', lT, 'n', 20, 'b', b, ...
                                    'faceColor', 'gold foil','inside',0, 'rA', rA, 'mass', massTank, 'name', name, 'body', 1 );
        BuildCADModel( 'add component', m );
    end
	xTank = xTank + lT + tankSpacing;

end

xTank = -4.2 - lHab - lTank;

xTrans = xTank - lCylTrans;
m       = CreateComponent(	'make', 'cylinder', 'rUpper', rCylTrans, 'rLower', rCylTrans, 'h', lCylTrans, 'n', 20, 'b', b, ...
                                'faceColor', 'aluminum','inside',0, 'rA', [xTrans;0;0], 'mass', massCylTrans, 'name', 'Transition', 'body', 1 );
BuildCADModel( 'add component', m );


% Add He3 Tank
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
rHTank = rTank*((1/cos(pi/4))-1)-0.1;
lHTank = volHe3/(pi*((rHTank/fInsulation)^2));
lHTank = lHTank*fInsulation;
bH   = [0 0 1;0 1 0;-1 0 0];
xHTank = -4.2 - lHab - lHTank;
rAH = [xHTank;0;0];
massTankH=1;
nameH = sprintf('He3 Fuel Tank %d',k);

m = CreateComponent( 'make', 'cylinder', 'rUpper', rHTank, 'rLower', rHTank, 'h', lHTank, 'n', 20, 'b', bH, ...
                                    'faceColor', 'gold foil','inside',0, 'rA', rAH, 'mass', massTankH, 'name', nameH, 'body', 1 );
BuildCADModel( 'add component', m );


% Add Engines
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
ang         = 0;
massEngine  = massEngine/nEngines;
massNozzle  = 0.05*massEngine;
massEngine  = 0.95*massEngine;
xEngine     = xTrans - lEngine;
xNozzle     = xEngine - lNozzle;
for k = 1:nEngines
  y       = 1.5*rEngine*cos(ang);
  z       = 1.5*rEngine*sin(ang);
  ang     = ang + 2*pi/nEngines;
  rA      = [xEngine;y;z];
  name    = sprintf('Engine %d',k);
  m       = CreateComponent(	'make', 'cylinder', 'rUpper', rEngine, 'rLower', rEngine, 'h', lEngine, 'n', 20, 'b', b, ...
                              'faceColor', 'gold foil','inside',0, 'rA', rA, 'mass', massEngine, 'name', name, 'body', 1 );
  BuildCADModel( 'add component', m );
    
	rA      = [xNozzle;y;z];

	name	= sprintf('Magnetic Nozzle %d',k);
  m       = CreateComponent(	'make', 'cylinder', 'rUpper', 0.5*rEngine, 'rLower', rEngine, 'h', lNozzle, 'n', 20, 'b', b, ...
                              'faceColor', 'black','inside',0, 'rA', rA, 'mass', massNozzle, 'name', name, 'body', 1 );
  BuildCADModel( 'add component', m );
end

% Add Radiators
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
heatRadiatedPerSide = (1-eta)*power/4; % for one radiator side
sigma               = 5.67e-8;

area                = heatRadiatedPerSide/(sigma*tempRadiator^4);
xWidth              = lCylTrans;
yWidth              = area/xWidth;
massRadiator        = radiatorArealMass*area;

q = 1;
for k = 1:2
	name	= sprintf('Radiator %d',k);
	rA      = [xTrans + 0.5*lCylTrans;q*(rCylTrans+lengthTruss);0];

    m       = CreateComponent(	'make', 'box', 'x', xWidth, 'y', yWidth, 'z', tRadiator, ...
                                'faceColor', 'radiator','inside',0, 'rA', rA, 'mass', massRadiator, 'name', name, 'body', 1 );
    BuildCADModel( 'add component', m );
    
	name	= sprintf('Radiator Truss %d',k);
    rA      = [xTrans + 0.5*lCylTrans;q*rCylTrans;0];
    m       = CreateComponent(	'make', 'box', 'x', tRadiator, 'y', lengthTruss, 'z', tRadiator,'faceColor', 'black','inside',0, ...
                                 'rA', rA, 'mass', massTruss, 'name', name, 'body', 1 );
    BuildCADModel( 'add component', m );
    q       = -q;

end

% Antenna Assembly
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
rE          = 1*0.61;
rhoTruss    = 409.7/4.55^2;
mGimbal     = 7.5;
area        = 203*144/39.37^2;
mass        = 53.5/2.205;
rhoAreal    = mass/area;
rAntenna = 1;
massAntenna = rhoAreal*pi*rAntenna^2;
bA   = [0 0 1;0 1 0;-1 0 0];
[v, f, l] = Truss( [0;0;0], [10*rE;0;0], 0.5*rE, 10 );
massTruss = rhoTruss*4.5*rE*rE*(0.5*rE)^2;

lTruss = 15;

m = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f, 'edgeColor','truss', 'rA', [-(lTruss+2.4*rE);0;9.3*rE],...
                     'name', 'Antenna Truss', 'body', 1, 'b',bA, 'mass',massTruss,...
                     'faceColor', 'gold foil', 'inside', 0);
BuildCADModel( 'add component', m );

m = CreateComponent( 'make', 'cylinder', 'rUpper', 0.25*rE, 'rLower',0.25*rE, 'h', 0.4*rE, 'n',12, 'rA', [-(lTruss+2.4*rE);0;9.3*rE],...
                     'name', 'Antenna Azimuth Gimbal', 'body', 1, 'mass', mGimbal/2, ...
                     'faceColor', 'gold foil', 'inside', 0);
BuildCADModel( 'add component', m );

m = CreateComponent( 'make', 'cylinder', 'rUpper', 0.25*rE, 'rLower',0.25*rE, 'h', rE, 'n',12, 'rA', [-(lTruss+2.4*rE);-0.5*rE;10*rE],...
                     'name', 'Antenna Elevation Gimbal', 'body', 1, 'b',[1 0 0;0 0 1;0 -1 0], 'mass', mGimbal/2, ...
                     'faceColor', 'gold foil', 'inside', 0);
BuildCADModel( 'add component', m );


[v, f] = AntennaPatch( rAntenna, rAntenna, 0.5, 0.2,[-1;0;0], [0;0;1], 20 );
m = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f, 'edgeColor','truss',...
	                 'name', 'Antenna', 'body', 1, 'faceColor', 'aluminum','inside', 0,'mass',massAntenna,...
                     'rA',[-(lTruss+2.7*rE);0;10*rE] );

BuildCADModel( 'add component', m );

% Add truss
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
xBottom     = [xTank;0;0];
xTop        = [xTank+lTank;0;0];
[v, f]      = Truss( xBottom, xTop, rTank, 8 );
c           = cos(pi/4);
v           = ([1 0 0;0 c c;0 -c c]*v')';
m           = CreateComponent( 'make', 'generic', 'vertex', v, 'face', f,'edgeColor', 'truss' ,'rA',[0;0;0],...
	                         'name', 'Truss', 'body', 1, 'faceColor', [0.8 0.1 0.2],'inside', 1 );
BuildCADModel( 'add component', m );

%% Add subsystems
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
BuildCADModel( 'add subsystem', 'ACS',        {'star camera','rwa' 'torquer'} );
BuildCADModel( 'add subsystem', 'ECLS',       {'habitat'} );
BuildCADModel( 'add subsystem', 'Propulsion',	{'engine' 'fuel' 'radiator'} );
BuildCADModel( 'add subsystem', 'Telemetry and Command',       {'antenna', 'board'} );
BuildCADModel( 'add subsystem', 'mechanism',  {'drive'} );
BuildCADModel( 'add subsystem', 'power',      {'solar array', 'battery'} );
BuildCADModel( 'add subsystem', 'structure',  {'support', 'frame', 'strut', 'panel'} );

%% Update the mass properties to produce the tables
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
BuildCADModel( 'update body mass properties' );
g = BuildCADModel( 'get model');
BuildCADModel('show vehicle')

%% Export
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
if( exportCAD )
  CreateReport( g, 'tex', FileFullpath('DFDMarsMass'), 'mass',  1, 1, 1 );

	if( addOrion )
      ExportOBJ( g, FileFullpath('MarsOrion') );
  else
      ExportOBJ( g, FileFullpath('MarsOrionPropulsion') );
  end
end


%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% $Date:   DFDMarsMission.m $
% $Id: d98a8613439a417ef61cf6e4eb803c94e1bf7da0 $

##### SOURCE END #####
-->
</body>
</html>
